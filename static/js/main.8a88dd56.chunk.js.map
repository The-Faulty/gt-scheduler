{"version":3,"sources":["constants.ts","log.ts","vendor/ics.js","utils/misc.tsx","components/Button/index.tsx","components/ActionRow/index.tsx","contexts/theme.ts","contexts/terms.ts","data/beans/Course.ts","data/beans/Section.ts","data/beans/SortingOption.ts","data/beans/Oscar.ts","data/types.ts","contexts/schedule.ts","contexts/overlayCrns.ts","components/TimeBlocks/index.tsx","components/Calendar/index.tsx","hooks/usePrevious.ts","components/Modal/index.tsx","components/CombinationContainer/index.tsx","utils/cancellable.ts","components/Course/index.tsx","components/CourseAdd/index.tsx","components/CourseContainer/index.tsx","components/CourseFilter/index.tsx","utils/semesters.ts","components/Spinner/index.tsx","components/Select/index.tsx","hooks/useMedia.ts","hooks/useScreenWidth.ts","data/firebase.ts","components/LoginModal/index.tsx","components/AccountDropdown/index.tsx","components/HeaderActionBar/index.tsx","components/HeaderDisplay/index.tsx","contexts/account.ts","hooks/useHeaderActionBarProps.ts","components/Header/index.tsx","components/Instructor/index.tsx","components/MapView/index.tsx","components/DaySelection/index.tsx","components/Map/index.tsx","components/NavDrawer/index.tsx","components/NavMenu/index.tsx","components/Palette/index.tsx","components/Prerequisite/index.tsx","components/Scheduler/index.tsx","components/Section/index.tsx","components/Tab/index.tsx","components/Attribution/index.tsx","components/Feedback/index.tsx","components/InformationModal/index.tsx","components/ErrorBoundary/index.tsx","components/ErrorDetails/index.tsx","components/ExpandableCard/index.tsx","components/ErrorDisplay/index.tsx","components/ErrorHeader/index.tsx","components/App/navigation.tsx","data/hooks/useDownloadTerms.ts","components/LoadingDisplay/index.tsx","components/App/content.tsx","components/WarningHeader/index.tsx","components/DataNotPersistentNotification/index.tsx","data/hooks/useRawScheduleDataFromStorage.ts","data/hooks/useEnsureValidTerm.ts","data/migrations/1to2.ts","data/legacy/types.ts","data/legacy/validation.ts","data/migrations/cookiesTo1.ts","data/migrations/index.ts","data/hooks/useUIStateFromStorage.ts","hooks/useLocalStorageNoSync.ts","data/hooks/useRawScheduleDataFromFirebase.ts","components/AppDataLoader/stages.tsx","data/hooks/useMigrateScheduleData.ts","data/hooks/useFirebaseAuth.ts","data/hooks/useScheduleDataProducer.ts","data/hooks/useExtractTermScheduleData.ts","data/hooks/useDownloadOscarData.ts","data/hooks/useExtractScheduleVersion.ts","components/AppDataLoader/index.tsx","data/hooks/useVersionActions.ts","data/hooks/useThemeFromStorage.ts","components/App/index.tsx","hooks/useBodyClass.ts","types.ts","index.tsx"],"names":["OPEN","DAYS","PALETTE","DELIVERY_MODES","CAMPUSES","Video","Online","BACKEND_BASE_URL","DESKTOP_BREAKPOINT","ErrorWithFields","message","source","fields","topMessage","Error","stack","fastSafeStringify","rootError","getRootError","name","console","group","this","error","allFields","getAllFields","Object","keys","length","info","groupEnd","softError","logToConsole","includes","type","rest","__do_not_use_type_in_sentry_it_is_special","Sentry","contexts","fingerprint","ics","uidDomain","prodId","navigator","userAgent","indexOf","SEPARATOR","appVersion","calendarEvents","calendarStart","join","calendarEnd","BYDAY_VALUES","events","calendar","addEvent","subject","description","location","begin","stop","rrule","freq","until","Number","isNaN","Date","parse","interval","parseInt","count","byday","prototype","toString","call","d","filter","elem","pos","start_date","end_date","now_date","start_year","getFullYear","slice","start_month","getMonth","start_day","getDate","start_hours","getHours","start_minutes","getMinutes","start_seconds","getSeconds","end_year","end_month","end_day","end_hours","end_minutes","end_seconds","now_year","now_month","now_day","now_hours","now_minutes","now_seconds","start_time","end_time","rruleString","start","end","now","uDate","toISOString","substring","replace","calendarEvent","splice","push","download","filename","ext","blob","Blob","bb","BlobBuilder","append","getBlob","document","characterSet","saveAs","build","log","stringToTime","string","regexResult","exec","hour","minute","timeToString","time","ampm","hh","mm","padStart","A","timeToShortString","periodToString","period","getRandomColor","colors","flat","Math","random","getContentClassName","color","hasConflictBetween","section1","section2","meetings","some","meeting1","meeting2","day","days","classes","classList","c","simplifyName","tokens","split","shift","pop","unique","array","Array","from","Set","isLab","section","scheduleType","isLecture","humanizeArrayReact","conjunction","String","init","last","trim","serializePrereqs","reqs","openPar","closePar","i","isArray","subClauses","forEach","req","id","isAxiosNetworkError","err","exponentialBackoff","attemptNumber","a","options","DelayFactory","getSanitizedOptions","jitter","numOfAttempts","MAX_SAFE_INTEGER","apply","sleep","amount_ms","Promise","resolve","setTimeout","undefined","OTHER_VERSIONS_NAMES","lexicographicCompare","b","Button","className","disabled","href","onClick","children","rel","target","tabIndex","onKeyDown","event","key","role","ActionRow","label","actions","restProps","flatMap","action","map","icon","styling","dataTip","dataFor","onMouseEnter","onMouseLeave","fixedWidth","style","ThemeContext","React","createContext","next","TermsContext","GPA_CACHE_LOCAL_STORAGE_KEY","Course","oscar","courseId","data","number","title","sections","prereqs","hasLab","onlyLectures","onlyLabs","allInOnes","sectionGroups","term","entries","sectionId","sectionData","Section","matchLabFromId","lab","lecture","startsWith","matchLabFromInstructors","instructors","instructor","associatedLabs","associatedLectures","lonelyLectures","lonelyLabs","distinct","groups","sectionGroupMeetings","sectionGroupHash","JSON","stringify","sectionGroup","hash","rawCache","window","localStorage","getItem","cache","cacheItem","exp","fetchGpaInner","courseGpa","setDate","rawUpdatedCache","setItem","encodedCourse","encodeURIComponent","url","axios","get","responseData","baseId","cleanedId","decodeCourseCritiqueResponse","overall","sum","Map","raw","historicalSectionData","classSizeGroup","class_size_group","rawInstructorName","instructor_name","gpa","GPA","classSizeEstimate","toLowerCase","instructorName","nameSegments","lastName","firstName","instructorGpa","set","gpaMap","averageGpa","course","crn","seating","credits","campus","deliveryMode","gradeBasis","scheduleTypeIndex","campusIndex","attributeIndices","gradeBasisIndex","scheduleTypes","campuses","attributes","attributeIndex","attribute","find","gradeBases","periodIndex","where","locationIndex","dateRangeIndex","periods","locations","dateRange","dateRanges","to","reduce","accum","prevDate","currDate","method","headers","then","response","tableRow","cheerio","load","$","eq","first","text","catch","fill","SortingOption","calculateFactor","Oscar","updatedAt","version","courses","courseMap","crnMap","sortingOptions","caches","periodSegments","cacheIndex","segments","v","setHours","combination","startMap","endMap","tot","min","ends","values","starts","desiredCourses","pinnedCrns","excludedCrns","crnsList","dfs","courseIndex","crns","findCourse","isIncluded","isPinned","hasConflict","crnSection","findSection","pinnedOnlyLecture","pinnedOnlyLab","pinnedAllInOne","iterateTimeBlocks","combinations","sortingOptionIndex","sortingOption","actualSortingOptionsLength","factor","sort","callback","meeting","EMPTY_OSCAR","defaultScheduleData","terms","defaultTermScheduleData","versions","defaultSchedule","colorMap","generateScheduleVersionId","charPool","result","floor","generateRandomId","ScheduleContext","currentVersion","allVersionNames","setTerm","patchSchedule","patch","updateSchedule","setCurrentVersion","addNewVersion","select","deleteVersion","renameVersion","newName","cloneVersion","OverlayCrnsContext","makeSizeInfoKey","TimeBlocks","overlay","preview","capture","isAutosized","sizeInfo","useContext","contentClassName","sizeInfoKey","sizeInfoDay","sizeInfoPeriodDay","top","height","width","rowSize","left","rowIndex","backgroundColor","place","effect","Calendar","overlayCrns","crnSizeInfo","updateJoinedRowSizes","periodInfos","seen","curCrn","curPeriod","newRowSize","has","add","period2Info","maxMeetingLen","max","m","dayPeriodInfos","curRowSize","acc","courseSizeInfo","daySizeInfo","_","usePrevious","val","ref","useRef","useEffect","current","Modal","buttons","show","onHide","preserveChildrenWhileHiding","previousChildren","previousShow","derivedChildren","onBackdropClick","renderBackdrop","props","transition","FadeZoom","backdropTransition","Fade","ModalButton","cancel","CSSTransition","timeout","classNames","CombinationContainer","setOverlayCrns","useState","confirmReset","setConfirmReset","handleResetPinnedCrns","useCallback","useMemo","getCombinations","sortedCombinations","sortCombinations","Select","onChange","newSortingOptionIndex","outline","rowCount","rowHeight","rowRenderer","index","textAlign","cancelledSymbol","Symbol","Cancellable","isCancelled","promise","other","race","cancelled","value","onAddCourse","expanded","setExpanded","prereqOpen","setPrereqOpen","paletteShown","setPaletteShown","setGpaMap","isSearching","Boolean","loadOperation","loadCourseGpa","fetchGpa","perform","handleRemoveCourse","newColorMap","handleIncludeSections","hasPrereqs","instructorMap","primaryInstructor","instructorSections","excludedInstructors","every","includedInstructors","prereqControl","nextPrereqOpen","nextExpanded","prereqAction","faShareAlt","transform","infoAction","faInfoCircle","pinnedSections","totalCredits","faPlus","faAngleUp","faAngleDown","faPalette","faTrash","toFixed","Palette","onSelectColor","col","Instructor","Prerequisite","isSortKey","sortKey","CourseAdd","keyword","setKeyword","setFilter","activeIndex","setActiveIndex","inputRef","handleChangeKeyword","e","input","results","toUpperCase","keywordMatch","filterMatch","tags","sortValue","doesFilterMatchCourse","handleAddCourse","toBeExcludedCrns","timeDecided","doesFilterMatchSection","focus","handleKeyDown","preventDefault","handleToggleFilter","tag","handleResetFilter","activeCourse","placeholder","property","labels","CourseFilter","selectedTags","onReset","onToggle","CourseContainer","ago","selectedTag","isTerm","maybeTerm","month","yearAsNumber","monthAsNumber","getSemesterName","year","semester","Spinner","size","mountDelay","actualSize","small","normal","viewBox","cx","cy","r","menuAnchor","desiredItemWidth","onClickNew","newLabel","opened","setOpened","selectedOption","option","inputId","setInputId","inputValue","setInputValue","inputEditAction","setInputEditAction","tryCommit","committedValue","onCommit","abandonEdit","trySetOpened","newOpened","faCaretDown","optionId","optionLabel","AutoFocusInput","Fragment","stopPropagation","faCheck","faTimes","marginRight","LoadingSelect","DropdownMenu","items","useMedia","query","matches","setMatches","useLayoutEffect","media","matchMedia","listener","apiUsed","addEventListener","addListener","removeEventListener","removeListener","previousQuery","previousMatches","useScreenWidth","widthWithUnits","firebaseConfig","apiKey","process","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","isAuthEnabled","auth","db","schedulesCollection","app","firebase","initializeApp","firestore","collection","setPersistence","Auth","Persistence","LOCAL","authProviders","EmailAuthProvider","PROVIDER_ID","GoogleAuthProvider","GithubAuthProvider","uiConfig","signInFlow","signInOptions","callbacks","signInSuccessWithAuthResult","LoginModalContent","minHeight","firebaseAuth","LoginModal","onAuthStateChanged","user","AccountDropdown","circleContent","state","loginOpen","setLoginOpen","hideLogin","SignedInLabel","faSignOutAlt","signOut","UserInitials","faSignInAlt","faUserCircle","initials","displayName","doc","DOMParser","parseFromString","dangerousDisplayName","documentElement","textContent","regex","match","getInitials","email","fontSize","signedInAs","dangerousName","nameElement","providerText","provider","HeaderActionBar","accountState","onCopyCrns","enableCopyCrns","onExportCalendar","enableExportCalendar","onDownloadCalendar","enableDownloadCalendar","theme","setTheme","handleThemeChange","enableExport","exportActions","faDownload","faCalendarAlt","faPaste","shouldRightAnchorExportDropdown","faAdjust","faGithub","HeaderDisplay","currentTab","onChangeTab","onToggleMenu","tabs","termsState","versionsState","mobile","largeMobile","faBars","onChangeTerm","currentTerm","VersionSelector","tabLabel","tabIdx","Tab","active","deleteConfirm","setDeleteConfirm","faPencilAlt","faCopy","faTrashAlt","allNamesSet","getNextVersionName","AccountContext","useHeaderActionBarProps","captureRef","handleExport","cal","alert","getTime","getDay","M","T","W","R","F","exportCoursesToCalendar","handleDownload","captureElement","computed","getComputedStyle","getPropertyValue","domtoimage","toBlob","offsetWidth","offsetHeight","downloadShadowCalendar","copy","Header","headerActionBarProps","includeSection","excludeSections","sectionList","instructorPinned","includedSections","excludedSections","excludeTooltipId","faGraduationCap","faBan","pinned","MapView","latitude","longitude","zoom","viewState","setViewState","unknown","coordsToLocationsMap","coords","mapStyle","mapboxApiAccessToken","onViewStateChange","newViewState","coordLocations","lat","long","faMapPin","coordLocation","showZoom","showCompass","isDay","rawDay","LIGHT_COLOR_PALETTE","DARK_COLOR_PALETTE","DaySelection","courseDateMap","activeDay","setActiveDay","daysOfTheWeek","colorPalette","formatTime","adjustedHour","date","padding","timeLabel","times","daysOfWeek","firstMeeting","sortedCourseDateMap","courseDataList","activeLocations","NavDrawer","open","onClose","NavMenu","currentItem","onChangeItem","item","idx","paletteColor","BASE_ITEM_STYLE","content","PrerequisiteEmpty","op","PrerequisiteClauseDisplay","clause","subClause","PrerequisiteOption","operator","PrerequisiteHeader","PrerequisiteItem","isLast","Scheduler","setTabIndex","overlayContextValue","tabTitle","Provider","setSeating","hovering","excludeSection","sect","pinSection","faThumbtack","faChair","afterShow","fetchSeating","newSeating","afterHide","Attribution","Feedback","submit","setSubmit","rating","setRating","feedback","setFeedback","loading","setLoading","faCommentAlt","marginLeft","submitFeedback","InformationModalContent","margin","display","alt","src","lineHeight","opacity","marginBottom","InformationModal","setShow","useLocalStorageState","hasSeen","setHasSeen","ErrorBoundary","reactErrorInfo","setState","fallback","Component","ErrorDetailsField","ReactErrorDetails","errorInfo","BaseErrorDetails","componentStack","LoadingErrorDetails","overview","safeStringify","ExpandableCard","showChildren","setShowChildren","ErrorDisplay","errorDetails","ErrorHeader","faExclamationTriangle","NAV_TABS","AppNavigationContext","currentTabIndex","isDrawerOpen","openDrawer","closeDrawer","AppNavigation","setIsDrawerOpen","contextValue","AppMobileNav","AppMobileNavDisplay","CRAWLER_INDEX_URL","LoadingDisplay","contents","stillLoading","AppContentBase","SkeletonContent","AppContent","memo","AppSkeleton","WarningHeader","faExclamationCircle","DataNotPersistentNotification","onAccept","SCHEDULE_DATA_LOCAL_STORAGE_KEY","isValidTerm","migrate1To2","version1","newData","version1TermData","baseCreatedAtTime","version2TermData","newEntries","version1ScheduleVersion","createdAt","makeCreatedAt","schedule","fromEntries","defaultTermData","isStringArray","field","validateTermData","termData","rawTermData","errors","termDataType","validTermData","termDataAsRecord","fieldValidationErrors","originalError","defaultVersion1ScheduleData","migrateCookiesTo1","allCookies","userNumber","cookieKey","cookieValue","parseResult","parsed","parseTermData","validateResult","currentIndex","migrateScheduleData","rawScheduleData","scheduleDataVersion1OrNewer","Cookies","defaultUIState","versionStates","useUIStateFromStorage","initialValue","storedValue","setStoredValue","valueToStore","Function","useLocalStorageNoSync","setUIState","setVersion","useRawScheduleDataFromFirebase","account","scheduleData","setScheduleData","permanentError","setPermanentError","removeSnapshotListener","onSnapshot","includeMetadataChanges","setScheduleDataPersistent","nextScheduleData","accountId","currentScheduleData","currentRawSchedule","rawData","getCurrentRawScheduleFromStorage","getCurrentScheduleData","runTransaction","transaction","exists","castDraft","castImmutable","setRawScheduleData","StageLoadUIState","uiState","StageEnsureValidTerm","skeletonProps","currentTermRaw","loadingState","mostRecentTerm","correctedTerm","useEnsureValidTerm","StageLoadRawScheduleDataFromStorage","isPersistent","userAcceptedNonPersistence","setUserAcceptedNonPersistence","useRawScheduleDataFromStorage","StageMigrateScheduleData","setError","maxSupportedVersion","updatedScheduleData","newError","currentRaw","versionOrNull","useMigrateScheduleData","StageLoadRawScheduleDataHybrid","StageLoadRawScheduleDataFromFirebase","StageLoadAccount","setAccountState","unregisterAuthObserver","providerData","firstProviderData","providerId","uid","useFirebaseAuth","StageCreateScheduleDataProducer","updateScheduleData","applyDraft","produce","useScheduleDataProducer","StageLoadTerms","newTerms","reverse","useDownloadTerms","StageExtractTermScheduleData","currentTermScheduleData","correctedTermScheduleData","draft","updateTermScheduleData","currentTermScheduleDataDraft","termScheduleData","allTermsInData","useExtractTermScheduleData","StageLoadOscarData","loadedOscarRef","constructTermDataUrl","isFirst","initialLoad","REFRESH_INTERVAL_MIN","json","loadAndRefresh","useDownloadOscarData","StageExtractScheduleVersion","currentVersionRaw","maybeCurrentScheduleVersion","allVersions","updateScheduleVersion","currentScheduleVersionDraft","subDraft","currentScheduleVersion","scheduleVersion","useExtractSchedule","DataLoader","GroupLoadScheduleData","ContextProvider","original","newId","sorted","indexOfDeleting","findIndex","newIndex","versionCount","existingDraft","newDraft","useVersionActions","scheduleContextValue","THEME_LOCAL_STORAGE_KEY","App","themeContextValue","legacyValue","correctedTheme","isTheme","useThemeFromStorage","body","remove","AppCSSRoot","dsn","integrations","Integrations","BrowserTracing","tracesSampleRate","ignoreErrors","release","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.8a88dd56.chunk.js","sourcesContent":["const OPEN = 8 * 60;\nconst CLOSE = 21 * 60;\nconst DAYS = ['M', 'T', 'W', 'R', 'F'];\n\nconst PNG_SCALE_FACTOR = 2;\n\nconst PALETTE = [\n  [\n    '#4D4D4D',\n    '#999999',\n    '#FFFFFF',\n    '#F44E3B',\n    '#FE9200',\n    '#FCDC00',\n    '#DBDF00',\n    '#A4DD00',\n    '#68CCCA',\n    '#73D8FF',\n    '#AEA1FF',\n    '#FDA1FF',\n  ],\n  [\n    '#333333',\n    '#808080',\n    '#CCCCCC',\n    '#D33115',\n    '#E27300',\n    '#FCC400',\n    '#B0BC00',\n    '#68BC00',\n    '#16A5A5',\n    '#009CE0',\n    '#7B64FF',\n    '#FA28FF',\n  ],\n  [\n    '#000000',\n    '#666666',\n    '#B3B3B3',\n    '#9F0500',\n    '#C45100',\n    '#FB9E00',\n    '#808900',\n    '#194D33',\n    '#0C797D',\n    '#0062B1',\n    '#653294',\n    '#AB149E',\n  ],\n];\n\nconst ASYNC_DELIVERY_MODE = 'Remote Asynchronous Course';\n\nconst DELIVERY_MODES: Record<string, string> = {\n  'Hybrid Course': 'Hybrid',\n  'Remote Synchronous Course': 'Remote Synchronous',\n  'Remote Asynchronous Course': 'Remote Asynchronous',\n  'Residential Course': 'Residential',\n};\n\nconst CAMPUSES: Record<string, string> = {\n  'Georgia Tech-Atlanta *': 'Atlanta',\n  'GT Lorraine-Undergrad Programs': 'Lorraine Undergrad',\n  'GT Lorraine-Graduate Programs': 'Lorraine Graduate',\n  'Georgia Tech - Shenzhen': 'Shenzhen',\n  Video: 'Video',\n  Online: 'Online',\n  'MBA Evening Program': 'MBA Evening',\n};\n\nconst BACKEND_BASE_URL = 'https://gt-scheduler.azurewebsites.net';\n\nconst LARGE_DESKTOP_BREAKPOINT = 1200;\nconst DESKTOP_BREAKPOINT = 1024;\nconst LARGE_MOBILE_BREAKPOINT = 600;\n\nexport {\n  OPEN,\n  CLOSE,\n  DAYS,\n  PNG_SCALE_FACTOR,\n  PALETTE,\n  ASYNC_DELIVERY_MODE,\n  DELIVERY_MODES,\n  CAMPUSES,\n  BACKEND_BASE_URL,\n  DESKTOP_BREAKPOINT,\n  LARGE_MOBILE_BREAKPOINT,\n  LARGE_DESKTOP_BREAKPOINT,\n};\n","import * as Sentry from '@sentry/react';\nimport fastSafeStringify from 'fast-safe-stringify';\n\nexport class ErrorWithFields extends Error {\n  fields: Record<string, unknown>;\n\n  topMessage: string;\n\n  source: Error | null;\n\n  constructor({\n    message,\n    source,\n    fields = {},\n  }: {\n    message: string;\n    source?: unknown;\n    fields?: Record<string, unknown>;\n  }) {\n    super();\n\n    this.fields = fields;\n    this.topMessage = message;\n\n    // Make sure the given source is an error if given,\n    // otherwise add its string serialization as a field\n    if (source instanceof Error) {\n      this.source = source;\n      this.message = `${message}: ${source.message}`;\n\n      // Try to inherit the stacktrace of the given error\n      // (otherwise, fall back to the stacktrace created\n      // when this error was constructed)\n      if (source.stack != null) {\n        this.stack = source.stack;\n      }\n    } else {\n      this.source = null;\n      this.message = message;\n\n      if (this.source !== null) {\n        // The source was non-null but was not an Error:\n        // add a naive string serialization as a context\n        this.fields['__non_error_source'] = 'true';\n        this.fields['__source'] = fastSafeStringify(source);\n      }\n    }\n\n    // Configure the name based on whether this is wrapping\n    // an existing non-wrapped error\n    const rootError = this.getRootError();\n    if (rootError === this || rootError instanceof ErrorWithFields) {\n      this.name = 'ErrorWithFields';\n    } else {\n      this.name = `ErrorWithFields(${rootError.name})`;\n    }\n  }\n\n  logToConsole(): void {\n    /* eslint-disable no-console */\n    console.group(this.topMessage);\n    console.error(this.getRootError());\n\n    const allFields = this.getAllFields();\n    if (Object.keys(allFields).length > 0) {\n      console.info(allFields);\n    }\n\n    console.groupEnd();\n    /* eslint-enable no-console */\n  }\n\n  getAllFields(): Record<string, unknown> {\n    if (this.source instanceof ErrorWithFields) {\n      return { ...this.source.getAllFields(), ...this.fields };\n    }\n\n    return this.fields;\n  }\n\n  getRootError(): Error {\n    if (this.source === null) {\n      return this;\n    }\n\n    if (this.source instanceof ErrorWithFields) {\n      return this.source.getRootError();\n    }\n\n    return this.source;\n  }\n}\n\n/**\n * Logs an error to the console and reports it to Sentry.\n * Does not re-throw any errors and can be used when there is reasonable\n * fallback behavior.\n * @param error - an instance of `ErrorWithFields`\n */\nexport function softError(error: ErrorWithFields): void {\n  error.logToConsole();\n\n  // Report the error to Sentry if in production\n  if (process.env.NODE_ENV === 'production') {\n    // Ensure we don't include `type` in the fields\n    let fields = error.getAllFields();\n    if (Object.keys(fields).includes('type')) {\n      const { type, ...rest } = fields;\n      fields = { __do_not_use_type_in_sentry_it_is_special: type, ...rest };\n    }\n\n    Sentry.captureException(error.getRootError(), {\n      // https://docs.sentry.io/platforms/ruby/enriching-events/context/#structured-context\n      contexts: {\n        fields,\n        error: {\n          message: error.message,\n        },\n      },\n      fingerprint: [error.message],\n    });\n  }\n}\n","/* global saveAs, BlobBuilder */\n/* exported ics */\n\nconst ics = (uidDomain, prodId) => {\n  if (\n    navigator.userAgent.indexOf('MSIE') > -1 &&\n    navigator.userAgent.indexOf('MSIE 10') === -1\n  ) {\n    // eslint-disable-next-line no-console\n    console.log('Unsupported Browser');\n    return;\n  }\n\n  if (typeof uidDomain === 'undefined') {\n    uidDomain = 'default';\n  }\n  if (typeof prodId === 'undefined') {\n    prodId = 'Calendar';\n  }\n\n  const SEPARATOR = navigator.appVersion.indexOf('Win') !== -1 ? '\\r\\n' : '\\n';\n  const calendarEvents = [];\n  const calendarStart = [\n    'BEGIN:VCALENDAR',\n    `PRODID:${prodId}`,\n    'VERSION:2.0',\n  ].join(SEPARATOR);\n  const calendarEnd = `${SEPARATOR}END:VCALENDAR`;\n  const BYDAY_VALUES = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];\n\n  return {\n    /**\n     * Returns events array\n     * @return {array} Events\n     */\n    events() {\n      return calendarEvents;\n    },\n\n    /**\n     * Returns calendar\n     * @return {string} Calendar in iCalendar format\n     */\n    calendar() {\n      return (\n        calendarStart + SEPARATOR + calendarEvents.join(SEPARATOR) + calendarEnd\n      );\n    },\n\n    /**\n     * Add event to the calendar\n     * @param  {string} subject     Subject/Title of event\n     * @param  {string} description Description of event\n     * @param  {string} location    Location of event\n     * @param  {string} begin       Beginning date of event\n     * @param  {string} stop        Ending date of event\n     */\n    addEvent(subject, description, location, begin, stop, rrule) {\n      // I'm not in the mood to make these optional... So they are all required\n      if (\n        typeof subject === 'undefined' ||\n        typeof description === 'undefined' ||\n        typeof location === 'undefined' ||\n        typeof begin === 'undefined' ||\n        typeof stop === 'undefined'\n      ) {\n        return false;\n      }\n\n      // validate rrule\n      if (rrule) {\n        if (!rrule.rrule) {\n          if (\n            rrule.freq !== 'YEARLY' &&\n            rrule.freq !== 'MONTHLY' &&\n            rrule.freq !== 'WEEKLY' &&\n            rrule.freq !== 'DAILY'\n          ) {\n            throw new Error(\n              \"Recurrence rrule frequency must be provided and be one of the following: 'YEARLY', 'MONTHLY', 'WEEKLY', or 'DAILY'\"\n            );\n          }\n\n          if (rrule.until) {\n            if (Number.isNaN(Date.parse(rrule.until))) {\n              throw new Error(\n                \"Recurrence rrule 'until' must be a valid date string\"\n              );\n            }\n          }\n\n          if (rrule.interval) {\n            if (Number.isNaN(parseInt(rrule.interval, 10))) {\n              throw new Error(\"Recurrence rrule 'interval' must be an integer\");\n            }\n          }\n\n          if (rrule.count) {\n            if (Number.isNaN(parseInt(rrule.count, 10))) {\n              throw new Error(\"Recurrence rrule 'count' must be an integer\");\n            }\n          }\n\n          if (typeof rrule.byday !== 'undefined') {\n            if (\n              Object.prototype.toString.call(rrule.byday) !== '[object Array]'\n            ) {\n              throw new Error(\"Recurrence rrule 'byday' must be an array\");\n            }\n\n            if (rrule.byday.length > 7) {\n              throw new Error(\n                \"Recurrence rrule 'byday' array must not be longer than the 7 days in a week\"\n              );\n            }\n\n            // Filter any possible repeats\n            rrule.byday = rrule.byday.filter((elem, pos) => {\n              return rrule.byday.indexOf(elem) === pos;\n            });\n\n            for (const d in rrule.byday) {\n              if (BYDAY_VALUES.indexOf(rrule.byday[d]) < 0) {\n                throw new Error(\n                  \"Recurrence rrule 'byday' values must include only the following: 'SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'\"\n                );\n              }\n            }\n          }\n        }\n      }\n\n      // TODO add time and time zone? use moment to format?\n      const start_date = new Date(begin);\n      const end_date = new Date(stop);\n      const now_date = new Date();\n\n      const start_year = `0000${start_date.getFullYear().toString()}`.slice(-4);\n      const start_month = `00${(start_date.getMonth() + 1).toString()}`.slice(\n        -2\n      );\n      const start_day = `00${start_date.getDate().toString()}`.slice(-2);\n      const start_hours = `00${start_date.getHours().toString()}`.slice(-2);\n      const start_minutes = `00${start_date.getMinutes().toString()}`.slice(-2);\n      const start_seconds = `00${start_date.getSeconds().toString()}`.slice(-2);\n\n      const end_year = `0000${end_date.getFullYear().toString()}`.slice(-4);\n      const end_month = `00${(end_date.getMonth() + 1).toString()}`.slice(-2);\n      const end_day = `00${end_date.getDate().toString()}`.slice(-2);\n      const end_hours = `00${end_date.getHours().toString()}`.slice(-2);\n      const end_minutes = `00${end_date.getMinutes().toString()}`.slice(-2);\n      const end_seconds = `00${end_date.getSeconds().toString()}`.slice(-2);\n\n      const now_year = `0000${now_date.getFullYear().toString()}`.slice(-4);\n      const now_month = `00${(now_date.getMonth() + 1).toString()}`.slice(-2);\n      const now_day = `00${now_date.getDate().toString()}`.slice(-2);\n      const now_hours = `00${now_date.getHours().toString()}`.slice(-2);\n      const now_minutes = `00${now_date.getMinutes().toString()}`.slice(-2);\n      const now_seconds = `00${now_date.getSeconds().toString()}`.slice(-2);\n\n      let start_time = '';\n      let end_time = '';\n      if (\n        start_hours +\n          start_minutes +\n          start_seconds +\n          end_hours +\n          end_minutes +\n          end_seconds !==\n        0\n      ) {\n        start_time = `T${start_hours}${start_minutes}${start_seconds}`;\n        end_time = `T${end_hours}${end_minutes}${end_seconds}`;\n      }\n      const now_time = `T${now_hours}${now_minutes}${now_seconds}`;\n\n      const start = start_year + start_month + start_day + start_time;\n      const end = end_year + end_month + end_day + end_time;\n      const now = now_year + now_month + now_day + now_time;\n\n      // recurrence rrule vars\n      let rruleString;\n      if (rrule) {\n        if (rrule.rrule) {\n          rruleString = rrule.rrule;\n        } else {\n          rruleString = `RRULE:FREQ=${rrule.freq}`;\n\n          if (rrule.until) {\n            const uDate = new Date(Date.parse(rrule.until)).toISOString();\n            rruleString += `;UNTIL=${uDate\n              .substring(0, uDate.length - 13)\n              .replace(/[-]/g, '')}000000Z`;\n          }\n\n          if (rrule.interval) {\n            rruleString += `;INTERVAL=${rrule.interval}`;\n          }\n\n          if (rrule.count) {\n            rruleString += `;COUNT=${rrule.count}`;\n          }\n\n          if (rrule.byday && rrule.byday.length > 0) {\n            rruleString += `;BYDAY=${rrule.byday.join(',')}`;\n          }\n        }\n      }\n\n      // var stamp = new Date().toISOString();\n\n      let calendarEvent = [\n        'BEGIN:VEVENT',\n        `UID:${calendarEvents.length}@${uidDomain}`,\n        'CLASS:PUBLIC',\n        `DESCRIPTION:${description}`,\n        `DTSTAMP;VALUE=DATE-TIME:${now}`,\n        `DTSTART;VALUE=DATE-TIME:${start}`,\n        `DTEND;VALUE=DATE-TIME:${end}`,\n        `LOCATION:${location}`,\n        `SUMMARY;LANGUAGE=en-us:${subject}`,\n        'TRANSP:TRANSPARENT',\n        'END:VEVENT',\n      ];\n\n      if (rruleString) {\n        calendarEvent.splice(4, 0, rruleString);\n      }\n\n      calendarEvent = calendarEvent.join(SEPARATOR);\n\n      calendarEvents.push(calendarEvent);\n      return calendarEvent;\n    },\n\n    /**\n     * Download calendar using the saveAs function from filesave.js\n     * @param  {string} filename Filename\n     * @param  {string} ext      Extention\n     */\n    download(filename, ext) {\n      if (calendarEvents.length < 1) {\n        return false;\n      }\n\n      ext = typeof ext !== 'undefined' ? ext : '.ics';\n      filename = typeof filename !== 'undefined' ? filename : 'calendar';\n      const calendar =\n        calendarStart +\n        SEPARATOR +\n        calendarEvents.join(SEPARATOR) +\n        calendarEnd;\n\n      let blob;\n      if (navigator.userAgent.indexOf('MSIE 10') === -1) {\n        // chrome or firefox\n        blob = new Blob([calendar]);\n      } else {\n        // ie\n        const bb = new BlobBuilder();\n        bb.append(calendar);\n        blob = bb.getBlob(`text/x-vCalendar;charset=${document.characterSet}`);\n      }\n      saveAs(blob, filename + ext);\n      return calendar;\n    },\n\n    /**\n     * Build and return the ical contents\n     */\n    build() {\n      if (calendarEvents.length < 1) {\n        return false;\n      }\n\n      const calendar =\n        calendarStart +\n        SEPARATOR +\n        calendarEvents.join(SEPARATOR) +\n        calendarEnd;\n\n      return calendar;\n    },\n  };\n};\n\nexport default ics;\n","import React from 'react';\nimport { IBackOffOptions } from 'exponential-backoff';\nimport { DelayFactory } from 'exponential-backoff/dist/delay/delay.factory';\nimport { getSanitizedOptions } from 'exponential-backoff/dist/options';\nimport domtoimage from 'dom-to-image';\nimport { saveAs } from 'file-saver';\n\nimport { Oscar, Section } from '../data/beans';\nimport { DAYS, PALETTE, PNG_SCALE_FACTOR } from '../constants';\nimport { ErrorWithFields, softError } from '../log';\nimport { ICS, Period, PrerequisiteClause, Theme } from '../types';\nimport ics from '../vendor/ics';\n\nexport const stringToTime = (string: string): number => {\n  const regexResult = /(\\d{1,2}):(\\d{2}) (a|p)m/.exec(string);\n  if (regexResult === null) return 0;\n  const [, hour, minute, ampm] = regexResult as unknown as [\n    string,\n    string,\n    string,\n    string\n  ];\n  return ((ampm === 'p' ? 12 : 0) + (+hour % 12)) * 60 + +minute;\n};\n\nexport const timeToString = (time: number, ampm = true): string => {\n  const hour = (time / 60) | 0;\n  const minute = time % 60;\n  const hh = hour > 12 ? hour - 12 : hour;\n  const mm = `${minute}`.padStart(2, '0');\n  const A = `${hour < 12 ? 'a' : 'p'}m`;\n  return ampm ? `${hh}:${mm} ${A}` : `${hh}:${mm}`;\n};\n\nexport const timeToShortString = (time: number): string => {\n  const hour = (time / 60) | 0;\n  return `${hour > 12 ? hour - 12 : hour}${hour < 12 ? 'a' : 'p'}m`;\n};\n\nexport const periodToString = (period: Period | undefined): string =>\n  period != null\n    ? `${timeToString(period.start, false)} - ${timeToString(period.end)}`\n    : 'TBA';\n\nexport const getRandomColor = (): string => {\n  const colors = PALETTE.flat();\n  const index = (Math.random() * colors.length) | 0;\n  return colors[index] ?? '#333333';\n};\n\nexport const getContentClassName = (color: string | undefined): string => {\n  if (color == null) return 'light-content';\n  const r = parseInt(color.substring(1, 3), 16);\n  const g = parseInt(color.substring(3, 5), 16);\n  const b = parseInt(color.substring(5, 7), 16);\n  return r * 0.299 + g * 0.587 + b * 0.114 > 128\n    ? 'light-content'\n    : 'dark-content';\n};\n\nexport const hasConflictBetween = (\n  section1: Section,\n  section2: Section\n): boolean =>\n  section1.meetings.some((meeting1) =>\n    section2.meetings.some(\n      (meeting2) =>\n        meeting1.period &&\n        meeting2.period &&\n        DAYS.some(\n          (day) => meeting1.days.includes(day) && meeting2.days.includes(day)\n        ) &&\n        meeting1.period.start < meeting2.period.end &&\n        meeting2.period.start < meeting1.period.end\n    )\n  );\n\nexport const classes = (\n  ...classList: (string | boolean | null | undefined)[]\n): string => classList.filter((c) => c).join(' ');\n\nexport const isMobile = (): boolean => window.innerWidth < 1024;\n\nexport const simplifyName = (name: string): string => {\n  const tokens = name.split(' ');\n  const firstName = tokens.shift();\n  const lastName = tokens.pop();\n  return [firstName, lastName].join(' ');\n};\n\nexport function unique<T>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport const isLab = (section: Section): boolean =>\n  ['Lab', 'Studio'].some((type) => section.scheduleType.includes(type));\n\nexport const isLecture = (section: Section): boolean =>\n  section.scheduleType.includes('Lecture');\n\nexport function humanizeArray<T>(array: T[], conjunction = 'and'): string {\n  if (array.length <= 2) {\n    return array.join(` ${conjunction} `);\n  }\n  const init = [...array];\n  const last = init.pop();\n  return `${init.join(', ')}, ${conjunction} ${String(last)}`;\n}\n\nexport function humanizeArrayReact<T>(\n  array: T[],\n  conjunction: React.ReactNode = 'and'\n): React.ReactNode {\n  if (array.length === 0) {\n    return null;\n  }\n  if (array.length === 1) {\n    return String(array[0]);\n  }\n  if (array.length === 2) {\n    return (\n      <>\n        {String(array[0])} {conjunction} {String(array[1])}\n      </>\n    );\n  }\n\n  const init = [...array];\n  const last = init.pop();\n  return (\n    <>\n      {`${init.join(', ')},`.trim()} {conjunction} {String(last)}\n    </>\n  );\n}\n\nexport const serializePrereqs = (\n  reqs: PrerequisiteClause,\n  openPar = false,\n  closePar = false\n): string => {\n  // This function accepts the index of a sub-clause\n  // from the sub-clause slice of a compound prereq clause\n  // (i.e. the [...sub-clauses] part of a clause\n  // that itself is of the form [operator, ...sub-clauses]).\n  // As such, we compare to the clause length - 2\n  // (since the sub-clauses[0] is really reqs[1])\n  const last = (i: number): boolean =>\n    Array.isArray(reqs) && i === reqs.length - 2;\n  let string = '';\n\n  if (!Array.isArray(reqs)) {\n    string += (openPar ? '(' : '') + reqs.id + (closePar ? ')' : '');\n  } else if (reqs[0] === 'and') {\n    const [, ...subClauses] = reqs;\n    subClauses.forEach((req, i) => {\n      string +=\n        serializePrereqs(req, i === 0, last(i)) + (last(i) ? '' : ' and ');\n    });\n  } else if (reqs[0] === 'or') {\n    const [, ...subClauses] = reqs;\n    subClauses.forEach((req, i) => {\n      string += serializePrereqs(req) + (last(i) ? '' : ' or ');\n    });\n  }\n\n  return string;\n};\n\n// Determines whether an error is an axios network error,\n// which is used when determining whether to send it to Sentry\n// (since we can't do anything about a client-side NetworkError)--\n// it's either an error in the user's network\n// or downtime in a third-party service.\nexport const isAxiosNetworkError = (err: unknown): boolean => {\n  return err instanceof Error && err.message.includes('Network Error');\n};\n\n/**\n * Sleeps for a delay controlled by an exponential backoff function with jitter.\n * Acts as a thin wrapper around `exponential-backoff`\n * that provides a lower-level API\n * @param attemptNumber - The number of attempts that have occurred so far\n * @param options - [optional] config for exponential-backoff\n */\nexport async function exponentialBackoff(\n  attemptNumber: number,\n  options: Partial<IBackOffOptions> = {}\n): Promise<void> {\n  await DelayFactory(\n    getSanitizedOptions({\n      // See https://github.com/coveooss/exponential-backoff for options API\n      jitter: 'full',\n      numOfAttempts: Number.MAX_SAFE_INTEGER,\n      ...options,\n    }),\n    attemptNumber\n  ).apply();\n}\n\n/**\n * Promise version of `setTimeout`; used to wait for a specific delay\n */\nexport async function sleep({\n  amount_ms,\n}: {\n  amount_ms: number;\n}): Promise<void> {\n  await new Promise((resolve) =>\n    setTimeout(() => resolve(undefined), amount_ms)\n  );\n}\n\n/**\n * Exports the current schedule to a `.ics` file,\n * which allows for importing into a third-party calendar application.\n */\nexport function exportCoursesToCalendar(\n  oscar: Oscar,\n  pinnedCrns: readonly string[]\n): void {\n  const cal = ics() as ICS | undefined;\n  if (cal == null) {\n    window.alert('This browser does not support calendar export');\n    softError(\n      new ErrorWithFields({\n        message: 'ics() returned null or undefined',\n      })\n    );\n\n    return;\n  }\n\n  pinnedCrns.forEach((crn) => {\n    const section = oscar.findSection(crn);\n    if (section == null) return;\n\n    section.meetings.forEach((meeting) => {\n      if (!meeting.period || !meeting.days.length) return;\n      const { from, to } = meeting.dateRange;\n      const subject = section.course.id;\n      const description = section.course.title;\n      const location = meeting.where;\n      const begin = new Date(from.getTime());\n      while (\n        !meeting.days.includes(\n          ['-', 'M', 'T', 'W', 'R', 'F', '-'][begin.getDay()] ?? '-'\n        )\n      ) {\n        begin.setDate(begin.getDate() + 1);\n      }\n      begin.setHours(meeting.period.start / 60, meeting.period.start % 60);\n      const end = new Date(begin.getTime());\n      end.setHours(meeting.period.end / 60, meeting.period.end % 60);\n      const rrule = {\n        freq: 'WEEKLY',\n        until: to,\n        byday: meeting.days\n          .map(\n            (day) =>\n              ({ M: 'MO', T: 'TU', W: 'WE', R: 'TH', F: 'FR' }[day] ?? null)\n          )\n          .filter((day) => !!day),\n      };\n      cal.addEvent(subject, description, location, begin, end, rrule);\n    });\n  });\n  cal.download('gt-scheduler');\n}\n\n/**\n * Downloads a screenshot of the \"shadow\" calendar\n * that exists invisible in the app\n * and reflects the current state of the scheduler.\n * Allows the screenshot to be exported consistently\n * regardless of screen size or app state.\n * Requires the theme to style the background before taking the screenshot.\n */\nexport function downloadShadowCalendar(\n  captureElement: HTMLDivElement,\n  theme: Theme\n): void {\n  const computed = window\n    .getComputedStyle(captureElement)\n    .getPropertyValue('left');\n\n  domtoimage\n    .toBlob(captureElement, {\n      width: captureElement.offsetWidth * PNG_SCALE_FACTOR,\n      height: captureElement.offsetHeight * PNG_SCALE_FACTOR,\n      style: {\n        transform: `scale(${PNG_SCALE_FACTOR})`,\n        'transform-origin': `${computed} 0px`,\n        'background-color': theme === 'light' ? '#FFFFFF' : '#333333',\n      },\n    })\n    .then((blob) => saveAs(blob, 'schedule.png'))\n    .catch((err) =>\n      softError(\n        new ErrorWithFields({\n          message:\n            'could not take screenshot of shadow calendar for schedule export',\n          source: err,\n        })\n      )\n    );\n}\n\nexport const PRIMARY_VERSION_NAME = 'Primary';\nconst OTHER_VERSIONS_NAMES = [\n  'Secondary',\n  'Tertiary',\n  'Quaternary',\n  'Quinary',\n  'Senary',\n  'Septenary',\n  'Octonary',\n  'Nonary',\n  'Denary',\n];\n\n/**\n * Gets the next auto-generated version name in the sequence of\n * Primary, Secondary, Tertiary, ...\n * all the way up to the name for the 10th item (Denary)\n * before returning \"New version\".\n * If the array is empty, then it always returns 'Primary'.\n * Otherwise, it will return the first item in the sequence,\n * starting with 'Secondary' (meaning that it will always skip 'Primary',\n * even if it's not an element in the given list)\n */\nexport function getNextVersionName(allVersionNames: readonly string[]): string {\n  const allNamesSet: Set<string> = new Set(allVersionNames);\n  if (allNamesSet.size === 0) return PRIMARY_VERSION_NAME;\n\n  for (const version of OTHER_VERSIONS_NAMES) {\n    if (!allNamesSet.has(version)) {\n      return version;\n    }\n  }\n\n  // Fall back to the default with over 10 versions\n  return 'New version';\n}\n\n/**\n * Generates a random alpha-numeric string of the given length.\n * Contains the characters A-Z, a-z, and 0-9.\n */\nexport function generateRandomId(length: number): string {\n  const charPool =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += charPool[Math.floor(Math.random() * charPool.length)];\n  }\n  return result;\n}\n\n/**\n * Lexicographically compares two strings (usable as a comparator function).\n * Based on:\n * https://riptutorial.com/javascript/example/5388/comparing-strings-lexicographically\n */\nexport function lexicographicCompare(a: string, b: string): number {\n  if (a === b) {\n    return 0;\n  }\n\n  if (a > b) {\n    return 1;\n  }\n\n  return -1;\n}\n","import React from 'react';\n\nimport { classes } from '../../utils/misc';\n\nimport './stylesheet.scss';\n\nexport type ButtonProps = {\n  className?: string;\n  disabled?: boolean;\n  href?: string;\n  onClick?: (e: React.SyntheticEvent<HTMLDivElement>) => void;\n  children?: React.ReactNode;\n};\n\nexport default function Button({\n  className,\n  disabled = false,\n  href,\n  onClick,\n  children,\n}: ButtonProps): React.ReactElement {\n  if (disabled)\n    return (\n      <div className={classes('Button', 'disabled', className)}>{children}</div>\n    );\n\n  if (href != null)\n    return (\n      <a\n        className={classes('Button', className)}\n        href={href}\n        rel=\"noopener noreferrer\"\n        target=\"_blank\"\n      >\n        {children}\n      </a>\n    );\n\n  return (\n    <div\n      className={classes('Button', className)}\n      onClick={onClick}\n      tabIndex={0}\n      onKeyDown={(event): void => {\n        // Intercept enter presses\n        if (event.key === 'Enter' && onClick != null) onClick(event);\n      }}\n      role=\"button\"\n    >\n      {children}\n    </div>\n  );\n}\n","import React from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { classes } from '../../utils/misc';\nimport Button, { ButtonProps } from '../Button';\n\nimport './stylesheet.scss';\n\ntype FontAwesomeProps = React.ComponentProps<typeof FontAwesomeIcon>;\nexport type Action = {\n  icon: FontAwesomeProps['icon'];\n  styling?: React.CSSProperties;\n  dataTip?: boolean;\n  dataFor?: string;\n  onMouseEnter?: () => void;\n  onMouseLeave?: () => void;\n} & Omit<ButtonProps, 'children'>;\n\ntype BaseActionRowProps = {\n  label: string;\n  actions: (Action | null | undefined)[];\n  className?: string;\n  children?: React.ReactNode;\n};\nexport type ActionRowProps = BaseActionRowProps &\n  Omit<React.HTMLAttributes<HTMLDivElement>, keyof BaseActionRowProps>;\n\nexport default function ActionRow({\n  className,\n  label,\n  children,\n  actions,\n  ...restProps\n}: ActionRowProps): React.ReactElement {\n  return (\n    <div className={classes('ActionRow', className)} {...restProps}>\n      <div className=\"action-row-header\">\n        <div className=\"label\">{label}</div>\n        <div className={classes('actions', 'default')}>\n          {actions\n            .flatMap((action) => (action != null ? [action] : []))\n            .map(\n              (\n                {\n                  icon,\n                  styling,\n                  dataTip,\n                  dataFor,\n                  onMouseEnter,\n                  onMouseLeave,\n                  ...rest\n                },\n                i\n              ) => (\n                <Button className=\"action\" {...rest} key={i}>\n                  <FontAwesomeIcon\n                    fixedWidth\n                    style={styling}\n                    icon={icon}\n                    data-tip={dataTip}\n                    data-for={dataFor}\n                    onMouseEnter={onMouseEnter}\n                    onMouseLeave={onMouseLeave}\n                  />\n                </Button>\n              )\n            )}\n        </div>\n      </div>\n      {children}\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { ErrorWithFields } from '../log';\nimport { Theme } from '../types';\n\nexport type ThemeContextValue = [Theme, (next: Theme) => void];\nexport const ThemeContext = React.createContext<ThemeContextValue>([\n  'light',\n  (next: Theme): void => {\n    throw new ErrorWithFields({\n      message: 'empty ThemeContext.setTheme value being used',\n      fields: {\n        next,\n      },\n    });\n  },\n]);\n","import React from 'react';\n\nexport type TermsContextValue = readonly string[];\nexport const TermsContext = React.createContext<TermsContextValue>([]);\n","import axios from 'axios';\n\nimport { Oscar, Section } from '.';\nimport {\n  CourseGpa,\n  CrawlerCourse,\n  CrawlerPrerequisites,\n  Period,\n} from '../../types';\nimport {\n  hasConflictBetween,\n  isLab,\n  isLecture,\n  isAxiosNetworkError,\n} from '../../utils/misc';\nimport { ErrorWithFields, softError } from '../../log';\n\n// This is actually a transparent read-through cache\n// in front of the Course Critique API's course data endpoint,\n// but it should behave the same as the real API.\n// See the implementation at:\n// https://github.com/gt-scheduler/firebase-conf/blob/main/functions/src/course_critique_cache.ts\nconst COURSE_CRITIQUE_API_URL =\n  'https://us-central1-gt-scheduler-web-prod.cloudfunctions.net/getCourseDataFromCourseCritique';\n\nconst GPA_CACHE_LOCAL_STORAGE_KEY = 'course-gpa-cache-2';\nconst GPA_CACHE_EXPIRATION_DURATION_DAYS = 7;\n\ninterface SectionGroupMeeting {\n  days: string[];\n  period: Period | undefined;\n}\n\ninterface SectionGroup {\n  /**\n   * Equal to`JSON.stringify(this.sectionGroupMeetings)`\n   */\n  hash: string;\n  meetings: SectionGroupMeeting[];\n  sections: Section[];\n}\n\nexport default class Course {\n  id: string;\n\n  subject: string;\n\n  number: string;\n\n  title: string;\n\n  sections: Section[];\n\n  prereqs: CrawlerPrerequisites | undefined;\n\n  hasLab: boolean;\n\n  onlyLectures: Section[] | undefined;\n\n  onlyLabs: Section[] | undefined;\n\n  allInOnes: Section[] | undefined;\n\n  sectionGroups: Record<string, SectionGroup> | undefined;\n\n  term: string;\n\n  constructor(oscar: Oscar, courseId: string, data: CrawlerCourse) {\n    this.term = oscar.term;\n    const [title, sections, prereqs] = data;\n\n    this.id = courseId;\n    const [subject, number] = this.id.split(' ');\n    if (subject == null || number == null) {\n      throw new ErrorWithFields({\n        message: 'course ID could not be parsed',\n        fields: {\n          id: this.id,\n          subject,\n          number,\n          term: this.term,\n        },\n      });\n    }\n    this.subject = subject;\n    this.number = number;\n\n    this.title = title;\n    this.sections = Object.entries(sections).flatMap<Section>(\n      ([sectionId, sectionData]) => {\n        if (sectionData == null) return [];\n        try {\n          return [new Section(oscar, this, sectionId, sectionData)];\n        } catch (err) {\n          softError(\n            new ErrorWithFields({\n              message: 'could not construct Section bean',\n              source: err,\n              fields: {\n                courseId,\n                term: this.term,\n              },\n            })\n          );\n          return [];\n        }\n      }\n    );\n    this.prereqs = prereqs;\n\n    const onlyLectures = this.sections.filter(\n      (section) => isLecture(section) && !isLab(section)\n    );\n    const onlyLabs = this.sections.filter(\n      (section) => isLab(section) && !isLecture(section)\n    );\n    this.hasLab = !!onlyLectures.length && !!onlyLabs.length;\n    if (this.hasLab) {\n      const matchLabFromId = (lab: Section, lecture: Section): boolean =>\n        // note: checking both ways because GT registrar\n        // reversed studio and lecture sections for MATH 1553\n        lecture.id.startsWith(lab.id) || lab.id.startsWith(lecture.id);\n      const matchLabFromInstructors = (\n        lab: Section,\n        lecture: Section\n      ): boolean =>\n        // match lecture and lab sections\n        // if there are *any* matching instructors\n        // fixes issue with PHYS 2211 and 2212\n        // no longer matching section id letters\n        lab.instructors.filter((instructor) =>\n          lecture.instructors.includes(instructor)\n        ).length > 0;\n\n      for (const lecture of onlyLectures) {\n        lecture.associatedLabs = onlyLabs.filter((lab) =>\n          matchLabFromId(lab, lecture)\n        );\n        // if no matching section id letters found, match by profs\n        if (!lecture.associatedLabs.length) {\n          lecture.associatedLabs = onlyLabs.filter((lab) =>\n            matchLabFromInstructors(lab, lecture)\n          );\n        }\n      }\n      for (const lab of onlyLabs) {\n        lab.associatedLectures = onlyLectures.filter((lecture) =>\n          matchLabFromId(lab, lecture)\n        );\n        if (!lab.associatedLectures.length) {\n          lab.associatedLectures = onlyLectures.filter((lecture) =>\n            matchLabFromInstructors(lab, lecture)\n          );\n        }\n      }\n      const lonelyLectures = onlyLectures.filter(\n        (lecture) => !lecture.associatedLabs.length\n      );\n      const lonelyLabs = onlyLabs.filter(\n        (lab) => !lab.associatedLectures.length\n      );\n      for (const lecture of lonelyLectures) {\n        lecture.associatedLabs = lonelyLabs.filter(\n          (lab) => !hasConflictBetween(lecture, lab)\n        );\n      }\n      for (const lab of lonelyLabs) {\n        lab.associatedLectures = lonelyLectures.filter(\n          (lecture) => !hasConflictBetween(lecture, lab)\n        );\n      }\n      this.onlyLectures = onlyLectures;\n      this.onlyLabs = onlyLabs;\n      this.allInOnes = this.sections.filter(\n        (section) => isLecture(section) && isLab(section)\n      );\n    } else {\n      this.sectionGroups = this.distinct(this.sections);\n    }\n  }\n\n  distinct(sections: Section[]): Record<string, SectionGroup> {\n    const groups: Record<string, SectionGroup> = {};\n    sections.forEach((section) => {\n      const sectionGroupMeetings = section.meetings.map<SectionGroupMeeting>(\n        ({ days, period }) => ({\n          days,\n          period,\n        })\n      );\n      const sectionGroupHash = JSON.stringify(sectionGroupMeetings);\n      const sectionGroup = groups[sectionGroupHash];\n      if (sectionGroup) {\n        sectionGroup.sections.push(section);\n      } else {\n        groups[sectionGroupHash] = {\n          hash: sectionGroupHash,\n          meetings: sectionGroupMeetings,\n          sections: [section],\n        };\n      }\n    });\n    return groups;\n  }\n\n  async fetchGpa(): Promise<CourseGpa> {\n    // Note: if `CourseGpa` ever changes,\n    // the cache needs to be invalidated\n    // (by changing the local storage key).\n    type GpaCache = Record<string, GpaCacheItem>;\n    interface GpaCacheItem {\n      d: CourseGpa;\n      exp: string;\n    }\n\n    // Try to look in the cache for a cached course gpa item\n    // that has not expired.\n    // If it is expired, we don't evict; we just ignore it\n    // (and update it with a fresh expiry once it has been fetched).\n    // The size of the cache may bloat over time, but shouldn't be substantial.\n    try {\n      const rawCache = window.localStorage.getItem(GPA_CACHE_LOCAL_STORAGE_KEY);\n      if (rawCache != null) {\n        const cache: GpaCache = JSON.parse(rawCache) as unknown as GpaCache;\n        const cacheItem = cache[this.id];\n        if (cacheItem != null) {\n          const now = new Date().toISOString();\n          // Use lexicographic comparison on date strings\n          // (since they are ISO 8601)\n          if (now < cacheItem.exp) {\n            return cacheItem.d;\n          }\n        }\n      }\n    } catch (err) {\n      // Ignore\n    }\n\n    // Fetch the GPA normally\n    const courseGpa = await this.fetchGpaInner();\n    if (courseGpa === null) {\n      // There was a failure; don't store the value in the cache.\n      return {};\n    }\n\n    // Store the GPA in the cache\n    const exp = new Date();\n    exp.setDate(exp.getDate() + GPA_CACHE_EXPIRATION_DURATION_DAYS);\n    try {\n      let cache: GpaCache = {};\n      const rawCache = window.localStorage.getItem(GPA_CACHE_LOCAL_STORAGE_KEY);\n      if (rawCache != null) {\n        cache = JSON.parse(rawCache) as unknown as GpaCache;\n      }\n\n      cache[this.id] = { d: courseGpa, exp: exp.toISOString() };\n      const rawUpdatedCache = JSON.stringify(cache);\n      window.localStorage.setItem(GPA_CACHE_LOCAL_STORAGE_KEY, rawUpdatedCache);\n    } catch (err) {\n      // Ignore\n    }\n\n    return courseGpa;\n  }\n\n  /**\n   * Fetches the course GPA without caching it\n   * @see `fetchGpa` for the persistent-caching version\n   * @returns the course GPA if successfully fetched from course critique,\n   * or `null` if there was a problem.\n   * Note that the empty object `{}` is a valid course GPA value,\n   * but we prefer returning `null` if there was a failure\n   * so we can avoid storing the empty GPA value in the persistent cache.\n   */\n  private async fetchGpaInner(): Promise<CourseGpa | null> {\n    // We have to clean up the course ID before sending it to the API,\n    // since courses like CHEM 1212K should become CHEM 1212\n    const id = `${this.subject} ${this.number.replace(/\\D/g, '')}`;\n    const encodedCourse = encodeURIComponent(id);\n    const url = `${COURSE_CRITIQUE_API_URL}?courseID=${encodedCourse}`;\n\n    let responseData: CourseDetailsAPIResponse;\n    try {\n      responseData = (await axios.get<CourseDetailsAPIResponse>(url)).data;\n    } catch (err) {\n      // Ignore network errors\n      if (!isAxiosNetworkError(err)) {\n        softError(\n          new ErrorWithFields({\n            message: 'error fetching course details from Course Critique API',\n            source: err,\n            fields: {\n              baseId: this.id,\n              cleanedId: id,\n              url,\n            },\n          })\n        );\n      }\n\n      return null;\n    }\n\n    return this.decodeCourseCritiqueResponse(responseData);\n  }\n\n  private decodeCourseCritiqueResponse(\n    responseData: CourseDetailsAPIResponse\n  ): CourseGpa | null {\n    // Calculate the overall course GPA and instructor-specific GPAs\n    // from the response.\n    // The API response does not actually include these values;\n    // instead, it provides GPA information on a per-historical-section-basis,\n    // so we have to aggregate this here.\n    // As of 2021-11-06, this is also what Course Critique does\n    // to determine overall course GPA and instructor-specific GPAs,\n    // so there doesn't seem to be a better way\n    // (this method is likely inaccurate).\n\n    type IntermediateWeightedAverage = {\n      count: number;\n      sum: number;\n    };\n\n    try {\n      const overall: IntermediateWeightedAverage = { count: 0, sum: 0 };\n      const instructors: Map<string, IntermediateWeightedAverage> = new Map();\n\n      responseData.raw.forEach((historicalSectionData) => {\n        const {\n          class_size_group: classSizeGroup,\n          instructor_name: rawInstructorName,\n          GPA: gpa,\n        } = historicalSectionData;\n\n        if (typeof classSizeGroup !== 'string') return;\n        if (typeof rawInstructorName !== 'string') return;\n        if (typeof gpa !== 'number') return;\n\n        // Map the class size group to an estimate\n        // of the number of actual students.\n        // This is used as the weight when the average GPA for this section\n        // is added to the overall course GPA and instructor-specific GPAs,\n        // but it's just a best-estimate and makes the GPAs inaccurate.\n        // As of 2021-11-06, these are the same estimates\n        // that Course Critique uses in their app\n        // (used here since ideally GT Scheduler should report the same GPAs).\n        let classSizeEstimate: number;\n        switch (classSizeGroup.toLowerCase()) {\n          case 'very small (fewer than 10 students)':\n            classSizeEstimate = 5;\n            break;\n          case 'small (10-20 students)':\n            classSizeEstimate = 15;\n            break;\n          case 'mid-size (21-30 students)':\n            classSizeEstimate = 25;\n            break;\n          case 'large (31-49 students)':\n            classSizeEstimate = 40;\n            break;\n          case 'very large (50 students or more)':\n            classSizeEstimate = 50;\n            break;\n          default:\n            // Unknown class size group; skip this section\n            return;\n        }\n\n        // Normalize the instructor name from \"LN, FN\" to \"FN LN\"\n        let instructorName = rawInstructorName;\n        const nameSegments = instructorName.split(', ');\n        if (nameSegments.length === 2) {\n          const [lastName, firstName] = nameSegments as [string, string];\n          instructorName = `${firstName} ${lastName}`;\n        }\n\n        // Add the section GPA to the overall GPA\n        overall.count += classSizeEstimate;\n        overall.sum += gpa * classSizeEstimate;\n\n        // Add the section GPA to the instructor GPA\n        const instructorGpa = instructors.get(instructorName) ?? {\n          count: 0,\n          sum: 0,\n        };\n        instructorGpa.count += classSizeEstimate;\n        instructorGpa.sum += gpa * classSizeEstimate;\n        instructors.set(instructorName, instructorGpa);\n      });\n\n      // Now, finally compute the actual weighted averages\n      // and assemble the `CourseGpa` type:\n      const gpaMap: CourseGpa = {};\n      if (overall.count > 0) {\n        gpaMap.averageGpa = overall.sum / overall.count;\n      }\n      instructors.forEach((instructorGpa, instructorName) => {\n        if (instructorGpa.count > 0) {\n          gpaMap[instructorName] = instructorGpa.sum / instructorGpa.count;\n        }\n      });\n      return gpaMap;\n    } catch (err) {\n      softError(\n        new ErrorWithFields({\n          message:\n            'error extracting course GPA from Course Critique API response',\n          source: err,\n          fields: {\n            id: this.id,\n          },\n        })\n      );\n      return null;\n    }\n  }\n}\n\n// Based on response for CS 6035 on 2021-11-06\n// from the Course Critique API.\n// Each field has `| unknown` added to ensure\n// that we narrow the type before using them.\ninterface CourseDetailsAPIResponse {\n  header: [\n    {\n      course_name: string | null | unknown;\n      credits: number | null | unknown;\n      description: string | null | unknown;\n      full_name: string | null | unknown;\n    }\n  ];\n  raw: Array<{\n    instructor_gt_username: string | unknown;\n    instructor_name: string | unknown;\n    link: string | unknown;\n    class_size_group: string | unknown;\n    GPA: number | unknown;\n    A: number | unknown;\n    B: number | unknown;\n    C: number | unknown;\n    D: number | unknown;\n    F: number | unknown;\n    W: number | unknown;\n  }>;\n}\n","import axios from 'axios';\nimport cheerio from 'cheerio';\n\nimport { unique } from '../../utils/misc';\nimport { DELIVERY_MODES, BACKEND_BASE_URL } from '../../constants';\nimport Course from './Course';\nimport Oscar from './Oscar';\nimport { CrawlerMeeting, Meeting } from '../../types';\n\nexport type Seating = [\n  seating:\n    | [] // Loading state\n    | [\n        // Loaded state\n        seatsCurrent: number,\n        seatsTotal: number,\n        waitlistCurrent: number,\n        waitlistTotal: number\n      ]\n    | string[], // Error state\n  fetchTime: number\n];\n\ntype SectionConstructionData = [\n  crn: string,\n  meetings: CrawlerMeeting[],\n  credits: number,\n  scheduleTypeIndex: number,\n  campusIndex: number,\n  attributeIndices: number[],\n  gradeBasisIndex: number\n];\n\nexport default class Section {\n  course: Course;\n\n  id: string;\n\n  crn: string;\n\n  seating: Seating;\n\n  credits: number;\n\n  scheduleType: string;\n\n  campus: string;\n\n  deliveryMode: string | undefined;\n\n  gradeBasis: string;\n\n  meetings: Meeting[];\n\n  instructors: string[];\n\n  // This field is initialized after construction inside `Course.constructor`\n  associatedLabs: Section[];\n\n  // This field is initialized after construction inside `Course.constructor`\n  associatedLectures: Section[];\n\n  term: string;\n\n  constructor(\n    oscar: Oscar,\n    course: Course,\n    sectionId: string,\n    data: SectionConstructionData\n  ) {\n    this.term = oscar.term;\n    const [\n      crn,\n      meetings,\n      credits,\n      scheduleTypeIndex,\n      campusIndex,\n      attributeIndices,\n      gradeBasisIndex,\n    ] = data;\n\n    this.course = course;\n    this.id = sectionId;\n    this.crn = crn;\n    this.seating = [[], 0];\n    this.credits = credits;\n    this.scheduleType = oscar.scheduleTypes[scheduleTypeIndex] ?? 'unknown';\n    this.campus = oscar.campuses[campusIndex] ?? 'unknown';\n\n    const attributes = attributeIndices\n      .map((attributeIndex) => oscar.attributes[attributeIndex])\n      .flatMap((attribute) => (attribute == null ? [] : [attribute]));\n    this.deliveryMode = attributes.find(\n      (attribute) => attribute in DELIVERY_MODES\n    );\n\n    this.gradeBasis = oscar.gradeBases[gradeBasisIndex] ?? 'unknown';\n    this.meetings = meetings.map<Meeting>(\n      ([\n        periodIndex,\n        days,\n        where,\n        locationIndex,\n        instructors,\n        dateRangeIndex,\n      ]) => ({\n        period: oscar.periods[periodIndex],\n        days: days === '&nbsp;' ? [] : days.split(''),\n        where,\n        location: oscar.locations[locationIndex] ?? null,\n        instructors: instructors.map((instructor) =>\n          instructor.replace(/ \\(P\\)$/, '').trim()\n        ),\n        // We need some fallback here\n        dateRange: oscar.dateRanges[dateRangeIndex] ?? {\n          from: new Date(),\n          to: new Date(),\n        },\n      })\n    );\n    this.instructors = unique(\n      this.meetings\n        .map<string[]>(({ instructors }) => instructors)\n        .reduce((accum, instructors) => [...accum, ...instructors], [])\n    );\n\n    // These fields are initialized after construction\n    // inside `Course.constructor`\n    this.associatedLabs = [];\n    this.associatedLectures = [];\n  }\n\n  async fetchSeating(term: string): Promise<Seating> {\n    const prevDate = this.seating[1];\n    const currDate = Date.now();\n\n    if (currDate - prevDate > 300000) {\n      const url = `${BACKEND_BASE_URL}/proxy/class_section?term=${term}&crn=${this.crn}`;\n      return axios({\n        url,\n        method: 'get',\n        headers: {\n          'X-Requested-With': 'XMLHttpRequest',\n          'Content-Type': 'text/html',\n        },\n      })\n        .then((response) => {\n          const $ = cheerio.load(response.data);\n          const availabilityTable = $('.datadisplaytable .datadisplaytable');\n          const tableRow = availabilityTable.find('tr');\n\n          this.seating = [\n            [\n              parseInt(tableRow.eq(1).children('td').first().text(), 10),\n              parseInt(tableRow.eq(1).children('td').eq(1).text(), 10),\n              parseInt(tableRow.eq(2).children('td').first().text(), 10),\n              parseInt(tableRow.eq(2).children('td').eq(1).text(), 10),\n            ],\n            currDate,\n          ];\n\n          return this.seating;\n        })\n        .catch(() => [new Array(4).fill('N/A'), currDate]);\n    }\n    return this.seating;\n  }\n}\n","import { Combination } from '../../types';\n\nexport default class SortingOption {\n  label: string;\n\n  calculateFactor: (combo: Combination) => number;\n\n  constructor(label: string, calculateFactor: (combo: Combination) => number) {\n    this.label = label;\n    this.calculateFactor = calculateFactor;\n  }\n}\n","import { Course, Section, SortingOption } from '.';\nimport { hasConflictBetween, stringToTime } from '../../utils/misc';\nimport {\n  Combination,\n  Period,\n  DateRange,\n  Location,\n  CrawlerTermData,\n} from '../../types';\nimport { ErrorWithFields, softError } from '../../log';\n\n// `new Oscar(...)` gets the entirety of the crawler JSON data\ntype OscarConstructionDate = CrawlerTermData;\n\nexport default class Oscar {\n  periods: (Period | undefined)[];\n\n  dateRanges: DateRange[];\n\n  scheduleTypes: string[];\n\n  campuses: string[];\n\n  attributes: string[];\n\n  gradeBases: string[];\n\n  locations: (Location | null)[];\n\n  updatedAt: Date;\n\n  version: number;\n\n  courses: Course[];\n\n  courseMap: Record<string, Course>;\n\n  crnMap: Record<string, Section>;\n\n  sortingOptions: SortingOption[];\n\n  constructor(data: OscarConstructionDate, public term: string) {\n    const { courses, caches, updatedAt, version } = data;\n\n    this.periods = caches.periods.map((period, i) => {\n      if (period === 'TBA') {\n        return undefined;\n      }\n\n      const periodSegments = period.split(' - ');\n      if (periodSegments.length !== 2) {\n        softError(\n          new ErrorWithFields({\n            message: 'period did not follow expected format',\n            fields: {\n              period,\n              cacheIndex: i,\n              term: this.term,\n            },\n          })\n        );\n        return undefined;\n      }\n\n      const [start, end] = periodSegments as [string, string];\n      return {\n        start: stringToTime(start),\n        end: stringToTime(end),\n      };\n    });\n\n    this.dateRanges = caches.dateRanges.map((dateRange, i) => {\n      let segments = dateRange.split(' - ');\n      if (segments.length !== 2) {\n        softError(\n          new ErrorWithFields({\n            message: 'date range did not follow expected format',\n            fields: {\n              dateRange,\n              cacheIndex: i,\n              term: this.term,\n            },\n          })\n        );\n        // We need some fallback here\n        segments = ['Jan 1, 1970', 'Jan 2, 1970'];\n      }\n\n      const [from, to] = segments.map((v) => new Date(v)) as [Date, Date];\n      from.setHours(0);\n      to.setHours(23, 59, 59, 999);\n      return { from, to };\n    });\n\n    this.scheduleTypes = caches.scheduleTypes;\n    this.campuses = caches.campuses;\n    this.attributes = caches.attributes;\n    this.gradeBases = caches.gradeBases;\n    this.locations = caches.locations;\n    this.updatedAt = new Date(updatedAt);\n    this.version = version;\n\n    this.courses = Object.entries(courses).flatMap(([courseId, source]) => {\n      try {\n        return [new Course(this, courseId, source)];\n      } catch (err) {\n        softError(\n          new ErrorWithFields({\n            message: 'could not initialize Course bean',\n            fields: {\n              courseId,\n              source,\n              term: this.term,\n            },\n          })\n        );\n        return [];\n      }\n    });\n\n    this.courseMap = {};\n    this.crnMap = {};\n    this.courses.forEach((course) => {\n      this.courseMap[course.id] = course;\n      course.sections.forEach((section) => {\n        this.crnMap[section.crn] = section;\n      });\n    });\n\n    this.sortingOptions = [\n      new SortingOption('Most Compact', (combination) => {\n        const { startMap, endMap } = combination;\n        const diffs = Object.keys(startMap).map((day) => {\n          const end = endMap[day];\n          const start = startMap[day];\n          if (end == null || start == null) return 0;\n          return end - start;\n        });\n        const sum = diffs.reduce((tot, min) => tot + min, 0);\n        return +sum;\n      }),\n      new SortingOption('Earliest Ending', (combination) => {\n        const { endMap } = combination;\n        const ends = Object.values(endMap);\n        const sum = ends.reduce<number>((tot, end) => tot + (end ?? 0), 0);\n        const avg = sum / ends.length;\n        return +avg;\n      }),\n      new SortingOption('Latest Beginning', (combination) => {\n        const { startMap } = combination;\n        const starts = Object.values(startMap);\n        const sum = starts.reduce<number>((tot, min) => tot + (min ?? 0), 0);\n        const avg = sum / starts.length;\n        return -avg;\n      }),\n    ];\n  }\n\n  findCourse(courseId: string): Course | undefined {\n    return this.courseMap[courseId];\n  }\n\n  findSection(crn: string): Section | undefined {\n    return this.crnMap[crn];\n  }\n\n  getCombinations(\n    desiredCourses: readonly string[],\n    pinnedCrns: readonly string[],\n    excludedCrns: readonly string[]\n  ): Combination[] {\n    const crnsList: string[][] = [];\n    const dfs = (courseIndex = 0, crns: string[] = []): void => {\n      if (courseIndex === desiredCourses.length) {\n        crnsList.push(crns);\n        return;\n      }\n      const courseId = desiredCourses[courseIndex];\n      if (courseId === undefined) return;\n      const course = this.findCourse(courseId);\n      if (course === undefined) return;\n      const isIncluded = (section: Section): boolean =>\n        !excludedCrns.includes(section.crn);\n      const isPinned = (section: Section): boolean =>\n        pinnedCrns.includes(section.crn);\n      const hasConflict = (section: Section): boolean =>\n        [...pinnedCrns, ...crns].some((crn) => {\n          const crnSection = this.findSection(crn);\n          if (crnSection === undefined) return false;\n          return hasConflictBetween(crnSection, section);\n        });\n      if (course.hasLab) {\n        // If a course has a lab, then `onlyLectures`, `onlyLabs`,\n        // and `allInOnes` should be non-undefined, but we have to check\n        // anyways here to satisfy TypeScript\n        const pinnedOnlyLecture = (course.onlyLectures ?? []).find(isPinned);\n        const pinnedOnlyLab = (course.onlyLabs ?? []).find(isPinned);\n        const pinnedAllInOne = (course.allInOnes ?? []).find(isPinned);\n        if ((pinnedOnlyLecture && pinnedOnlyLab) || pinnedAllInOne) {\n          dfs(courseIndex + 1, crns);\n        } else if (pinnedOnlyLecture) {\n          pinnedOnlyLecture.associatedLabs.filter(isIncluded).forEach((lab) => {\n            if (hasConflict(lab)) return;\n            dfs(courseIndex + 1, [...crns, lab.crn]);\n          });\n        } else if (pinnedOnlyLab) {\n          pinnedOnlyLab.associatedLectures\n            .filter(isIncluded)\n            .forEach((lecture) => {\n              if (hasConflict(lecture)) return;\n              dfs(courseIndex + 1, [...crns, lecture.crn]);\n            });\n        } else {\n          (course.onlyLectures ?? []).filter(isIncluded).forEach((lecture) => {\n            if (hasConflict(lecture)) return;\n            lecture.associatedLabs.filter(isIncluded).forEach((lab) => {\n              if (hasConflict(lab)) return;\n              dfs(courseIndex + 1, [...crns, lecture.crn, lab.crn]);\n            });\n          });\n          (course.allInOnes ?? []).filter(isIncluded).forEach((section) => {\n            if (hasConflict(section)) return;\n            dfs(courseIndex + 1, [...crns, section.crn]);\n          });\n        }\n      } else if (course.sections.some(isPinned)) {\n        dfs(courseIndex + 1, crns);\n      } else {\n        // If a course does not have a lab, then `sectionGroups` should be\n        // non-undefined, but we have to check anyways here to satisfy\n        // TypeScript\n        Object.values(course.sectionGroups ?? {}).forEach((sectionGroup) => {\n          if (sectionGroup == null) return;\n          const section = sectionGroup.sections.find(isIncluded);\n          if (!section || hasConflict(section)) return;\n          dfs(courseIndex + 1, [...crns, section.crn]);\n        });\n      }\n    };\n    dfs();\n    return crnsList.map((crns) => {\n      const startMap: Record<string, number> = {};\n      const endMap: Record<string, number> = {};\n      this.iterateTimeBlocks([...pinnedCrns, ...crns], (day, period) => {\n        if (period === undefined) return;\n        const end = endMap[day];\n        const start = startMap[day];\n        if (start == null || start > period.start) startMap[day] = period.start;\n        if (end == null || end < period.end) endMap[day] = period.end;\n      });\n      return {\n        crns,\n        startMap,\n        endMap,\n      };\n    });\n  }\n\n  sortCombinations(\n    combinations: Combination[],\n    sortingOptionIndex: number\n  ): Combination[] {\n    const sortingOption = this.sortingOptions[sortingOptionIndex];\n    if (sortingOption === undefined) {\n      throw new ErrorWithFields({\n        message: `sorting option index was out of bounds`,\n        fields: {\n          sortingOptionIndex,\n          actualSortingOptionsLength: this.sortingOptions.length,\n          term: this.term,\n        },\n      });\n    }\n\n    return combinations\n      .map((combination) => ({\n        ...combination,\n        factor: sortingOption.calculateFactor(combination),\n      }))\n      .sort((a, b) => a.factor - b.factor);\n  }\n\n  iterateTimeBlocks(\n    crns: string[],\n    callback: (day: string, period: Period | undefined) => void\n  ): void {\n    crns.forEach((crn) => {\n      const section = this.findSection(crn);\n      if (section !== undefined) {\n        section.meetings.forEach(\n          (meeting) =>\n            meeting.period &&\n            meeting.days.forEach((day) => {\n              callback(day, meeting.period);\n            })\n        );\n      }\n    });\n  }\n}\n\n/**\n * Create an empty instance of the Oscar bean\n * to use as the default context value\n */\nexport const EMPTY_OSCAR = new Oscar(\n  {\n    courses: {},\n    caches: {\n      periods: [],\n      dateRanges: [],\n      scheduleTypes: [],\n      campuses: [],\n      attributes: [],\n      gradeBases: [],\n      locations: [],\n    },\n    // This converts the Date to the expected string\n    // that it serializes to in the crawler\n    updatedAt: JSON.parse(JSON.stringify(new Date())) as string,\n    version: 1,\n  },\n  '197008'\n);\n","import { Immutable } from 'immer';\n\nimport { generateRandomId } from '../utils/misc';\n\n// This file defines all of the possible types that the schedule data can take\n// (in addition to a few helpers/constants).\n// When adding new schedule data versions (schemas),\n// make sure not to delete any of the existing types;\n// they are needed in order to correctly type the migration functions.\n// Including all of the old version schemas and including migration functions\n// ensures that we gracefully handle users opening the app\n// with whatever local state they have (even if it's old),\n// and the app not losing/corrupting their state.\n\n// These should always be the latest version of schedule data\nexport const LATEST_SCHEDULE_DATA_VERSION: ScheduleData['version'] = 2;\nexport type ScheduleData = Version2ScheduleData;\nexport type TermScheduleData = Version2TermScheduleData;\nexport type ScheduleVersion = Version2ScheduleVersion;\nexport type Schedule = Version2Schedule;\n\n// Add additional types here named like \"Version{N}OrNewer\" for each version,\n// where they are an alias for:\n// Version{N}ScheduleData | Version{N+1}ScheduleDataOrNewer.\nexport type Version1ScheduleDataOrNewer =\n  | Version2ScheduleDataOrNewer\n  | Version1ScheduleData;\nexport type Version2ScheduleDataOrNewer = Version2ScheduleData;\n\n// This type should automatically accept any schedule data\nexport type AnyScheduleData = Version1ScheduleDataOrNewer;\n\nexport const defaultScheduleData: Immutable<ScheduleData> = {\n  terms: {},\n  version: 2,\n};\n\nexport const defaultTermScheduleData: Immutable<TermScheduleData> = {\n  versions: {},\n};\n\nexport const defaultSchedule: Immutable<Schedule> = {\n  desiredCourses: [],\n  pinnedCrns: [],\n  excludedCrns: [],\n  colorMap: {},\n  sortingOptionIndex: 0,\n};\n\nexport const generateScheduleVersionId = (): string =>\n  `sv_${generateRandomId(20)}`;\n\n// Version 1 schedule data (2021-09-10)\n// ===================================\n//  - addition of schedule versions\n//  - migration from multiple cookies to single local storage key\n\nexport interface Version1ScheduleData {\n  terms: Record<string, Version1TermScheduleData>;\n  currentTerm: string;\n  version: 1;\n}\n\nexport interface Version1TermScheduleData {\n  versions: Version1ScheduleVersion[];\n  currentIndex: number;\n}\n\nexport interface Version1ScheduleVersion {\n  name: string;\n  schedule: Version1Schedule;\n}\n\nexport interface Version1Schedule {\n  desiredCourses: string[];\n  pinnedCrns: string[];\n  excludedCrns: string[];\n  colorMap: Record<string, string>;\n  sortingOptionIndex: number;\n}\n\n// Version 2 schedule data (2021-10-26)\n// ===================================\n//  - addition of unique keys for schedule versions\n//  - addition of createdAt fields for schedule versions\n//    to provide natural, reconcilable, sort order\n//  - removal of all `currentIndex` and `currentTerm` fields\n//    (instead stored in separate ui state)\n\nexport interface Version2ScheduleData {\n  terms: Record<string, Version2TermScheduleData>;\n  version: 2;\n}\n\nexport interface Version2TermScheduleData {\n  versions: Record<string, Version2ScheduleVersion>;\n}\n\nexport interface Version2ScheduleVersion {\n  name: string;\n  createdAt: string;\n  schedule: Version2Schedule;\n}\n\nexport interface Version2Schedule {\n  desiredCourses: string[];\n  pinnedCrns: string[];\n  excludedCrns: string[];\n  colorMap: Record<string, string>;\n  sortingOptionIndex: number;\n}\n","import React from 'react';\nimport { Draft, Immutable } from 'immer';\n\nimport { Oscar } from '../data/beans';\nimport { EMPTY_OSCAR } from '../data/beans/Oscar';\nimport { defaultSchedule, Schedule } from '../data/types';\nimport { ErrorWithFields } from '../log';\n\ntype ExtraData = {\n  term: string;\n  currentVersion: string;\n  allVersionNames: { id: string; name: string }[];\n  // `oscar` is included below as a separate type\n};\n\nexport type ScheduleContextData = Immutable<Schedule> &\n  // `Oscar` can't go into `Immutable`, so we place it separately\n  Immutable<ExtraData> & { readonly oscar: Oscar };\n\nexport type ScheduleContextSetters = {\n  setTerm: (next: string) => void;\n  patchSchedule: (patch: Partial<Schedule>) => void;\n  updateSchedule: (\n    applyDraft: (draft: Draft<Schedule>) => void | Immutable<Schedule>\n  ) => void;\n  setCurrentVersion: (next: string) => void;\n  addNewVersion: (name: string, select?: boolean) => string;\n  deleteVersion: (id: string) => void;\n  renameVersion: (id: string, newName: string) => void;\n  cloneVersion: (id: string, newName: string) => void;\n};\nexport type ScheduleContextValue = [\n  ScheduleContextData,\n  ScheduleContextSetters\n];\nexport const ScheduleContext = React.createContext<ScheduleContextValue>([\n  {\n    term: '',\n    currentVersion: '',\n    allVersionNames: [],\n    oscar: EMPTY_OSCAR,\n    ...defaultSchedule,\n  },\n  {\n    setTerm: (next: string): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.setTerm value being used',\n        fields: {\n          next,\n        },\n      });\n    },\n    patchSchedule: (patch: Partial<Schedule>): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.patchSchedule value being used',\n        fields: {\n          patch,\n        },\n      });\n    },\n    updateSchedule: (): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.updateSchedule value being used',\n      });\n    },\n    setCurrentVersion: (next: string): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.setCurrentVersion value being used',\n        fields: {\n          next,\n        },\n      });\n    },\n    addNewVersion: (name: string, select?: boolean): string => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.addNewVersion value being used',\n        fields: {\n          name,\n          select,\n        },\n      });\n    },\n    deleteVersion: (id: string): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.deleteVersion value being used',\n        fields: {\n          id,\n        },\n      });\n    },\n    renameVersion: (id: string, newName: string): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.renameVersion value being used',\n        fields: {\n          id,\n          newName,\n        },\n      });\n    },\n    cloneVersion: (id: string, newName: string): void => {\n      throw new ErrorWithFields({\n        message: 'empty ScheduleContext.cloneVersion value being used',\n        fields: {\n          id,\n          newName,\n        },\n      });\n    },\n  },\n]);\n","import React from 'react';\n\nimport { ErrorWithFields } from '../log';\n\nexport type OverlayCrnsContextValue = [string[], (next: string[]) => void];\nexport const OverlayCrnsContext = React.createContext<OverlayCrnsContextValue>([\n  [],\n  (next: string[]): void => {\n    throw new ErrorWithFields({\n      message: 'empty OverlayCrnsContext.setOverlayCrns value being used',\n      fields: {\n        next,\n      },\n    });\n  },\n]);\n\nexport const a = 'ouleuouleuouleu';\n","import React, { useContext } from 'react';\nimport ReactTooltip from 'react-tooltip';\n\nimport { classes, getContentClassName, periodToString } from '../../utils/misc';\nimport { CLOSE, OPEN, DAYS } from '../../constants';\nimport { ScheduleContext } from '../../contexts';\nimport { Period } from '../../types';\n\nimport './stylesheet.scss';\n\nexport interface TimeBlockPosition {\n  rowIndex: number;\n  rowSize: number;\n  period: Period;\n  crn: string;\n}\n\nexport type SizeInfo = Record<string, Record<string, TimeBlockPosition>>;\n\nexport type TimeBlocksProps = {\n  className?: string;\n  crn: string;\n  overlay?: boolean;\n  capture: boolean;\n  preview: boolean;\n  isAutosized: boolean;\n  sizeInfo: SizeInfo;\n};\n\nexport function makeSizeInfoKey(period: Period): string {\n  return [period.start, period.end].join('-');\n}\n\nexport default function TimeBlocks({\n  className,\n  crn,\n  overlay = false,\n  preview,\n  capture,\n  isAutosized,\n  sizeInfo,\n}: TimeBlocksProps): React.ReactElement | null {\n  const [{ oscar, colorMap }] = useContext(ScheduleContext);\n\n  const section = oscar.findSection(crn);\n  if (section == null) return null;\n\n  const color = colorMap[section.course.id];\n  const contentClassName = getContentClassName(color);\n\n  return (\n    <div\n      className={classes(\n        'TimeBlocks',\n        capture && 'capture',\n        overlay && 'overlay',\n        className\n      )}\n    >\n      {section.meetings.map((meeting, i) => {\n        const { period } = meeting;\n        if (period == null) return;\n\n        const sizeInfoKey = makeSizeInfoKey(period);\n        return meeting.days.map((day) => {\n          const sizeInfoDay = sizeInfo[day];\n          if (sizeInfoDay == null) return;\n          const sizeInfoPeriodDay = sizeInfoDay[sizeInfoKey];\n          if (sizeInfoPeriodDay == null) return;\n\n          return (\n            <div\n              className={classes('meeting', contentClassName, 'default', day)}\n              key={[i, day].join('-')}\n              style={{\n                top: `${((period.start - OPEN) / (CLOSE - OPEN)) * 100}%`,\n                height: `${\n                  ((period.end - period.start) / (CLOSE - OPEN)) * 100\n                }%`,\n                width: `${20 / sizeInfoPeriodDay.rowSize}%`,\n                left: `${\n                  DAYS.indexOf(day) * 20 +\n                  sizeInfoPeriodDay.rowIndex * (20 / sizeInfoPeriodDay.rowSize)\n                }%`,\n                backgroundColor: color,\n              }}\n              data-tip\n              data-for={crn}\n            >\n              {!preview && (\n                <div className=\"meeting-wrapper\">\n                  <div className=\"ids\">\n                    <span className=\"course-id\">{section.course.id}</span>\n                    <span className=\"section-id\">&nbsp;{section.id}</span>\n                  </div>\n                  <span className=\"period\">{periodToString(period)}</span>\n                  <span className=\"where\">{meeting.where}</span>\n                  <span className=\"instructors\">\n                    {meeting.instructors.join(', ')}\n                  </span>\n                </div>\n              )}\n            </div>\n          );\n        });\n      })}\n\n      {!isAutosized && (\n        <ReactTooltip\n          id={crn}\n          className=\"tooltip\"\n          type=\"dark\"\n          place=\"top\"\n          effect=\"solid\"\n        >\n          <table>\n            <tbody>\n              <tr>\n                <td>\n                  <b>Course Name</b>\n                </td>\n                <td>{section.course.title}</td>\n              </tr>\n              <tr>\n                <td>\n                  <b>Delivery Type</b>\n                </td>\n                <td>{section.deliveryMode}</td>\n              </tr>\n              <tr>\n                <td>\n                  <b>Course Number</b>\n                </td>\n                <td>{section.crn}</td>\n              </tr>\n              <tr>\n                <td>\n                  <b>Credit Hours</b>\n                </td>\n                <td>{section.credits}</td>\n              </tr>\n            </tbody>\n          </table>\n        </ReactTooltip>\n      )}\n    </div>\n  );\n}\n","import React, { useContext } from 'react';\n\nimport { CLOSE, DAYS, OPEN } from '../../constants';\nimport { classes, timeToShortString } from '../../utils/misc';\nimport { TimeBlocks } from '..';\nimport { ScheduleContext } from '../../contexts';\nimport { makeSizeInfoKey, TimeBlockPosition } from '../TimeBlocks';\nimport { Period } from '../../types';\n\nimport './stylesheet.scss';\n\nexport type CalendarProps = {\n  className?: string;\n  overlayCrns: string[];\n  preview?: boolean;\n  capture?: boolean;\n  isAutosized?: boolean;\n};\n\nexport default function Calendar({\n  className,\n  overlayCrns,\n  preview = false,\n  capture = false,\n  isAutosized = false,\n}: CalendarProps): React.ReactElement {\n  const [{ pinnedCrns, oscar }] = useContext(ScheduleContext);\n\n  // Contains the rowIndex's and rowSize's passed into each crn's TimeBlocks\n  // e.g. crnSizeInfo[crn][day][\"period.start-period.end\"].rowIndex\n  const crnSizeInfo: Record<\n    string,\n    Record<string, Record<string, TimeBlockPosition>>\n  > = {};\n\n  // Recursively sets the rowSize of all time blocks within the current\n  // connected grouping of blocks to the current block's rowSize\n  const updateJoinedRowSizes = (\n    periodInfos: TimeBlockPosition[],\n    seen: Set<string>,\n    curCrn: string,\n    curPeriod: Period,\n    newRowSize: number\n  ): void => {\n    if (seen.has(curCrn)) {\n      return;\n    }\n    seen.add(curCrn);\n\n    periodInfos\n      .filter(\n        (period2Info) =>\n          period2Info.period.start < curPeriod.end &&\n          period2Info.period.end > curPeriod.start\n      )\n      .forEach((period2Info) => {\n        period2Info.rowSize = newRowSize;\n        updateJoinedRowSizes(\n          periodInfos,\n          seen,\n          period2Info.crn,\n          period2Info.period,\n          newRowSize\n        );\n      });\n  };\n\n  const crns = Array.from(new Set([...pinnedCrns, ...(overlayCrns || [])]));\n  const maxMeetingLen = (crn: string): number => {\n    const section = oscar.findSection(crn);\n    if (section == null) return 0;\n    return Math.max(\n      ...section.meetings.flatMap(({ period }) => {\n        if (period == null) return [];\n        return [period.end - period.start];\n      })\n    );\n  };\n\n  crns.sort((a, b) => maxMeetingLen(a) - maxMeetingLen(b));\n\n  // Populates crnSizeInfo by iteratively finding the next time block's\n  // rowSize and rowIndex (1 more than greatest of already processed connected\n  // blocks), updating the processed connected blocks to match its rowSize\n  crns.forEach((crn) => {\n    const section = oscar.findSection(crn);\n    if (section == null) return;\n\n    section.meetings\n      .filter((m) => m.period)\n      .forEach((meeting) => {\n        const { period } = meeting;\n        if (period == null) return;\n\n        meeting.days.forEach((day) => {\n          const dayPeriodInfos = Object.values(crnSizeInfo)\n            .flatMap<TimeBlockPosition | undefined>((days) =>\n              days != null ? Object.values(days[day] ?? {}) : []\n            )\n            .flatMap<TimeBlockPosition>((info) => (info == null ? [] : [info]));\n\n          const curRowSize = dayPeriodInfos\n            .filter(\n              (period2Info) =>\n                period2Info.period.start < period.end &&\n                period2Info.period.end > period.start\n            )\n            .reduce(\n              (acc, period2Info) => Math.max(acc, period2Info.rowSize + 1),\n              1\n            );\n\n          updateJoinedRowSizes(\n            dayPeriodInfos,\n            new Set(),\n            crn,\n            period,\n            curRowSize\n          );\n\n          const courseSizeInfo = crnSizeInfo[crn] || {};\n          crnSizeInfo[crn] = courseSizeInfo;\n\n          const daySizeInfo = courseSizeInfo[day] || {};\n          courseSizeInfo[day] = daySizeInfo;\n\n          daySizeInfo[makeSizeInfoKey(period)] = {\n            period,\n            crn,\n            rowIndex: curRowSize - 1,\n            rowSize: curRowSize,\n          };\n        });\n      });\n  });\n\n  return (\n    <div\n      className={classes(\n        'Calendar',\n        capture && 'capture',\n        preview && 'preview',\n        className\n      )}\n    >\n      {!preview && (\n        <div className=\"times\">\n          {new Array((CLOSE - OPEN) / 60).fill(0).map((_, i) => {\n            const time = OPEN + i * 60;\n            return (\n              <div className=\"time\" key={time}>\n                <span className=\"label\">{timeToShortString(time)}</span>\n              </div>\n            );\n          })}\n        </div>\n      )}\n      {!preview && (\n        <div className=\"days\">\n          {DAYS.map((day) => (\n            <div className=\"day\" key={day}>\n              <span className=\"label\">{day}</span>\n            </div>\n          ))}\n        </div>\n      )}\n      <div className=\"meetings\">\n        {pinnedCrns.map((crn) => (\n          <TimeBlocks\n            key={crn}\n            crn={crn}\n            preview={preview}\n            capture={capture}\n            isAutosized={isAutosized}\n            sizeInfo={crnSizeInfo[crn] ?? {}}\n          />\n        ))}\n        {overlayCrns &&\n          overlayCrns\n            .filter((crn) => !pinnedCrns.includes(crn))\n            .map((crn) => (\n              <TimeBlocks\n                key={crn}\n                crn={crn}\n                overlay={!preview}\n                preview={preview}\n                capture={capture}\n                isAutosized\n                sizeInfo={crnSizeInfo[crn] ?? {}}\n              />\n            ))}\n      </div>\n    </div>\n  );\n}\n","import { useRef, useEffect } from 'react';\n\n/**\n * Gets the previous value of some parameter.\n * Taken from https://usehooks.com/usePrevious/.\n */\nexport default function usePrevious<T>(\n  val: NonNullable<T>\n): NonNullable<T> | null {\n  const ref = useRef<NonNullable<T> | null>(null);\n  useEffect(() => {\n    ref.current = val;\n  }, [val]);\n\n  return ref.current;\n}\n","import React from 'react';\nimport { Modal as ReactOverlaysModal } from 'react-overlays';\nimport { CSSTransition } from 'react-transition-group';\n\nimport { classes } from '../../utils/misc';\nimport usePrevious from '../../hooks/usePrevious';\n\nimport './stylesheet.scss';\n\nconst transitionSpeed = 200; // ms\n\nexport interface ModalButtonProps {\n  label: React.ReactNode;\n  onClick?: () => void;\n  cancel?: boolean;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport type ModalProps = {\n  children?: React.ReactNode;\n  buttons?: ModalButtonProps[];\n  show: boolean;\n  onHide: () => void;\n  width?: number;\n  className?: string;\n  style?: React.CSSProperties;\n  /**\n   * Whether the modal should use the previous value of children\n   * while animating the hide.\n   * Useful if the content is dependent on state that changes\n   * at the same time as the show prop;\n   * without this, the other content would flash as the modal disappears.\n   * Default: `true`\n   */\n  preserveChildrenWhileHiding?: boolean;\n};\n\ntype TransitionProps = {\n  in: boolean;\n  appear?: boolean | undefined;\n  unmountOnExit?: boolean | undefined;\n  children?: React.ReactNode;\n};\n\n/**\n * Displays a modal popup\n * that can be used to display information to the user\n * or ask them to confirm an action.\n *\n * Uses https://react-bootstrap.github.io/react-overlays/api/Modal/\n * to implement the interaction & accessibility.\n */\nexport default function Modal({\n  children,\n  buttons = [],\n  show,\n  onHide,\n  width = 480,\n  className,\n  style,\n  preserveChildrenWhileHiding = true,\n}: ModalProps): React.ReactElement {\n  const previousChildren = usePrevious(children ?? <></>);\n  const previousShow = usePrevious(show);\n  let derivedChildren = children;\n  if (!show && previousShow === true) {\n    // We are transitioning out,\n    // check to see if we should use the previous children\n    if (preserveChildrenWhileHiding && previousChildren != null) {\n      derivedChildren = previousChildren;\n    }\n  }\n\n  return (\n    <ReactOverlaysModal\n      show={show}\n      onHide={onHide}\n      onBackdropClick={onHide}\n      className=\"modal-positioner\"\n      renderBackdrop={(props): React.ReactElement => (\n        <div {...props} className=\"modal-backdrop\" />\n      )}\n      transition={FadeZoom}\n      backdropTransition={Fade}\n    >\n      <div className={classes('modal', className)} style={{ width, ...style }}>\n        <div className=\"modal__content\">{derivedChildren}</div>\n        {buttons.length > 0 && (\n          <div className=\"modal__footer\">\n            {buttons.map((props, i) => (\n              <ModalButton {...props} key={i} />\n            ))}\n          </div>\n        )}\n      </div>\n    </ReactOverlaysModal>\n  );\n}\n\n// Private sub-components\n\nfunction ModalButton({\n  label,\n  onClick,\n  cancel,\n  className,\n  style,\n}: ModalButtonProps): React.ReactElement {\n  return (\n    <button\n      className={classes(\n        'modal__button',\n        cancel && 'modal__button--cancel',\n        !cancel && 'modal__button--normal',\n        className\n      )}\n      type=\"button\"\n      onClick={onClick}\n      style={style}\n    >\n      {label}\n    </button>\n  );\n}\n\nfunction Fade({ children, ...rest }: TransitionProps): React.ReactElement {\n  return (\n    <CSSTransition\n      {...rest}\n      timeout={transitionSpeed}\n      classNames=\"modal-transition--fade\"\n    >\n      {children}\n    </CSSTransition>\n  );\n}\n\nfunction FadeZoom({ children, ...rest }: TransitionProps): React.ReactElement {\n  return (\n    <CSSTransition\n      {...rest}\n      timeout={transitionSpeed}\n      classNames=\"modal-transition--fade-zoom\"\n    >\n      {children}\n    </CSSTransition>\n  );\n}\n","import React, { useCallback, useContext, useMemo, useState } from 'react';\nimport { AutoSizer, List } from 'react-virtualized';\n\nimport { Button, Calendar, Select } from '..';\nimport { OverlayCrnsContext, ScheduleContext } from '../../contexts';\nimport { Combination } from '../../types';\nimport Modal from '../Modal';\n\nimport 'react-virtualized/styles.css';\nimport './stylesheet.scss';\n\nexport default function CombinationContainer(): React.ReactElement {\n  const [\n    { oscar, desiredCourses, pinnedCrns, excludedCrns, sortingOptionIndex },\n    { patchSchedule },\n  ] = useContext(ScheduleContext);\n  const [, setOverlayCrns] = useContext(OverlayCrnsContext);\n\n  const [confirmReset, setConfirmReset] = useState(false);\n  const handleResetPinnedCrns = useCallback(() => {\n    setConfirmReset(true);\n  }, []);\n\n  const combinations = useMemo(\n    () => oscar.getCombinations(desiredCourses, pinnedCrns, excludedCrns),\n    [oscar, desiredCourses, pinnedCrns, excludedCrns]\n  );\n  const sortedCombinations = useMemo(\n    () => oscar.sortCombinations(combinations, sortingOptionIndex),\n    [oscar, combinations, sortingOptionIndex]\n  );\n\n  return (\n    <>\n      <div className=\"CombinationContainer\">\n        <Select\n          onChange={(newSortingOptionIndex): void =>\n            patchSchedule({ sortingOptionIndex: newSortingOptionIndex })\n          }\n          current={sortingOptionIndex}\n          options={oscar.sortingOptions.map((sortingOption, i) => ({\n            id: i,\n            label: sortingOption.label,\n          }))}\n        />\n        <Button\n          className=\"reset\"\n          onClick={handleResetPinnedCrns}\n          disabled={pinnedCrns.length === 0}\n        >\n          Reset Sections\n        </Button>\n        <div className=\"scroller\">\n          <AutoSizer>\n            {({ width, height }): React.ReactElement => (\n              <List\n                width={width}\n                height={height}\n                style={{ outline: 'none' }}\n                rowCount={sortedCombinations.length}\n                rowHeight={108}\n                rowRenderer={({ index, key, style }): React.ReactElement => {\n                  const { crns } = sortedCombinations[index] as Combination;\n                  return (\n                    <div className=\"list-item\" style={style} key={key}>\n                      <div\n                        className=\"combination\"\n                        onMouseEnter={(): void => setOverlayCrns(crns)}\n                        onMouseLeave={(): void => setOverlayCrns([])}\n                        onClick={(): void =>\n                          patchSchedule({\n                            pinnedCrns: [...pinnedCrns, ...crns],\n                          })\n                        }\n                      >\n                        <div className=\"number\">{index + 1}</div>\n                        <Calendar\n                          className=\"calendar-preview\"\n                          overlayCrns={crns}\n                          isAutosized\n                          preview\n                        />\n                      </div>\n                    </div>\n                  );\n                }}\n              />\n            )}\n          </AutoSizer>\n        </div>\n      </div>\n\n      <Modal\n        show={confirmReset}\n        onHide={(): void => setConfirmReset(false)}\n        buttons={[\n          {\n            label: 'Cancel',\n            cancel: true,\n            onClick: (): void => setConfirmReset(false),\n          },\n          {\n            label: 'Reset',\n            onClick: (): void => {\n              setConfirmReset(false);\n              patchSchedule({\n                pinnedCrns: [],\n              });\n            },\n          },\n        ]}\n      >\n        <div style={{ textAlign: 'center' }}>\n          <h2>Reset confirmation</h2>\n          <p>Are you sure you want to reset selected sections?</p>\n        </div>\n      </Modal>\n    </>\n  );\n}\n","export const cancelledSymbol = Symbol('__#Cancellable-cancelled-symbol');\n\n/**\n * Gives an awaitable class (via `promise`) that can be cancelled at any time.\n * Useful when combined with `Promise.race` to cancel background tasks.\n */\nexport default class Cancellable {\n  isCancelled: boolean;\n\n  cancel: () => void;\n\n  promise: Promise<symbol>;\n\n  constructor() {\n    this.isCancelled = false;\n    this.cancel = (): void => undefined;\n    this.promise = new Promise<symbol>((resolve) => {\n      this.cancel = (): void => {\n        this.isCancelled = true;\n        resolve(cancelledSymbol);\n      };\n    });\n  }\n\n  /**\n   * Runs a promise to completion, returning its value.\n   * However, if this operation was cancelled before the promise completed,\n   * then it instead returns an object with `cancelled` true.\n   * The promise will still complete, but its value will be ignored.\n   */\n  async perform<T>(\n    other: Promise<T>\n  ): Promise<{ cancelled: true } | { cancelled: false; value: T }> {\n    const result = await Promise.race([this.promise, other]);\n\n    if (result === cancelledSymbol) {\n      return { cancelled: true };\n    }\n\n    return {\n      cancelled: false,\n      value: result as T,\n    };\n  }\n}\n","import React, { useCallback, useContext, useEffect, useState } from 'react';\nimport {\n  faAngleDown,\n  faAngleUp,\n  faInfoCircle,\n  faShareAlt,\n  faPalette,\n  faPlus,\n  faTrash,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport { classes, getContentClassName } from '../../utils/misc';\nimport Cancellable from '../../utils/cancellable';\nimport { ActionRow, Instructor, Palette, Prerequisite } from '..';\nimport { ScheduleContext } from '../../contexts';\nimport { Course as CourseBean, Section } from '../../data/beans';\nimport { CourseGpa, CrawlerPrerequisites } from '../../types';\nimport { ErrorWithFields, softError } from '../../log';\n\nimport './stylesheet.scss';\n\nexport type CourseProps = {\n  className?: string;\n  courseId: string;\n  onAddCourse?: () => void;\n};\n\nexport default function Course({\n  className,\n  courseId,\n  onAddCourse,\n}: CourseProps): React.ReactElement | null {\n  const [expanded, setExpanded] = useState<boolean>(false);\n  const [prereqOpen, setPrereqOpen] = useState<boolean>(false);\n  const [paletteShown, setPaletteShown] = useState<boolean>(false);\n  const [gpaMap, setGpaMap] = useState<CourseGpa | null>(null);\n  const isSearching = Boolean(onAddCourse);\n  const [\n    { oscar, term, desiredCourses, pinnedCrns, excludedCrns, colorMap },\n    { patchSchedule },\n  ] = useContext(ScheduleContext);\n\n  useEffect(() => {\n    const course = oscar.findCourse(courseId);\n    if (course == null) return;\n    if (isSearching) return;\n\n    // Allow the operation to be cancelled early (if the component unmounts)\n    const loadOperation = new Cancellable();\n    async function loadCourseGpa(): Promise<void> {\n      if (course == null) return;\n\n      const promise = course.fetchGpa();\n      const result = await loadOperation.perform(promise);\n      if (!result.cancelled) {\n        setGpaMap(result.value);\n      }\n    }\n\n    loadCourseGpa().catch((err) => {\n      softError(\n        new ErrorWithFields({\n          message: 'error fetching course GPA',\n          source: err,\n          fields: {\n            courseId,\n            term: course.term,\n          },\n        })\n      );\n    });\n\n    return (): void => {\n      loadOperation.cancel();\n    };\n  }, [isSearching, oscar, courseId]);\n\n  const handleRemoveCourse = useCallback(\n    (course: CourseBean) => {\n      const newColorMap = { ...colorMap };\n      delete newColorMap[course.id];\n\n      patchSchedule({\n        desiredCourses: desiredCourses.filter((id) => id !== course.id),\n        pinnedCrns: pinnedCrns.filter(\n          (crn) => !course.sections.some((section) => section.crn === crn)\n        ),\n        excludedCrns: excludedCrns.filter(\n          (crn) => !course.sections.some((section) => section.crn === crn)\n        ),\n        colorMap: newColorMap,\n      });\n    },\n    [desiredCourses, pinnedCrns, excludedCrns, colorMap, patchSchedule]\n  );\n\n  const handleIncludeSections = useCallback(\n    (sections: Section[]) => {\n      const crns = sections.map((section) => section.crn);\n      patchSchedule({\n        excludedCrns: excludedCrns.filter((crn) => !crns.includes(crn)),\n      });\n    },\n    [excludedCrns, patchSchedule]\n  );\n\n  const course = oscar.findCourse(courseId);\n  if (course == null) return null;\n\n  const color = colorMap[course.id];\n  const contentClassName = color != null && getContentClassName(color);\n\n  const hasPrereqs = oscar.version > 1;\n  let prereqs: CrawlerPrerequisites | null = null;\n  if (hasPrereqs) {\n    prereqs = course.prereqs ?? [];\n  }\n\n  const instructorMap: Record<string, Section[] | undefined> = {};\n  course.sections.forEach((section) => {\n    const [primaryInstructor = 'Not Assigned'] = section.instructors;\n\n    const instructorSections = instructorMap[primaryInstructor] ?? [];\n    instructorSections.push(section);\n    instructorMap[primaryInstructor] = instructorSections;\n  });\n\n  const instructors = Object.keys(instructorMap);\n  const excludedInstructors = instructors.filter((instructor) => {\n    const sections = instructorMap[instructor];\n    if (sections == null) return false;\n    return sections.every((section) => excludedCrns.includes(section.crn));\n  });\n  const includedInstructors = instructors.filter(\n    (instructor) => !excludedInstructors.includes(instructor)\n  );\n\n  const prereqControl = (\n    nextPrereqOpen: boolean,\n    nextExpanded: boolean\n  ): void => {\n    setPrereqOpen(nextPrereqOpen);\n    setExpanded(nextExpanded);\n  };\n  const prereqAction = {\n    icon: faShareAlt,\n    styling: { transform: 'rotate(90deg)' },\n    onClick: (): void => {\n      prereqControl(true, !prereqOpen ? true : !expanded);\n    },\n  };\n\n  const infoAction = {\n    icon: faInfoCircle,\n    href:\n      `https://oscar.gatech.edu/pls/bprod/bwckctlg.p_disp_` +\n      `course_detail?cat_term_in=${term}&subj_code_in=` +\n      `${course.subject}&crse_numb_in=${course.number}`,\n  };\n\n  const pinnedSections = course.sections.filter((section) =>\n    pinnedCrns.includes(section.crn)\n  );\n  const totalCredits = pinnedSections.reduce(\n    (credits, section) => credits + section.credits,\n    0\n  );\n\n  return (\n    <div\n      className={classes('Course', contentClassName, 'default', className)}\n      style={{ backgroundColor: color }}\n      key={course.id}\n    >\n      <ActionRow\n        label={[\n          course.id,\n          pinnedSections.map((section) => section.id).join(', '),\n        ].join(' ')}\n        actions={\n          isSearching\n            ? [\n                { icon: faPlus, onClick: onAddCourse },\n                hasPrereqs ? prereqAction : infoAction,\n              ]\n            : [\n                {\n                  icon: expanded ? faAngleUp : faAngleDown,\n                  onClick: (): void => prereqControl(false, !expanded),\n                },\n                hasPrereqs ? prereqAction : infoAction,\n                {\n                  icon: faPalette,\n                  onClick: (): void => setPaletteShown(!paletteShown),\n                },\n                {\n                  icon: faTrash,\n                  onClick: (): void => handleRemoveCourse(course),\n                },\n              ]\n        }\n      >\n        <div className=\"course-row\">\n          <span className=\"course-title\">{course.title}</span>\n          <span className=\"section-crns\">\n            {pinnedSections.map((section) => section.crn).join(', ')}\n          </span>\n        </div>\n        {!isSearching && (\n          <div className=\"course-row\">\n            <span className=\"gpa\">\n              Course GPA:{' '}\n              {gpaMap === null\n                ? 'Loading...'\n                : gpaMap.averageGpa\n                ? gpaMap.averageGpa.toFixed(2)\n                : 'N/A'}\n            </span>\n            {totalCredits > 0 && (\n              <span className=\"credits\">{totalCredits} Credits</span>\n            )}\n          </div>\n        )}\n        {paletteShown && (\n          <Palette\n            className=\"palette\"\n            onSelectColor={(col): void =>\n              patchSchedule({ colorMap: { ...colorMap, [courseId]: col } })\n            }\n            color={color ?? null}\n            onMouseLeave={(): void => setPaletteShown(false)}\n          />\n        )}\n      </ActionRow>\n      {expanded && !prereqOpen && (\n        <div className={classes('hover-container', 'nested')}>\n          {includedInstructors.map((name) => {\n            let instructorGpa: number | undefined = 0;\n            if (gpaMap !== null) {\n              instructorGpa = gpaMap[name];\n            }\n            return (\n              <Instructor\n                key={name}\n                color={color}\n                name={name}\n                sections={instructorMap[name] ?? []}\n                gpa={\n                  gpaMap === null\n                    ? 'Loading...'\n                    : instructorGpa\n                    ? instructorGpa.toFixed(2)\n                    : 'N/A'\n                }\n              />\n            );\n          })}\n          {excludedInstructors.length > 0 && (\n            <div className=\"excluded-instructor-container\">\n              {excludedInstructors.map((name) => (\n                <span\n                  className=\"excluded-instructor\"\n                  key={name}\n                  onClick={(): void => {\n                    const instructorSections = instructorMap[name];\n                    if (instructorSections == null) return;\n                    handleIncludeSections(instructorSections);\n                  }}\n                >\n                  {name}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n      {expanded && prereqOpen && prereqs !== null && (\n        <Prerequisite course={course} prereqs={prereqs} />\n      )}\n    </div>\n  );\n}\n","import React, {\n  ChangeEvent,\n  KeyboardEvent,\n  useCallback,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus } from '@fortawesome/free-solid-svg-icons';\n\nimport { Course, CourseFilter } from '..';\nimport { classes, getRandomColor } from '../../utils/misc';\nimport { ASYNC_DELIVERY_MODE, CAMPUSES, DELIVERY_MODES } from '../../constants';\nimport { ScheduleContext } from '../../contexts';\nimport { Course as CourseBean, Section } from '../../data/beans';\n\nimport './stylesheet.scss';\n\nexport type CourseAddProps = {\n  className?: string;\n};\n\ntype SortKey = 'deliveryMode' | 'campus';\n\ntype SortFilter = {\n  [sortKey in SortKey]: string[];\n};\n\nfunction isSortKey(sortKey: string): sortKey is SortKey {\n  switch (sortKey) {\n    case 'deliveryMode':\n    case 'campus':\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction doesFilterMatchCourse(\n  course: CourseBean,\n  filter: SortFilter\n): boolean {\n  return Object.entries(filter).every(([key, tags]) => {\n    if (!isSortKey(key)) return true;\n\n    return (\n      tags.length === 0 ||\n      course.sections.some((section) => {\n        const sortValue = section[key];\n        if (sortValue == null) return false;\n\n        return tags.includes(sortValue);\n      })\n    );\n  });\n}\n\nfunction doesFilterMatchSection(section: Section, filter: SortFilter): boolean {\n  return Object.entries(filter).every(([key, tags]) => {\n    if (tags.length === 0) return true;\n    if (!isSortKey(key)) return true;\n\n    const sortValue = section[key];\n    if (sortValue == null) return false;\n\n    return tags.includes(sortValue);\n  });\n}\n\nexport default function CourseAdd({\n  className,\n}: CourseAddProps): React.ReactElement {\n  const [{ oscar, desiredCourses, excludedCrns, colorMap }, { patchSchedule }] =\n    useContext(ScheduleContext);\n  const [keyword, setKeyword] = useState('');\n  const [filter, setFilter] = useState<SortFilter>({\n    deliveryMode: [],\n    campus: [],\n  });\n  const [activeIndex, setActiveIndex] = useState(0);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const handleChangeKeyword = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      let input = e.target.value.trim();\n      const results = /^([A-Z]+)(\\d.*)$/i.exec(input);\n      if (results != null) {\n        const [, subject, number] = results as unknown as [\n          string,\n          string,\n          string\n        ];\n        input = `${subject} ${number}`;\n      }\n      setKeyword(input);\n    },\n    []\n  );\n\n  const courses = useMemo(() => {\n    const results = /^([A-Z]+) ?((\\d.*)?)$/i.exec(keyword.toUpperCase());\n    if (!results) {\n      return [];\n    }\n    const [, subject, number] = results as unknown as [string, string, string];\n\n    setActiveIndex(0);\n\n    return oscar.courses\n      .filter((course) => {\n        const keywordMatch =\n          course.subject === subject && course.number.startsWith(number);\n        const filterMatch = doesFilterMatchCourse(course, filter);\n        return keywordMatch && filterMatch;\n      })\n      .filter((course) => !desiredCourses.includes(course.id));\n  }, [oscar, keyword, filter, desiredCourses]);\n\n  const handleAddCourse = useCallback(\n    (course: CourseBean) => {\n      if (desiredCourses.includes(course.id)) return;\n      const toBeExcludedCrns = course.sections\n        .filter((section) => {\n          const timeDecided =\n            section.deliveryMode === ASYNC_DELIVERY_MODE ||\n            (section.meetings.length &&\n              section.meetings.every(\n                (meeting) => meeting.days.length && meeting.period\n              ));\n          const filterMatch = doesFilterMatchSection(section, filter);\n          return !timeDecided || !filterMatch;\n        })\n        .map((section) => section.crn);\n      patchSchedule({\n        desiredCourses: [...desiredCourses, course.id],\n        excludedCrns: [...excludedCrns, ...toBeExcludedCrns],\n        colorMap: { ...colorMap, [course.id]: getRandomColor() },\n      });\n      setKeyword('');\n      inputRef.current?.focus();\n    },\n    [filter, desiredCourses, excludedCrns, colorMap, inputRef, patchSchedule]\n  );\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => {\n      switch (e.key) {\n        case 'Enter': {\n          const course = courses[activeIndex];\n          if (course != null) {\n            handleAddCourse(course);\n          }\n          break;\n        }\n        case 'ArrowDown':\n          setActiveIndex(Math.min(activeIndex + 1, courses.length - 1));\n          break;\n        case 'ArrowUp':\n          setActiveIndex(Math.max(activeIndex - 1, 0));\n          break;\n        default:\n          return;\n      }\n      e.preventDefault();\n    },\n    [courses, handleAddCourse, activeIndex]\n  );\n\n  const handleToggleFilter = useCallback(\n    (key: SortKey, tag: string) => {\n      const tags = filter[key];\n      setFilter({\n        ...filter,\n        [key]: tags.includes(tag)\n          ? tags.filter((v) => v !== tag)\n          : [...tags, tag],\n      });\n    },\n    [filter]\n  );\n\n  const handleResetFilter = useCallback(\n    (key) => {\n      setFilter({\n        ...filter,\n        [key]: [],\n      });\n    },\n    [filter]\n  );\n\n  const activeCourse = courses[activeIndex];\n\n  return (\n    <div className={classes('CourseAdd', className)}>\n      <div className=\"add\">\n        <div className=\"primary\">\n          <FontAwesomeIcon\n            className={classes('icon', courses.length > 0 && 'active')}\n            fixedWidth\n            icon={faPlus}\n          />\n          <div className=\"keyword-wrapper\">\n            {activeCourse && (\n              <div className={classes('keyword', 'autocomplete')}>\n                {activeCourse.id}\n              </div>\n            )}\n            <input\n              type=\"text\"\n              ref={inputRef}\n              value={keyword}\n              onChange={handleChangeKeyword}\n              className=\"keyword\"\n              placeholder=\"XX 0000\"\n              onKeyDown={handleKeyDown}\n            />\n          </div>\n        </div>\n        {[\n          ['Delivery Mode', 'deliveryMode', DELIVERY_MODES] as const,\n          ['Campus', 'campus', CAMPUSES] as const,\n        ].map(([name, property, labels]) => (\n          <CourseFilter\n            key={property}\n            name={name}\n            labels={labels}\n            selectedTags={filter[property]}\n            onReset={(): void => handleResetFilter(property)}\n            onToggle={(tag): void => handleToggleFilter(property, tag)}\n          />\n        ))}\n      </div>\n      {courses.length > 0 ? (\n        courses.map((course) => (\n          <Course\n            key={course.id}\n            className={classes(course === activeCourse && 'active')}\n            courseId={course.id}\n            onAddCourse={(): void => handleAddCourse(course)}\n          />\n        ))\n      ) : (\n        <div className=\"disclaimer\">\n          Disclaimer: GT Scheduler should be used as general reference only, and\n          users are solely responsible for ensuring any information including\n          registration restrictions.\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useContext } from 'react';\nimport ago from 's-ago';\n\nimport { Button, Course, CourseAdd } from '..';\nimport { ScheduleContext } from '../../contexts';\n\nimport 'react-virtualized/styles.css';\nimport './stylesheet.scss';\n\nexport default function CourseContainer(): React.ReactElement {\n  const [{ oscar, desiredCourses }] = useContext(ScheduleContext);\n\n  return (\n    <div className=\"CourseContainer\">\n      <div className=\"scroller\">\n        <div className=\"course-list\">\n          {desiredCourses.map((courseId) => {\n            return <Course courseId={courseId} key={courseId} />;\n          })}\n        </div>\n        <CourseAdd className=\"course-add\" />\n      </div>\n      <Button\n        className=\"updated-at\"\n        href=\"https://github.com/gt-scheduler/crawler\"\n      >\n        Course data fetched {ago(oscar.updatedAt)}\n      </Button>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { faAngleDown, faAngleUp } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { classes, humanizeArrayReact } from '../../utils/misc';\n\nimport './stylesheet.scss';\n\nexport type CourseFilterProps = {\n  name: string;\n  labels: Record<string, string>;\n  selectedTags: string[];\n  onReset: () => void;\n  onToggle: (tag: string) => void;\n};\n\nexport default function CourseFilter({\n  name,\n  labels,\n  selectedTags,\n  onReset,\n  onToggle,\n}: CourseFilterProps): React.ReactElement {\n  const [expanded, setExpanded] = useState(false);\n\n  return (\n    <div className=\"CourseFilter\">\n      <div\n        className={classes('header', selectedTags.length > 0 && 'active')}\n        onClick={(): void => setExpanded(!expanded)}\n      >\n        {!expanded && selectedTags.length > 0 ? (\n          <div className=\"name\">\n            {humanizeArrayReact(\n              selectedTags.flatMap<string>((tag) => {\n                const selectedTag = labels[tag];\n                return selectedTag != null ? [selectedTag] : [];\n              }),\n              <span className=\"or\">or</span>\n            )}\n          </div>\n        ) : (\n          <div className=\"name\">{name}</div>\n        )}\n        <FontAwesomeIcon fixedWidth icon={expanded ? faAngleUp : faAngleDown} />\n      </div>\n      {expanded && (\n        <div className=\"tag-container\">\n          <div\n            className={classes('tag', selectedTags.length === 0 && 'active')}\n            onClick={onReset}\n          >\n            All\n          </div>\n          {Object.keys(labels).map((tag) => (\n            <div\n              key={tag}\n              className={classes('tag', selectedTags.includes(tag) && 'active')}\n              property={tag}\n              onClick={(): void => onToggle(tag)}\n            >\n              {labels[tag]}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * Tries to guess whether a term string is really a term or not.\n * Terms are of the form \"202008\", where the first 4 digits are a year\n * and the last 2 are a month.\n */\nexport function isTerm(maybeTerm: string): boolean {\n  if (maybeTerm.length !== 6) return false;\n  const [year, month] = [maybeTerm.substring(0, 4), maybeTerm.substring(4, 6)];\n  const [yearAsNumber, monthAsNumber] = [Number(year), Number(month)];\n  if (Number.isNaN(yearAsNumber) || yearAsNumber < 1970 || monthAsNumber > 2100)\n    return false;\n  if (Number.isNaN(monthAsNumber) || monthAsNumber < 0 || monthAsNumber > 12)\n    return false;\n\n  return true;\n}\n\n/**\n * Gets the human-facing display name of a term/semester\n */\nexport function getSemesterName(term: string): string {\n  if (!isTerm(term)) return 'Unknown';\n\n  const year = term.substring(0, 4);\n  const semester = ((): string => {\n    switch (Number.parseInt(term.substring(4), 10)) {\n      case 1:\n        return 'Winter';\n      case 2:\n      case 3:\n        return 'Spring';\n      case 5:\n      case 6:\n        return 'Summer';\n      case 8:\n      case 9:\n        return 'Fall';\n      default:\n        return 'Unknown';\n    }\n  })();\n  return `${semester} ${year}`;\n}\n","import React, { useMemo } from 'react';\n\nimport { classes } from '../../utils/misc';\n\nimport './stylesheet.scss';\n\nexport type SpinnerProps = {\n  style?: React.CSSProperties;\n  className?: string;\n  size?: 'small' | 'normal' | number;\n};\n\n/**\n * Shows a simple circular spinner with a configurable size,\n * designed to indicate loading.\n */\nexport default function Spinner({\n  style,\n  className,\n  size = 'normal',\n}: SpinnerProps): React.ReactElement {\n  // Use approach from this article\n  // to stablize spinner position over time\n  // when it resides at the same place between renders:\n  // https://dev.to/selbekk/how-to-stop-your-spinner-from-jumping-in-react-5cmp\n  const mountTime = useMemo(() => Date.now(), []);\n  // This must be the same as animation duration:\n  const mountDelay = -(mountTime % 800);\n  const actualSize =\n    typeof size === 'number'\n      ? size\n      : {\n          small: 16,\n          normal: 40,\n        }[size];\n\n  return (\n    <svg\n      className={classes('spinner', className)}\n      style={\n        {\n          ...style,\n          '--size': `${actualSize}px`,\n          '--spinner-delay': `${mountDelay.toFixed(3)}ms`,\n        } as React.CSSProperties\n      }\n      viewBox=\"0 0 50 50\"\n    >\n      <circle cx=\"25\" cy=\"25\" r=\"20\" />\n    </svg>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCaretDown,\n  faCheck,\n  faPlus,\n  faTimes,\n  IconDefinition,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport { classes } from '../../utils/misc';\nimport { Button } from '..';\nimport Spinner from '../Spinner';\n\nimport './stylesheet.scss';\n\nexport type SelectProps<Id extends string | number> = {\n  className?: string;\n  style?: React.CSSProperties;\n  menuAnchor?: 'left' | 'right';\n  current: Id;\n  onChange: (newId: Id) => void;\n  options: SelectOption<Id>[];\n  desiredItemWidth?: number | string | null;\n\n  // If this is provided, then an explicit \"New\" option is added\n  // to the bottom of the <Select> box\n  // that will invoke this callback when clicked.\n  onClickNew?: () => void;\n\n  // Ignored if `onClickNew` is not provided.\n  newLabel?: string;\n};\n\nexport interface SelectOption<Id extends string | number> {\n  id: Id;\n  label: string;\n\n  // Used to specify any inline actions (buttons)\n  // These are visible when hovering the option on desktop,\n  // and are always visible on mobile.\n  actions?: SelectAction<Id>[];\n}\n\nexport type SelectAction<Id extends string | number> =\n  | EditAction<Id>\n  | ButtonAction<Id>;\n\n/**\n * Action that, when clicked on, initiates inline editing.\n * Once the user commits the edit (either by pressing 'Enter'\n * or by clicking the checkbox that this action's icon is replaced with),\n * then the `onCommit` callback is invoked,\n * which gives the action the opportunity:\n * to accept the edit (by updating the item's label and returning true)\n * or reject it (by returning false).\n * If the edit is rejected, then the <Select> box remains in edit mode.\n */\nexport interface EditAction<Id extends string | number> {\n  type: 'edit';\n  icon: IconDefinition;\n  onCommit: (newLabel: string, id: Id) => boolean;\n}\n\n/**\n * Basic action that, when clicked on, invokes the specified `onClick` callback\n */\nexport interface ButtonAction<Id extends string | number> {\n  type: 'button';\n  icon: IconDefinition;\n  onClick: (id: Id) => void;\n}\n\n/**\n * Renders a combo box-style input element that can be used\n * to select an option from a small group of options,\n * where only a single selected item can be active.\n * Supports per-option actions, inline label editing,\n * and a \"New\" option that appears at the bottom of the drop-down list.\n */\nexport default function Select<Id extends string | number>({\n  className,\n  style,\n  menuAnchor = 'left',\n  current,\n  onChange,\n  options,\n  desiredItemWidth = null,\n  onClickNew,\n  newLabel = 'New',\n}: SelectProps<Id>): React.ReactElement {\n  const [opened, setOpened] = useState(false);\n\n  const selectedOption = options.find((option) => option.id === current);\n  const label = selectedOption ? selectedOption.label : '-';\n\n  // Control inline editing state\n  const [inputId, setInputId] = useState<Id | null>(null);\n  const [inputValue, setInputValue] = useState<string>('');\n  const [inputEditAction, setInputEditAction] = useState<EditAction<Id> | null>(\n    null\n  );\n\n  // Try to commit the edit, sending the changes to the provided callback.\n  // If the callback returns `true`, then the edit is ended.\n  // If the callback returns `false`, then the edit is not committed\n  //    and will remain active (for the user to fix the issue).\n  // Does not close the selection box.\n  // Returns whether the commit was successful.\n  const tryCommit = (): boolean => {\n    if (inputEditAction === null) return false;\n    if (inputId === null) return false;\n    const committedValue = inputValue.trim();\n\n    if (inputEditAction.onCommit(committedValue, inputId)) {\n      setInputId(null);\n      setInputValue('');\n      setInputEditAction(null);\n      return true;\n    }\n\n    return false;\n  };\n\n  // Abandon the edit, discarding the changes.\n  // Does not close the selection box.\n  const abandonEdit = (): void => {\n    setInputId(null);\n    setInputValue('');\n    setInputEditAction(null);\n  };\n\n  // Handle when the user presses 'Enter' or 'Escape'\n  // to commit or abandon an in-progress edit, respectively.\n  // If either key is pressed and the operation was successful,\n  // then we also close the Select box.\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>): void => {\n    if (inputEditAction === null) return;\n    if (inputId === null) return;\n\n    if (e.key === 'Enter') {\n      if (tryCommit()) {\n        setOpened(false);\n      }\n    }\n    if (e.key === 'Escape') {\n      abandonEdit();\n      setOpened(false);\n    }\n  };\n\n  // Pass calls to `setOpened` through this,\n  // to block closing the selection box when there is an active edit.\n  const trySetOpened = (newOpened: boolean): void => {\n    // If there is an active edit and the caller is trying\n    // to close the Select box, prevent this\n    if (inputId !== null && !newOpened) return;\n\n    setOpened(newOpened);\n  };\n\n  return (\n    <div\n      className={classes('Button', 'Select', className, `anchor-${menuAnchor}`)}\n      onClick={(): void => trySetOpened(!opened)}\n      style={style}\n    >\n      <div className=\"text\">{label}</div>\n      <FontAwesomeIcon fixedWidth icon={faCaretDown} />\n      {opened && (\n        <div className=\"intercept\" onClick={(): void => trySetOpened(false)} />\n      )}\n      {opened && (\n        <div\n          className=\"option-container\"\n          style={desiredItemWidth != null ? { width: desiredItemWidth } : {}}\n        >\n          {options.map(({ id: optionId, label: optionLabel, actions = [] }) => (\n            <div\n              key={String(optionId)}\n              className={classes(\n                'option',\n                optionId === inputId && 'option--inputting'\n              )}\n            >\n              {inputId === optionId ? (\n                <AutoFocusInput\n                  className=\"option__input\"\n                  value={inputValue}\n                  onChange={(e): void => setInputValue(e.target.value)}\n                  placeholder={optionLabel}\n                  onKeyDown={handleKeyDown}\n                />\n              ) : (\n                <Button\n                  className=\"option__button\"\n                  key={optionId}\n                  onClick={(): void => onChange(optionId)}\n                >\n                  {optionLabel}\n                </Button>\n              )}\n              {actions.map((action, i) => (\n                <React.Fragment key={i}>\n                  {action.type === 'button' ? (\n                    <Button\n                      className=\"option__action-button\"\n                      onClick={(e): void => {\n                        e.stopPropagation();\n\n                        // Abandon any in-progress edit\n                        if (inputId !== null) abandonEdit();\n\n                        action.onClick(optionId);\n                      }}\n                    >\n                      <FontAwesomeIcon fixedWidth icon={action.icon} />\n                    </Button>\n                  ) : (\n                    <>\n                      {optionId === inputId ? (\n                        <>\n                          <Button\n                            className=\"option__action-button\"\n                            onClick={(e): void => {\n                              e.stopPropagation();\n                              tryCommit();\n                            }}\n                          >\n                            <FontAwesomeIcon fixedWidth icon={faCheck} />\n                          </Button>\n                          <Button\n                            className=\"option__action-button\"\n                            onClick={(e): void => {\n                              e.stopPropagation();\n                              abandonEdit();\n                            }}\n                          >\n                            <FontAwesomeIcon fixedWidth icon={faTimes} />\n                          </Button>\n                        </>\n                      ) : (\n                        <Button\n                          className=\"option__action-button\"\n                          onClick={(e): void => {\n                            e.stopPropagation();\n                            // Start a new edit (ignore any in-progress edits)\n                            setInputId(optionId);\n                            setInputValue(optionLabel);\n                            setInputEditAction(action);\n                          }}\n                        >\n                          <FontAwesomeIcon fixedWidth icon={action.icon} />\n                        </Button>\n                      )}\n                    </>\n                  )}\n                </React.Fragment>\n              ))}\n            </div>\n          ))}\n          {onClickNew !== undefined && (\n            <div className=\"option\">\n              <Button className=\"option__button\" onClick={onClickNew}>\n                <FontAwesomeIcon\n                  fixedWidth\n                  icon={faPlus}\n                  style={{ marginRight: 8 }}\n                />\n                {newLabel}\n              </Button>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport type LoadingSelectProps = {\n  className?: string;\n  label?: string;\n};\n\n/**\n * Visually similar to a `<Select>` component,\n * except it cannot be interacted with and displays the given label text\n * (default: \"Loading\") next to a small spinner\n */\nexport function LoadingSelect({\n  className,\n  label = 'Loading',\n}: LoadingSelectProps): React.ReactElement {\n  return (\n    <div className={classes('Button', 'Select', className, 'disabled')}>\n      <Spinner size=\"small\" style={{ marginRight: 12 }} />\n      <div className=\"text\">{label}</div>\n      <FontAwesomeIcon fixedWidth icon={faCaretDown} />\n    </div>\n  );\n}\n\nexport type DropdownMenuProps = {\n  className?: string;\n  style?: React.CSSProperties;\n  menuAnchor?: 'left' | 'right';\n  children: React.ReactNode;\n  items: DropdownMenuAction[];\n  disabled?: boolean;\n};\n\nexport interface DropdownMenuAction {\n  label: React.ReactNode;\n  icon?: IconDefinition;\n  onClick?: () => void;\n}\n\n/**\n * A `<DropdownMenu>` is similar to a `<Select>` except\n * it can be used in scenarios where there is no item to select,\n * but you still want to display a dropdown with buttons.\n */\nexport function DropdownMenu({\n  className,\n  style,\n  menuAnchor = 'left',\n  children,\n  items,\n  disabled = false,\n}: DropdownMenuProps): React.ReactElement {\n  const [opened, setOpened] = useState(false);\n  return (\n    <div\n      className={classes(\n        'Button',\n        'Select',\n        disabled && 'disabled',\n        className,\n        `anchor-${menuAnchor}`\n      )}\n      onClick={(): void => {\n        if (!disabled) setOpened(!opened);\n      }}\n      style={style}\n    >\n      {children}\n      {opened && (\n        <div className=\"intercept\" onClick={(): void => setOpened(false)} />\n      )}\n      {opened && (\n        <div className=\"option-container\">\n          {items.map(({ label, icon, onClick }, i) => (\n            <div\n              className={classes('option', onClick == null && 'option--text')}\n              key={i}\n            >\n              {onClick != null ? (\n                <Button className=\"option__button\" onClick={onClick}>\n                  {icon != null && (\n                    <FontAwesomeIcon\n                      fixedWidth\n                      icon={icon}\n                      style={{ marginRight: 8 }}\n                    />\n                  )}\n                  {label}\n                </Button>\n              ) : (\n                <div\n                  className=\"option__text\"\n                  // Prevent clicking on the text from closing the dropdown\n                  onClick={(e): void => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                  }}\n                >\n                  {icon != null && (\n                    <FontAwesomeIcon\n                      fixedWidth\n                      icon={icon}\n                      style={{ marginRight: 8 }}\n                    />\n                  )}\n                  {label}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Private sub-components\n\ntype AutoFocusInputProps = {\n  className?: string;\n  style?: React.CSSProperties;\n  value: string;\n  onChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  placeholder?: string;\n  onKeyDown?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n};\n\n/**\n * Simple wrapper around `<input>`\n * that automatically focuses its contents when it is first mounted\n */\nfunction AutoFocusInput({\n  className,\n  style,\n  value,\n  onChange,\n  placeholder,\n  onKeyDown,\n}: AutoFocusInputProps): React.ReactElement {\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  useEffect(() => {\n    if (inputRef.current === null) return;\n    inputRef.current.focus();\n    inputRef.current.select();\n  }, []);\n\n  return (\n    <input\n      className={className}\n      style={style}\n      value={value}\n      onChange={onChange}\n      placeholder={placeholder}\n      onKeyDown={onKeyDown}\n      ref={inputRef}\n      type=\"text\"\n    />\n  );\n}\n","import { useLayoutEffect, useState } from 'react';\n\nimport { ErrorWithFields, softError } from '../log';\n\n/**\n * Gets whether the given CSS media query is matched or not.\n * Runs a layout effect to synchronously update the media match state\n *\n * Adapted from https://www.netlify.com/blog/2020/12/05/building-a-custom-react-media-query-hook-for-more-responsive-apps/\n * @param query A CSS media query\n * @returns Whether the CSS media query is matched\n */\nexport default function useMedia(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useLayoutEffect(() => {\n    try {\n      const media = window.matchMedia(query);\n      if (media.matches !== matches) {\n        setMatches(media.matches);\n      }\n\n      const listener = (): void => setMatches(media.matches);\n      let apiUsed: 'addEventListener' | 'addListener' | null = null;\n      if (media.addEventListener != null) {\n        media.addEventListener('change', listener);\n        apiUsed = 'addEventListener';\n      } else if (media.addListener != null) {\n        // In Safari <14, we have to use `addListener`:\n        // https://caniuse.com/mdn-api_mediaquerylist_addlistener\n        media.addListener(listener);\n        apiUsed = 'addListener';\n      } else {\n        apiUsed = null;\n      }\n\n      return (): void => {\n        try {\n          // Use the corresponding cleanup API\n          // based on the API used to attach the listener\n          switch (apiUsed) {\n            case 'addEventListener':\n              media.removeEventListener('change', listener);\n              break;\n            case 'addListener':\n              media.removeListener(listener);\n              break;\n            default:\n              break;\n          }\n        } catch (err) {\n          softError(\n            new ErrorWithFields({\n              message:\n                'could not run useMedia query cleanup in layout effect cleanup',\n              source: err,\n              fields: {\n                previousQuery: query,\n                previousMatches: matches,\n              },\n            })\n          );\n        }\n      };\n    } catch (err) {\n      softError(\n        new ErrorWithFields({\n          message: 'could not run useMedia query in layout effect',\n          source: err,\n          fields: {\n            query,\n            matches,\n          },\n        })\n      );\n      return (): void => undefined;\n    }\n  }, [matches, query]);\n\n  return matches;\n}\n","import useMedia from './useMedia';\n\n/**\n * Gets whether the screen is currently larger than the specified width.\n * Runs internally as a layout effect.\n * @param width The target screen width, as a number (pixels)\n * or as a CSS unit expression.\n * @returns Whether the screen is larger than the width\n */\nexport default function useScreenWidth(width: number | string): boolean {\n  const widthWithUnits = typeof width === 'number' ? `${width}px` : width;\n  return useMedia(`(min-width: ${widthWithUnits})`);\n}\n","import firebase from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/firestore';\n\nimport { ErrorWithFields, softError } from '../log';\nimport { AnyScheduleData } from './types';\n\n// This data is not secret; it is included in the application bundle.\n// Supply these environment variables when developing locally.\nconst firebaseConfig = {\n  apiKey: process.env['REACT_APP_FIREBASE_API_KEY'],\n  authDomain: process.env['REACT_APP_FIREBASE_AUTH_DOMAIN'],\n  projectId: process.env['REACT_APP_FIREBASE_PROJECT_ID'],\n  storageBucket: process.env['REACT_APP_FIREBASE_STORAGE_BUCKET'],\n  messagingSenderId: process.env['REACT_APP_FIREBASE_MESSAGING_SENDER_ID'],\n  appId: process.env['REACT_APP_FIREBASE_APP_ID'],\n  measurementId: process.env['REACT_APP_FIREBASE_MEASUREMENT_ID'],\n};\n\n/**\n * Whether Firebase authentication is enabled in this environment.\n * To enable, supply the 5 Firebase config environment variables.\n */\nexport const isAuthEnabled =\n  firebaseConfig.apiKey != null && firebaseConfig.apiKey !== '';\n\n/* eslint-disable import/no-mutable-exports */\nlet auth: firebase.auth.Auth = null as unknown as firebase.auth.Auth;\nlet db: firebase.firestore.Firestore =\n  null as unknown as firebase.firestore.Firestore;\ntype SchedulesCollection =\n  firebase.firestore.CollectionReference<AnyScheduleData>;\nlet schedulesCollection: SchedulesCollection =\n  null as unknown as SchedulesCollection;\n/* eslint-enable import/no-mutable-exports */\nif (isAuthEnabled) {\n  const app = firebase.initializeApp(firebaseConfig);\n\n  auth = app.auth();\n  db = app.firestore();\n  schedulesCollection = db.collection('schedules') as SchedulesCollection;\n\n  auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).catch((err) => {\n    softError(\n      new ErrorWithFields({\n        message: 'error when configuring firebase auth persistence',\n        source: err,\n      })\n    );\n  });\n}\n\nexport { auth, db, schedulesCollection };\nexport { firebase };\n\n// Configure the enabled auth providers that firebase UI displays as options\nexport const authProviders = [\n  firebase.auth.EmailAuthProvider.PROVIDER_ID,\n  firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n  firebase.auth.GithubAuthProvider.PROVIDER_ID,\n];\n","import React, { useEffect } from 'react';\nimport firebaseui from 'firebaseui';\nimport FirebaseAuth from 'react-firebaseui/FirebaseAuth';\n\nimport Modal from '../Modal';\nimport { firebase, authProviders } from '../../data/firebase';\n\nimport './stylesheet.scss';\n\nconst uiConfig: firebaseui.auth.Config = {\n  // Popup sign-in flow rather than redirect flow.\n  signInFlow: 'popup',\n  signInOptions: authProviders,\n  callbacks: {\n    // Avoid redirects after sign-in.\n    signInSuccessWithAuthResult: () => false,\n  },\n};\n\n/**\n * Inner content of the login modal.\n * This utilizes Firebase UI to handle the authentication UI components.\n */\nexport function LoginModalContent(): React.ReactElement {\n  // Calculate the min height of the FirebaseUI element\n  // so that it does not cause a large layout shift when initially loading.\n  // The height is determined based on the number of auth providers,\n  // which directly determines the number of stacked vertical buttons.\n  // Each button is 40px wide with a 15px gap.\n  let minHeight = authProviders.length * 40;\n  if (authProviders.length >= 2) {\n    minHeight += (authProviders.length - 1) * 15;\n  }\n\n  return (\n    <div className=\"login-modal-content\">\n      <h1>Sign in</h1>\n      <p className=\"login-modal-content__body\">\n        Sign in using one of the below identity providers to start syncing your\n        schedules across devices.\n      </p>\n      <div style={{ minHeight }}>\n        <FirebaseAuth\n          className=\"login-modal-content__firebase-ui\"\n          uiConfig={uiConfig}\n          firebaseAuth={firebase.auth()}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport type LoginModalProps = {\n  show: boolean;\n  onHide: () => void;\n};\n\n/**\n * Component that can be used to show the login modal.\n * This utilizes Firebase UI to handle the authentication UI components.\n */\nexport default function LoginModal({\n  show,\n  onHide,\n}: LoginModalProps): React.ReactElement {\n  // If the modal is open,\n  // attach a listener for the authentication state\n  // to close it once the user logs in.\n  useEffect(() => {\n    if (show) {\n      const removeListener = firebase.auth().onAuthStateChanged((user) => {\n        if (user !== null) {\n          onHide();\n        }\n      });\n      return removeListener;\n    }\n\n    return undefined;\n  }, [show, onHide]);\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      buttons={[\n        { label: 'Cancel', onClick: (): void => onHide(), cancel: true },\n      ]}\n    >\n      <LoginModalContent />\n    </Modal>\n  );\n}\n","import React, { useState, useCallback } from 'react';\nimport {\n  faCaretDown,\n  faSignOutAlt,\n  faSignInAlt,\n  faUserCircle,\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { AccountContextValue, SignedIn } from '../../contexts/account';\nimport LoginModal from '../LoginModal';\nimport { DropdownMenu, DropdownMenuAction } from '../Select';\nimport Spinner from '../Spinner';\nimport { classes } from '../../utils/misc';\nimport { isAuthEnabled } from '../../data/firebase';\n\nimport './stylesheet.scss';\n\nexport type AccountDropdownProps = {\n  state: AccountContextValue | { type: 'loading' };\n  className?: string;\n  style?: React.CSSProperties;\n};\n\n/**\n * Renders the dropdown menu in the app header\n * that lets the user either:\n * - sign in if they aren't logged in,\n *   by displaying the login modal, or\n * - view who they are logged in as, and sign out if desired.\n * Additionally, it shows the initials of the user\n * in a circle when they are logged in\n * (similar to Google account \"icons\").\n */\nexport default function AccountDropdown({\n  state,\n  className,\n  style,\n}: AccountDropdownProps): React.ReactElement | null {\n  const [loginOpen, setLoginOpen] = useState(false);\n  const hideLogin = useCallback(() => setLoginOpen(false), []);\n\n  if (!isAuthEnabled) return null;\n\n  let items: DropdownMenuAction[];\n  let circleContent: React.ReactNode;\n  let disabled: boolean;\n  switch (state.type) {\n    case 'loading':\n      items = [];\n      circleContent = <Spinner size={24} />;\n      disabled = true;\n      break;\n    case 'signedIn':\n      items = [\n        {\n          label: <SignedInLabel state={state} />,\n        },\n        {\n          label: 'Sign out',\n          icon: faSignOutAlt,\n          onClick: (): void => state.signOut(),\n        },\n      ];\n      circleContent = <UserInitials state={state} />;\n      disabled = false;\n      break;\n    case 'signedOut':\n      items = [\n        {\n          label: 'Sign in',\n          icon: faSignInAlt,\n          onClick: (): void => {\n            setLoginOpen(true);\n          },\n        },\n      ];\n      circleContent = (\n        <FontAwesomeIcon\n          fixedWidth\n          icon={faUserCircle}\n          className=\"account-dropdown__signed-out-icon\"\n        />\n      );\n      disabled = false;\n      break;\n    default:\n      // unreachable\n      return null;\n  }\n\n  return (\n    <>\n      <DropdownMenu\n        disabled={disabled}\n        menuAnchor=\"right\"\n        items={items}\n        className={classes('account-dropdown', className)}\n        style={style}\n      >\n        <div className=\"account-dropdown__content\">\n          <div className=\"account-dropdown__circle\">{circleContent}</div>\n          <FontAwesomeIcon fixedWidth icon={faCaretDown} />\n        </div>\n      </DropdownMenu>\n      <LoginModal show={loginOpen} onHide={hideLogin} />\n    </>\n  );\n}\n\n// Private sub-components\n\ntype UserInitialsProps = {\n  state: SignedIn;\n};\n\n/**\n * Shows the initials of the user's name, email, or id where available,\n * changing the size of each letter depending on the number of initials.\n * Supports up to 3 initials.\n */\nfunction UserInitials({ state }: UserInitialsProps): React.ReactElement {\n  const initials = getInitials(state.name ?? state.email ?? state.id);\n  return (\n    <span\n      className=\"account-dropdown__user-initials\"\n      style={{\n        fontSize: initials.length <= 1 ? 22 : initials.length === 2 ? 19 : 15,\n      }}\n    >\n      {initials.slice(0, 3)}\n    </span>\n  );\n}\n\n/**\n * Extracts the initials from the given name\n */\nfunction getInitials(displayName: string): string {\n  // Decode the escaped HTML in the name here so we can extract its initials.\n  // Use the DOMParser API to avoid XSS while un-escaping:\n  // https://stackoverflow.com/a/34064434\n  // (the dangerousDisplayName variable can contain XSS; be careful)\n  const doc = new DOMParser().parseFromString(displayName, 'text/html');\n  const dangerousDisplayName = doc.documentElement.textContent ?? '';\n\n  const regex = /\\b\\w/g;\n  const matches = dangerousDisplayName.match(regex);\n  if (matches === null) return '';\n  return matches.join('');\n}\n\ntype SignedInLabelProps = {\n  state: SignedIn;\n};\n\n/**\n * Formats the text shown in the account dropdown when the user is signed in,\n * telling them their name, email, and provider when available.\n */\nfunction SignedInLabel({ state }: SignedInLabelProps): React.ReactElement {\n  let signedInAs: React.ReactNode;\n  if (state.name !== null) {\n    // Un-escape HTML entities and then pass them\n    // to React's default child sanitizer so that they are not escaped twice.\n    // Use the DOMParser API to avoid XSS while un-escaping:\n    // https://stackoverflow.com/a/34064434\n    // (the dangerousName variable can contain XSS; be careful)\n    const doc = new DOMParser().parseFromString(state.name, 'text/html');\n    const dangerousName = doc.documentElement.textContent ?? '';\n    const nameElement = <strong>{dangerousName}</strong>;\n\n    if (state.email !== null) {\n      signedInAs = (\n        <>\n          {nameElement} ({state.email})\n        </>\n      );\n    } else {\n      signedInAs = nameElement;\n    }\n  } else if (state.email !== null) {\n    signedInAs = state.email;\n  } else {\n    signedInAs = state.id;\n  }\n\n  let providerText = '';\n  if (state.provider !== null) {\n    providerText = ` via ${state.provider}`;\n  }\n\n  return (\n    <div>\n      <span className=\"account-dropdown__signed-in-label-faded\">\n        Signed in as:\n      </span>\n      <br />\n      {signedInAs}\n      <br />\n      <span className=\"account-dropdown__signed-in-label-faded\">\n        {providerText}\n      </span>\n    </div>\n  );\n}\n","import { faGithub } from '@fortawesome/free-brands-svg-icons';\nimport {\n  faDownload,\n  faCalendarAlt,\n  faPaste,\n  faAdjust,\n  faCaretDown,\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useCallback, useContext } from 'react';\n\nimport { Button } from '..';\nimport {\n  LARGE_MOBILE_BREAKPOINT,\n  LARGE_DESKTOP_BREAKPOINT,\n} from '../../constants';\nimport { ThemeContext } from '../../contexts';\nimport useMedia from '../../hooks/useMedia';\nimport { AccountContextValue } from '../../contexts/account';\nimport { classes } from '../../utils/misc';\nimport { DropdownMenu, DropdownMenuAction } from '../Select';\nimport AccountDropdown from '../AccountDropdown';\n\nimport './stylesheet.scss';\n\nexport type HeaderActionBarProps = {\n  className?: string;\n  style?: React.CSSProperties;\n  accountState: AccountContextValue | { type: 'loading' };\n  onCopyCrns?: () => void;\n  enableCopyCrns?: boolean;\n  onExportCalendar?: () => void;\n  enableExportCalendar?: boolean;\n  onDownloadCalendar?: () => void;\n  enableDownloadCalendar?: boolean;\n  handleThemeChange?: () => void;\n};\n\n/**\n * Displays the icon buttons (with optional text)\n * that appear at the top of the app in the header,\n * or if on a small mobile device, at the top of the app nav drawer,\n * This component is a simple display component,\n * letting any substantive state be passed in as props.\n */\nexport default function HeaderActionBar({\n  className,\n  style,\n  accountState,\n  onCopyCrns = (): void => undefined,\n  enableCopyCrns = false,\n  onExportCalendar = (): void => undefined,\n  enableExportCalendar = false,\n  onDownloadCalendar = (): void => undefined,\n  enableDownloadCalendar = false,\n}: HeaderActionBarProps): React.ReactElement {\n  const [theme, setTheme] = useContext(ThemeContext);\n  const handleThemeChange = useCallback(() => {\n    const newTheme = theme === 'light' ? 'dark' : 'light';\n    setTheme(newTheme);\n  }, [theme, setTheme]);\n\n  // Coalesce the export options into the props for a single <DropdownMenu>\n  const enableExport =\n    enableCopyCrns || enableDownloadCalendar || enableExportCalendar;\n  const exportActions: DropdownMenuAction[] = [];\n  if (enableDownloadCalendar) {\n    exportActions.push({\n      label: 'Download image',\n      icon: faDownload,\n      onClick: onDownloadCalendar,\n    });\n  }\n  if (enableExportCalendar) {\n    exportActions.push({\n      label: 'ICS (Calendar) file',\n      icon: faCalendarAlt,\n      onClick: onExportCalendar,\n    });\n  }\n  if (enableCopyCrns) {\n    exportActions.push({\n      label: 'Copy CRNs to clipboard',\n      icon: faPaste,\n      onClick: onCopyCrns,\n    });\n  }\n\n  // On small mobile screens and on large desktop,\n  // left-anchor the \"Export\" dropdown.\n  // Otherwise, anchor it to the right.\n  const lowerBound = LARGE_MOBILE_BREAKPOINT;\n  const upperBound = LARGE_DESKTOP_BREAKPOINT;\n  const shouldRightAnchorExportDropdown = useMedia(\n    `(min-width: ${lowerBound}px) and (max-width: ${upperBound}px)`\n  );\n\n  return (\n    <div className={classes('header-action-bar', className)} style={style}>\n      <DropdownMenu\n        disabled={!enableExport}\n        items={exportActions}\n        menuAnchor={shouldRightAnchorExportDropdown ? 'right' : 'left'}\n        className=\"header-action-bar__button\"\n      >\n        <div className=\"header-action-bar__export-dropdown-content\">\n          <FontAwesomeIcon\n            className=\"header-action-bar__button-icon\"\n            fixedWidth\n            icon={faDownload}\n          />\n          <div className=\"header-action-bar__button-text\">Export</div>\n          <FontAwesomeIcon fixedWidth icon={faCaretDown} />\n        </div>\n      </DropdownMenu>\n\n      <Button onClick={handleThemeChange} className=\"header-action-bar__button\">\n        <FontAwesomeIcon\n          className=\"header-action-bar__button-icon\"\n          fixedWidth\n          icon={faAdjust}\n        />\n        <div className=\"header-action-bar__button-text\">Theme</div>\n      </Button>\n      <Button\n        href=\"https://github.com/gt-scheduler/website\"\n        className=\"header-action-bar__button\"\n      >\n        <FontAwesomeIcon\n          className=\"header-action-bar__button-icon\"\n          fixedWidth\n          icon={faGithub}\n        />\n        <div className=\"header-action-bar__button-text\">GitHub</div>\n      </Button>\n\n      <AccountDropdown state={accountState} />\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faBars,\n  faPencilAlt,\n  faTrashAlt,\n  faCopy,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport { getSemesterName } from '../../utils/semesters';\nimport { Button, Select, Tab } from '..';\nimport { LoadingSelect, SelectAction } from '../Select';\nimport Spinner from '../Spinner';\nimport { getNextVersionName } from '../../utils/misc';\nimport { DESKTOP_BREAKPOINT, LARGE_MOBILE_BREAKPOINT } from '../../constants';\nimport useScreenWidth from '../../hooks/useScreenWidth';\nimport HeaderActionBar from '../HeaderActionBar';\nimport Modal from '../Modal';\nimport { AccountContextValue } from '../../contexts/account';\n\nimport './stylesheet.scss';\n\ntype VersionState =\n  | { type: 'loading' }\n  | {\n      type: 'loaded';\n      currentVersion: string;\n      allVersionNames: readonly { id: string; name: string }[];\n      setCurrentVersion: (next: string) => void;\n      addNewVersion: (name: string, select?: boolean) => string;\n      deleteVersion: (id: string) => void;\n      renameVersion: (id: string, newName: string) => void;\n      cloneVersion: (id: string, newName: string) => void;\n    };\n\nexport type HeaderDisplayProps = {\n  totalCredits?: number | null;\n  currentTab: number;\n  onChangeTab: (newTab: number) => void;\n  onToggleMenu: () => void;\n  tabs: string[];\n  onCopyCrns?: () => void;\n  enableCopyCrns?: boolean;\n  onExportCalendar?: () => void;\n  enableExportCalendar?: boolean;\n  onDownloadCalendar?: () => void;\n  enableDownloadCalendar?: boolean;\n  termsState:\n    | { type: 'loading' }\n    | {\n        type: 'loaded';\n        terms: readonly string[];\n        currentTerm: string;\n        onChangeTerm: (next: string) => void;\n      };\n  versionsState: VersionState;\n  accountState: AccountContextValue | { type: 'loading' };\n};\n\n/**\n * Renders the top header component as a simple display component,\n * letting any substantive state be passed in as props.\n * See `<Header>` for the full implementation that owns the header state.\n * This is safe to render without `ScheduleContext` or `TermsContext`\n * being present.\n */\nexport default function HeaderDisplay({\n  totalCredits = null,\n  currentTab,\n  onChangeTab,\n  onToggleMenu,\n  tabs,\n  onCopyCrns = (): void => undefined,\n  enableCopyCrns = false,\n  onExportCalendar = (): void => undefined,\n  enableExportCalendar = false,\n  onDownloadCalendar = (): void => undefined,\n  enableDownloadCalendar = false,\n  termsState,\n  versionsState,\n  accountState,\n}: HeaderDisplayProps): React.ReactElement {\n  // Re-render when the page is re-sized to become mobile/desktop\n  // (desktop is >= 1024 px wide)\n  const mobile = !useScreenWidth(DESKTOP_BREAKPOINT);\n\n  // Re-render when the page is re-sized to be small mobile vs. greater\n  // (small mobile is < 600 px wide)\n  const largeMobile = useScreenWidth(LARGE_MOBILE_BREAKPOINT);\n  return (\n    <div className=\"Header\">\n      {/* Menu button, only displayed on mobile */}\n      {mobile && (\n        <Button className=\"nav-menu-button\" onClick={onToggleMenu}>\n          <FontAwesomeIcon className=\"icon\" fixedWidth icon={faBars} />\n        </Button>\n      )}\n\n      {/* Left-aligned logo */}\n      <Button className=\"logo\">\n        <span className=\"gt\">GT </span>\n        <span className=\"scheduler\">Scheduler</span>\n      </Button>\n\n      {/* Term selector */}\n      {termsState.type === 'loaded' ? (\n        <Select\n          onChange={termsState.onChangeTerm}\n          current={termsState.currentTerm}\n          options={termsState.terms.map((currentTerm) => ({\n            id: currentTerm,\n            label: getSemesterName(currentTerm),\n          }))}\n          className=\"semester\"\n        />\n      ) : (\n        <LoadingSelect />\n      )}\n\n      {/* Version selector */}\n      <VersionSelector state={versionsState} />\n\n      <span className=\"credits\">\n        {totalCredits === null ? (\n          <Spinner size=\"small\" style={{ marginRight: 8 }} />\n        ) : (\n          totalCredits\n        )}{' '}\n        Credits\n      </span>\n\n      {/* Include middle-aligned tabs on desktop */}\n      {!mobile && (\n        <div className=\"tabs\">\n          {tabs.map((tabLabel, tabIdx) => (\n            <Tab\n              key={tabIdx}\n              active={tabIdx === currentTab}\n              onClick={(): void => onChangeTab(tabIdx)}\n              label={tabLabel}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Include action bar on large mobile and higher */}\n      {largeMobile && (\n        <HeaderActionBar\n          accountState={accountState}\n          onCopyCrns={onCopyCrns}\n          enableCopyCrns={enableCopyCrns}\n          onExportCalendar={onExportCalendar}\n          enableExportCalendar={enableExportCalendar}\n          onDownloadCalendar={onDownloadCalendar}\n          enableDownloadCalendar={enableDownloadCalendar}\n        />\n      )}\n    </div>\n  );\n}\n\n// Private sub-components\n\ntype VersionSelectorProps = {\n  state: VersionState;\n};\n\n/**\n * Allows users to:\n * - switch between existing schedule versions\n * - add new blank versions with default (Primary, Secondary, etc.) names\n * - delete and rename existing versions.\n */\nfunction VersionSelector({ state }: VersionSelectorProps): React.ReactElement {\n  // Manage the delete confirmation state,\n  // used to show a modal when it is non-null.\n  const [deleteConfirm, setDeleteConfirm] = useState<{\n    id: string;\n    name: string;\n  } | null>(null);\n\n  if (state.type === 'loading') {\n    return <LoadingSelect />;\n  }\n\n  return (\n    <>\n      <Select\n        className=\"version-switch\"\n        desiredItemWidth={260}\n        newLabel=\"New Schedule\"\n        onChange={state.setCurrentVersion}\n        current={state.currentVersion}\n        options={state.allVersionNames.map((version) => {\n          const actions: SelectAction<string>[] = [];\n\n          // Add the edit (rename) action\n          actions.push({\n            type: 'edit',\n            icon: faPencilAlt,\n            onCommit: (newName: string) => {\n              state.renameVersion(version.id, newName);\n              return true;\n            },\n          });\n\n          // Add the duplicate button\n          actions.push({\n            type: 'button',\n            icon: faCopy,\n            onClick: () => {\n              state.cloneVersion(version.id, `Copy of ${version.name}`);\n            },\n          });\n\n          // Add the delete action\n          if (state.allVersionNames.length >= 2) {\n            actions.push({\n              type: 'button',\n              icon: faTrashAlt,\n              onClick: () => {\n                // Display a confirmation dialog before deleting the version\n                setDeleteConfirm(version);\n              },\n            });\n          }\n\n          return {\n            id: version.id,\n            label: version.name,\n            actions,\n          };\n        })}\n        onClickNew={(): void => {\n          // Handle creating a new version with the auto-generated name\n          // (like 'Primary' or 'Secondary')\n          state.addNewVersion(\n            getNextVersionName(state.allVersionNames.map(({ name }) => name)),\n            true\n          );\n        }}\n      />\n\n      <Modal\n        show={deleteConfirm != null}\n        onHide={(): void => setDeleteConfirm(null)}\n        buttons={[\n          {\n            label: 'Cancel',\n            cancel: true,\n            onClick: (): void => setDeleteConfirm(null),\n          },\n          {\n            label: 'Delete',\n            onClick: (): void => {\n              if (deleteConfirm != null) {\n                state.deleteVersion(deleteConfirm.id);\n              }\n              setDeleteConfirm(null);\n            },\n          },\n        ]}\n        // Use this because we use the same state as the show prop\n        // to determine the contents of the children.\n        // This prevents the children from flashing\n        // a different value when the modal is disappearing.\n        preserveChildrenWhileHiding\n      >\n        <div style={{ textAlign: 'center' }}>\n          <h2>Delete confirmation</h2>\n          <p>\n            Are you sure you want to delete schedule &ldquo;\n            {deleteConfirm?.name ?? '<unknown>'}&rdquo;?\n          </p>\n        </div>\n      </Modal>\n    </>\n  );\n}\n","import React from 'react';\n\nexport type SignedOut = {\n  type: 'signedOut';\n};\n\nexport type SignedIn = {\n  type: 'signedIn';\n  signOut: () => void;\n  name: string | null;\n  provider: string | null;\n  email: string | null;\n  id: string;\n};\n\nexport type AccountContextValue = SignedOut | SignedIn;\nexport const AccountContext = React.createContext<AccountContextValue>({\n  type: 'signedOut',\n});\n","import copy from 'copy-to-clipboard';\nimport React, { useContext, useCallback } from 'react';\n\nimport { HeaderActionBarProps } from '../components/HeaderActionBar';\nimport { ScheduleContext, ThemeContext } from '../contexts';\nimport { AccountContext } from '../contexts/account';\nimport { softError, ErrorWithFields } from '../log';\nimport { exportCoursesToCalendar, downloadShadowCalendar } from '../utils/misc';\n\nexport type HookResult = Pick<\n  HeaderActionBarProps,\n  | 'onCopyCrns'\n  | 'enableCopyCrns'\n  | 'onExportCalendar'\n  | 'enableExportCalendar'\n  | 'onDownloadCalendar'\n  | 'enableDownloadCalendar'\n  | 'accountState'\n>;\n\n/**\n * Custom hook to prepare a majority of the `<HeaderActionBar>` props.\n * Requires a valid value for `ScheduleContext`, `ThemeContext`,\n * and `AccountContext`.\n */\nexport default function useHeaderActionBarProps(\n  captureRef: React.RefObject<HTMLDivElement>\n): HookResult {\n  const [{ oscar, pinnedCrns }] = useContext(ScheduleContext);\n  const [theme] = useContext(ThemeContext);\n  const accountState = useContext(AccountContext);\n\n  const handleExport = useCallback(() => {\n    try {\n      exportCoursesToCalendar(oscar, pinnedCrns);\n    } catch (err) {\n      softError(\n        new ErrorWithFields({\n          message: 'exporting courses to calendar failed',\n          fields: {\n            pinnedCrns,\n            term: oscar.term,\n          },\n        })\n      );\n    }\n  }, [oscar, pinnedCrns]);\n\n  const handleDownload = useCallback(() => {\n    const captureElement = captureRef.current;\n    if (captureElement == null) return;\n    try {\n      downloadShadowCalendar(captureElement, theme);\n    } catch (err) {\n      softError(\n        new ErrorWithFields({\n          message: 'downloading shadow calendar as PNG failed',\n          fields: {\n            pinnedCrns,\n            theme,\n            term: oscar.term,\n          },\n        })\n      );\n    }\n  }, [captureRef, theme, pinnedCrns, oscar.term]);\n\n  const handleCopyCrns = useCallback(() => {\n    try {\n      copy(pinnedCrns.join(', '));\n    } catch (err) {\n      softError(\n        new ErrorWithFields({\n          message: 'copying CRNs to clipboard failed',\n          fields: {\n            pinnedCrns,\n            term: oscar.term,\n          },\n        })\n      );\n    }\n  }, [pinnedCrns, oscar.term]);\n\n  return {\n    onCopyCrns: handleCopyCrns,\n    enableCopyCrns: pinnedCrns.length > 0,\n    onExportCalendar: handleExport,\n    enableDownloadCalendar: pinnedCrns.length > 0,\n    onDownloadCalendar: handleDownload,\n    enableExportCalendar: pinnedCrns.length > 0,\n    accountState,\n  };\n}\n","import React, { useContext, useMemo } from 'react';\n\nimport { ScheduleContext, TermsContext } from '../../contexts';\nimport HeaderDisplay from '../HeaderDisplay';\nimport useHeaderActionBarProps from '../../hooks/useHeaderActionBarProps';\n\nimport './stylesheet.scss';\n\nexport type HeaderProps = {\n  currentTab: number;\n  onChangeTab: (newTab: number) => void;\n  onToggleMenu: () => void;\n  tabs: string[];\n  captureRef: React.RefObject<HTMLDivElement>;\n};\n\n/**\n * Renders the top header component with all state/interactivity,\n * and includes controls for top-level tab-based navigation.\n * Acts as a wrapper around `<HeaderDisplay>` that provides all props.\n */\nexport default function Header({\n  currentTab,\n  onChangeTab,\n  onToggleMenu,\n  tabs,\n  captureRef,\n}: HeaderProps): React.ReactElement {\n  const [\n    { term, oscar, pinnedCrns, allVersionNames, currentVersion },\n    {\n      setTerm,\n      setCurrentVersion,\n      addNewVersion,\n      deleteVersion,\n      renameVersion,\n      cloneVersion,\n    },\n  ] = useContext(ScheduleContext);\n  const terms = useContext(TermsContext);\n\n  const totalCredits = useMemo(() => {\n    return pinnedCrns.reduce((credits, crn) => {\n      const crnSection = oscar.findSection(crn);\n      return credits + (crnSection != null ? crnSection.credits : 0);\n    }, 0);\n  }, [pinnedCrns, oscar]);\n\n  const headerActionBarProps = useHeaderActionBarProps(captureRef);\n\n  return (\n    <HeaderDisplay\n      totalCredits={totalCredits}\n      currentTab={currentTab}\n      onChangeTab={onChangeTab}\n      onToggleMenu={onToggleMenu}\n      tabs={tabs}\n      {...headerActionBarProps}\n      termsState={{\n        type: 'loaded',\n        terms,\n        currentTerm: term,\n        onChangeTerm: setTerm,\n      }}\n      versionsState={{\n        type: 'loaded',\n        allVersionNames,\n        currentVersion,\n        setCurrentVersion,\n        addNewVersion,\n        deleteVersion,\n        renameVersion,\n        cloneVersion,\n      }}\n    />\n  );\n}\n","import React, { useCallback, useContext, useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport {\n  faAngleDown,\n  faAngleUp,\n  faBan,\n  faGraduationCap,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport { classes, simplifyName, unique } from '../../utils/misc';\nimport { Section as SectionBean } from '../../data/beans';\nimport { ActionRow, Section } from '..';\nimport { ScheduleContext } from '../../contexts';\n\nimport './stylesheet.scss';\n\nexport type InstructorProps = {\n  className?: string;\n  color: string | undefined;\n  name: string;\n  sections: SectionBean[];\n  gpa: string;\n};\n\nexport default function Instructor({\n  className,\n  color,\n  name,\n  sections,\n  gpa,\n}: InstructorProps): React.ReactElement {\n  const [{ pinnedCrns, excludedCrns }, { patchSchedule }] =\n    useContext(ScheduleContext);\n  const [expanded, setExpanded] = useState(true);\n\n  const includeSection = useCallback(\n    (section: SectionBean) => {\n      patchSchedule({\n        excludedCrns: excludedCrns.filter((crn) => crn !== section.crn),\n      });\n    },\n    [excludedCrns, patchSchedule]\n  );\n\n  const excludeSections = useCallback(\n    (sectionList: SectionBean[]) => {\n      const crns = sectionList.map((section) => section.crn);\n      patchSchedule({\n        excludedCrns: unique([...excludedCrns, ...crns]),\n        pinnedCrns: pinnedCrns.filter((crn) => !crns.includes(crn)),\n      });\n    },\n    [excludedCrns, pinnedCrns, patchSchedule]\n  );\n\n  const instructorPinned = sections.some((section) =>\n    pinnedCrns.includes(section.crn)\n  );\n\n  const includedSections = sections.filter(\n    (section) => !excludedCrns.includes(section.crn)\n  );\n  const excludedSections = sections.filter((section) =>\n    excludedCrns.includes(section.crn)\n  );\n\n  const excludeTooltipId = `exclude-instructor-${name.replace(' ', '-')}`;\n  return (\n    <div\n      className={classes(\n        'Instructor',\n        !expanded && 'divider-bottom',\n        className\n      )}\n    >\n      <ActionRow\n        label={name || 'Not Assigned'}\n        actions={[\n          {\n            icon: expanded ? faAngleUp : faAngleDown,\n            onClick: (): void => setExpanded(!expanded),\n          },\n          !['TBA', 'Not Assigned'].includes(name)\n            ? {\n                icon: faGraduationCap,\n                href: `http://www.ratemyprofessors.com/search.jsp?queryBy=teacherName&schoolName=Georgia+Institute+of+Technology&query=${encodeURIComponent(\n                  simplifyName(name)\n                )}`,\n              }\n            : null,\n          {\n            icon: faBan,\n            dataTip: true,\n            dataFor: excludeTooltipId,\n            onClick: (): void => excludeSections(sections),\n          },\n        ]}\n        style={instructorPinned ? { backgroundColor: color } : undefined}\n      >\n        <div className=\"instructor-row\">\n          <span className=\"gpa\">Instructor GPA: {gpa || 'N/A'}</span>\n        </div>\n      </ActionRow>\n      <ReactTooltip\n        id={excludeTooltipId}\n        type=\"dark\"\n        place=\"bottom\"\n        effect=\"solid\"\n      >\n        Exclude from Combinations\n      </ReactTooltip>\n      {expanded && (\n        <div className={classes('section-container', 'nested')}>\n          {includedSections.map((section) => {\n            const pinned = pinnedCrns.includes(section.crn);\n            return (\n              <Section\n                key={section.id}\n                className=\"divider-bottom\"\n                section={section}\n                color={color}\n                pinned={pinned}\n              />\n            );\n          })}\n          {excludedSections.length > 0 && (\n            <div className=\"excluded-section-container\">\n              {excludedSections.map((section) => (\n                <span\n                  className=\"excluded-section\"\n                  key={section.id}\n                  onClick={(): void => includeSection(section)}\n                >\n                  {section.id}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useContext, useState } from 'react';\nimport ReactMapGL, { Marker, NavigationControl } from 'react-map-gl';\nimport { ViewState } from 'react-map-gl/src/mapbox/mapbox';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faMapPin } from '@fortawesome/free-solid-svg-icons';\n\nimport { Location } from '../../types';\nimport { ThemeContext } from '../../contexts';\n\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport './stylesheet.scss';\n\nexport type MapLocation = {\n  section: string;\n  id: string;\n  coords: Location | null;\n};\n\nexport type MapViewProps = {\n  locations: MapLocation[];\n};\n\nexport default function MapView({\n  locations,\n}: MapViewProps): React.ReactElement {\n  // These initial coordinates start the map looking at the GT Atlanta campus\n  const [viewState, setViewState] = useState<ViewState>({\n    latitude: 33.7765,\n    longitude: -84.3963,\n    zoom: 15,\n  });\n\n  const unknown: MapLocation[] = [];\n  const coordsToLocationsMap = new Map<Location, MapLocation[]>();\n  locations.forEach((location) => {\n    if (location.coords === null) {\n      unknown.push(location);\n    } else if (coordsToLocationsMap.has(location.coords)) {\n      coordsToLocationsMap.get(location.coords)?.push(location);\n    } else {\n      coordsToLocationsMap.set(location.coords, [location]);\n    }\n  });\n\n  // Switch the map style based on the current theme.\n  // These are custom styles owned by the Mapbox account in the BitWarden.\n  // Public share links:\n  // Dark: https://api.mapbox.com/styles/v1/gt-scheduler/cktc4yzhm018w17ql65xa802o.html?fresh=true&title=copy&access_token=pk.eyJ1IjoiZ3Qtc2NoZWR1bGVyIiwiYSI6ImNrdGM0cXlqMDA0aXYyeHBma290Y2NyOTgifQ.S_A1gOu-FSQ8ywQFf2rr5A\n  // Light: https://api.mapbox.com/styles/v1/gt-scheduler/cktc4y61t018918qjynvngozg.html?fresh=true&title=copy&access_token=pk.eyJ1IjoiZ3Qtc2NoZWR1bGVyIiwiYSI6ImNrdGM0cXlqMDA0aXYyeHBma290Y2NyOTgifQ.S_A1gOu-FSQ8ywQFf2rr5A\n  const [theme] = useContext(ThemeContext);\n  const mapStyle =\n    theme === 'dark'\n      ? 'mapbox://styles/gt-scheduler/cktc4yzhm018w17ql65xa802o' // gt-scheduler-dark\n      : 'mapbox://styles/gt-scheduler/cktc4y61t018918qjynvngozg'; // gt-scheduler-light\n\n  return (\n    <div className=\"mapbox\">\n      <ReactMapGL\n        height=\"100%\"\n        width=\"100%\"\n        viewState={viewState}\n        mapStyle={mapStyle}\n        mapboxApiAccessToken={process.env['REACT_APP_MAPBOX_TOKEN'] ?? ''}\n        onViewStateChange={({\n          viewState: newViewState,\n        }: {\n          viewState: ViewState;\n        }): void => setViewState(newViewState)}\n      >\n        {Array.from(coordsToLocationsMap.entries()).map(\n          ([coords, coordLocations], i) => (\n            <Marker key={i} latitude={coords.lat} longitude={coords.long}>\n              <FontAwesomeIcon icon={faMapPin} className=\"pin-icon\" />\n              <div className=\"pin-text\">\n                {coordLocations.map((coordLocation) => (\n                  <div key={coordLocation.id + coordLocation.section}>\n                    {coordLocation.id} {coordLocation.section}\n                  </div>\n                ))}\n              </div>\n            </Marker>\n          )\n        )}\n        {unknown.length > 0 && (\n          <div className=\"unknown-container\">\n            <b>Undetermined</b>\n            {unknown.map((location, i) => (\n              <div className=\"class\" key={i}>\n                {location.id} {location.section}\n              </div>\n            ))}\n          </div>\n        )}\n        <div className=\"navigation\">\n          <NavigationControl showZoom showCompass />\n        </div>\n      </ReactMapGL>\n    </div>\n  );\n}\n","import React, { useContext } from 'react';\nimport { faAngleDown, faAngleUp } from '@fortawesome/free-solid-svg-icons';\n\nimport { ActionRow } from '..';\nimport { classes, getContentClassName } from '../../utils/misc';\nimport { Period } from '../../types';\nimport { ThemeContext } from '../../contexts';\n\nimport './stylesheet.scss';\n\nexport type Day = 'M' | 'T' | 'W' | 'R' | 'F';\n\nexport function isDay(rawDay: string): rawDay is Day {\n  switch (rawDay) {\n    case 'M':\n    case 'T':\n    case 'W':\n    case 'R':\n    case 'F':\n      return true;\n    default:\n      return false;\n  }\n}\n\nexport interface CourseDateItem {\n  id: string;\n  title: string;\n  times: Period | undefined;\n  daysOfWeek: string[];\n}\n\nexport type DaySelectionProps = {\n  courseDateMap: Record<Day, CourseDateItem[]>;\n  activeDay: Day | '';\n  setActiveDay: (next: Day | '') => void;\n};\n\nconst LIGHT_COLOR_PALETTE = [\n  '#FCB9AA',\n  '#FFDBCC',\n  '#ECEAE4',\n  '#A2E1DB',\n  '#55CBCD',\n];\nconst DARK_COLOR_PALETTE = [\n  '#5e3931',\n  '#704737',\n  '#685a30',\n  '#3c6962',\n  '#286061',\n];\n\nexport default function DaySelection({\n  courseDateMap,\n  activeDay,\n  setActiveDay,\n}: DaySelectionProps): React.ReactElement {\n  const daysOfTheWeek = [\n    'Monday',\n    'Tuesday',\n    'Wednesday',\n    'Thursday',\n    'Friday',\n  ];\n\n  // Switch the color palette based on the current theme.\n  const [theme] = useContext(ThemeContext);\n  const colorPalette =\n    theme === 'dark' ? DARK_COLOR_PALETTE : LIGHT_COLOR_PALETTE;\n\n  const formatTime = (time: number): string => {\n    if (Math.floor(time / 60) >= 12) {\n      const adjustedHour = Math.floor(time / 60) % 12;\n      const hour = adjustedHour === 0 ? '12' : adjustedHour;\n      const minute = String(time % 60).padStart(2, '0');\n      return `${hour}:${minute}pm`;\n    }\n\n    const hour = Math.floor(time / 60);\n    const minute = String(time % 60).padStart(2, '0');\n    return `${hour}:${minute}am`;\n  };\n\n  return (\n    <div className=\"date-container\">\n      {Object.keys(courseDateMap).map((date, i) => {\n        if (!isDay(date)) return null;\n        const courses = courseDateMap[date];\n        return (\n          <div\n            key={date}\n            className={classes(\n              'date',\n              getContentClassName(colorPalette[i]),\n              'default'\n            )}\n            style={{ backgroundColor: colorPalette[i] }}\n          >\n            <ActionRow\n              label={daysOfTheWeek[i] ?? ''}\n              className=\"day-select\"\n              actions={[\n                {\n                  icon: date === activeDay ? faAngleUp : faAngleDown,\n                  onClick: (): void =>\n                    date !== activeDay ? setActiveDay(date) : setActiveDay(''),\n                },\n              ]}\n            />\n            {activeDay === date && (\n              <div className=\"dropdown-content\">\n                {courses == null || courses.length === 0 ? (\n                  <div className=\"course-content\" style={{ padding: 8 }}>\n                    No classes this day!\n                  </div>\n                ) : (\n                  courses.map((course) => {\n                    let timeLabel = 'TBA';\n                    const { times } = course;\n                    if (times != null) {\n                      const { start, end } = times;\n                      timeLabel = `${formatTime(start)} - ${formatTime(end)}`;\n                    }\n\n                    return (\n                      <div className=\"course-content\" key={course.id}>\n                        <div className=\"course-id\">{course.id}</div>\n                        <span className=\"course-row\">{course.title}</span>\n                        <span className=\"course-row\">\n                          {course.daysOfWeek} {timeLabel}\n                        </span>\n                      </div>\n                    );\n                  })\n                )}\n              </div>\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","import React, { useContext, useState } from 'react';\n\nimport MapView, { MapLocation } from '../MapView';\nimport { ScheduleContext } from '../../contexts';\nimport DaySelection, { CourseDateItem, Day, isDay } from '../DaySelection';\nimport { Meeting } from '../../types';\n\nimport './stylesheet.scss';\n\n// Construct combined course data\n// to pass to `<MapView>` and `<DaySelection>`\ntype CombinedCourseData = CourseDateItem & MapLocation;\n\nexport default function Map(): React.ReactElement {\n  const [{ oscar, pinnedCrns }] = useContext(ScheduleContext);\n  const [activeDay, setActiveDay] = useState<Day | ''>('M');\n  const courseDateMap: Record<Day, CombinedCourseData[]> = {\n    M: [],\n    T: [],\n    W: [],\n    R: [],\n    F: [],\n  };\n\n  // Construct the course data for the first meeting of each class\n  pinnedCrns.forEach((crn) => {\n    const section = oscar.findSection(crn);\n    if (section == null) return;\n    const { meetings } = section;\n    if (meetings.length === 0) return;\n    const firstMeeting = meetings[0] as Meeting;\n\n    firstMeeting.days.forEach((day) => {\n      if (!isDay(day)) return;\n      const courses = courseDateMap[day] ?? [];\n      courses.push({\n        id: section.course.id,\n        title: section.course.title,\n        times: firstMeeting.period,\n        daysOfWeek: firstMeeting.days,\n        section: section.id,\n        coords: firstMeeting.location,\n      });\n      courseDateMap[day] = courses;\n    });\n  });\n\n  // Sort each list of course data by their times\n  const sortedCourseDateMap: Record<Day, CombinedCourseData[]> = {\n    M: [],\n    T: [],\n    W: [],\n    R: [],\n    F: [],\n  };\n  Object.entries(courseDateMap).forEach(([day, courseDataList]) => {\n    if (!isDay(day)) return;\n    sortedCourseDateMap[day] = courseDataList.sort(\n      (a, b) => (a.times?.start ?? 0) - (b.times?.start ?? 0)\n    );\n  });\n\n  let activeLocations: MapLocation[] = [];\n  if (activeDay !== '') {\n    activeLocations = sortedCourseDateMap[activeDay];\n  }\n\n  return (\n    <div className=\"map-content\">\n      <DaySelection\n        courseDateMap={sortedCourseDateMap}\n        activeDay={activeDay}\n        setActiveDay={setActiveDay}\n      />\n      <MapView locations={activeLocations} />\n    </div>\n  );\n}\n","import React from 'react';\nimport { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { classes } from '../../utils/misc';\nimport { Button } from '..';\n\nimport './stylesheet.scss';\n\nexport type NavDrawerProps = {\n  open: boolean;\n  onClose: () => void;\n  children: React.ReactNode;\n};\n\n/**\n * Renders a nav drawer and the overlay when it is open\n */\nexport default function NavDrawer({\n  open,\n  onClose,\n  children,\n}: NavDrawerProps): React.ReactElement {\n  return (\n    <>\n      <div\n        className={classes('drawer-overlay', open && 'open')}\n        tabIndex={-1}\n        onClick={onClose}\n        role=\"presentation\"\n      />\n      <div className={classes('drawer-outer', open && 'open')}>\n        <div className=\"drawer-header\">\n          <Button className=\"drawer-close\" onClick={onClose}>\n            <FontAwesomeIcon className=\"icon\" fixedWidth icon={faTimes} />\n          </Button>\n        </div>\n        {children}\n      </div>\n    </>\n  );\n}\n","import React from 'react';\n\nimport { Button } from '..';\nimport { classes } from '../../utils/misc';\n\nimport './stylesheet.scss';\n\nexport type NavMenuProps = {\n  items: string[];\n  currentItem: number;\n  onChangeItem: (next: number) => void;\n  className?: string;\n  style?: React.CSSProperties;\n};\n\n/**\n * Renders a vertical nav menu with a single active item\n */\nexport default function NavMenu({\n  items,\n  currentItem,\n  onChangeItem,\n  className,\n  style,\n}: NavMenuProps): React.ReactElement {\n  return (\n    <div className={classes('nav-menu', className)} style={style}>\n      {items.map((item, idx) => (\n        <Button\n          className={classes('nav-button', currentItem === idx && 'active')}\n          onClick={(): void => onChangeItem(idx)}\n          key={idx}\n        >\n          {item}\n        </Button>\n      ))}\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { classes } from '../../utils/misc';\nimport { PALETTE } from '../../constants';\n\nimport './stylesheet.scss';\n\nexport type PaletteProps = {\n  className?: string;\n  color: string | null;\n  onSelectColor: (newColor: string) => void;\n  onMouseLeave: () => void;\n};\n\nexport default function Palette({\n  className,\n  color,\n  onSelectColor,\n  onMouseLeave,\n}: PaletteProps): React.ReactElement {\n  return (\n    <div className={classes('Palette', className)} onMouseLeave={onMouseLeave}>\n      {PALETTE.map((colors, i) => (\n        <div className=\"palette-row\" key={i}>\n          {colors.map((paletteColor) => (\n            <div\n              className={classes('color', paletteColor === color && 'frame')}\n              key={paletteColor}\n              style={{ backgroundColor: paletteColor }}\n              onClick={(): void => onSelectColor(paletteColor)}\n            />\n          ))}\n        </div>\n      ))}\n    </div>\n  );\n}\n","import React, { useContext, useState } from 'react';\nimport {\n  faInfoCircle,\n  faAngleUp,\n  faAngleDown,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport { ScheduleContext } from '../../contexts';\nimport { classes, serializePrereqs } from '../../utils/misc';\nimport { ActionRow } from '..';\nimport { Course } from '../../data/beans';\nimport {\n  CrawlerPrerequisites,\n  PrerequisiteClause,\n  PrerequisiteOperator,\n} from '../../types';\nimport { ErrorWithFields, softError } from '../../log';\n\nconst BASE_ITEM_STYLE = { fontSize: '0.9em', padding: '8px' };\n\nexport type PrerequisiteProps = {\n  course: Course;\n  prereqs: CrawlerPrerequisites;\n};\n\n/**\n * Renders the prereqs for a single course, given that the crawler version\n * supports prereqs. (Make sure to check this before). An empty prereq list is\n * an authoritative statement that the course has no prereqs, and as such a\n * message will be displayed telling the user. Otherwise, this component tries\n * to render the prereq tree in a way that is easily consumable without taking\n * up too much screen space, first trying to split the prereqs up into separate\n * \"options\" (sub-clauses of an OR set) if possible before rendering a list of\n * items with operators in between. Finally, in each item, there is the\n * flattened textual representation of the remainder of the subtree, which\n * restores parentheses groupings (much like the original Oscar prereq syntax)\n */\nexport default function Prerequisite({\n  course,\n  prereqs,\n}: PrerequisiteProps): React.ReactElement {\n  let content: React.ReactNode;\n  if (prereqs.length === 0) {\n    content = <PrerequisiteEmpty />;\n  } else {\n    // `prereqs` isn't an empty array, so it must be `PrerequisiteSet`\n    // (here we manually `Exclude` the empty array case)\n    const [op, ...subClauses] = prereqs as Exclude<CrawlerPrerequisites, []>;\n\n    switch (op) {\n      case 'and':\n        // We only consider this a single \"option\",\n        // so just render the content as a direct child\n        content = <PrerequisiteClauseDisplay clause={['and', ...subClauses]} />;\n        break;\n      case 'or':\n        if (subClauses.length === 1) {\n          // There is only 1 option:\n          // just render the content as a direct child\n          content = (\n            <PrerequisiteClauseDisplay\n              clause={subClauses[0] as PrerequisiteClause}\n            />\n          );\n        } else {\n          // Render an option for each sub-clause\n          content = (\n            <>\n              {subClauses.map((subClause, i) => (\n                <PrerequisiteOption key={i} clause={subClause} index={i} />\n              ))}\n            </>\n          );\n        }\n        break;\n      default:\n        softError(\n          new ErrorWithFields({\n            message: 'invalid operator found in top-level prereqs',\n            fields: {\n              courseId: course.id,\n              operator: op,\n              term: course.term,\n            },\n          })\n        );\n        content = null;\n    }\n  }\n\n  return (\n    <div className={classes('hover-container', 'nested')}>\n      <PrerequisiteHeader course={course} />\n      <div className={classes('nested')}>{content}</div>\n    </div>\n  );\n}\n\n// Private sub-components\n\ntype PrerequisiteHeaderProps = {\n  course: Course;\n};\n\n/**\n * Renders the \"header\" at the top of a prereq display,\n * which includes a link to Oscar giving the original prereq source,\n * plus other course information.\n */\nfunction PrerequisiteHeader({\n  course,\n}: PrerequisiteHeaderProps): React.ReactElement {\n  const [{ term }] = useContext(ScheduleContext);\n\n  return (\n    <ActionRow\n      className={classes('hover-container')}\n      label=\"Prerequisites\"\n      actions={[\n        {\n          icon: faInfoCircle,\n          href:\n            `https://oscar.gatech.edu/pls/bprod/bwckctlg.p_disp_` +\n            `course_detail?cat_term_in=${term}&subj_code_in=` +\n            `${course.subject}&crse_numb_in=${course.number}`,\n        },\n      ]}\n    />\n  );\n}\n\ntype PrerequisiteOptionProps = {\n  clause: PrerequisiteClause;\n  index: number;\n};\n\n/**\n * Renders a single prereq option -- a sub-clause of a larger \"OR\" prereq set\n * that is independently collapse-able from the other sibling options.\n * Inside, uses `PrerequisiteClauseDisplay` to render the sub-clause if\n * the option is expanded.\n */\nfunction PrerequisiteOption({\n  clause,\n  index,\n}: PrerequisiteOptionProps): React.ReactElement {\n  const [expanded, setExpanded] = useState(true);\n\n  return (\n    <>\n      <ActionRow\n        className={classes('hover-container')}\n        label={`Option ${index + 1}`}\n        actions={[\n          {\n            icon: expanded ? faAngleUp : faAngleDown,\n            onClick: (): void => setExpanded(!expanded),\n          },\n        ]}\n      />\n      {expanded && (\n        <div className={classes('nested')}>\n          <PrerequisiteClauseDisplay clause={clause} />\n        </div>\n      )}\n    </>\n  );\n}\n\ntype PrerequisiteClauseDisplayProps = {\n  clause: PrerequisiteClause;\n};\n\n/**\n * Renders an arbitrary prereq clause. If the clause is a singular course,\n * then it renders a single Item. Otherwise, if the clause is a set,\n * this component renders an item for each member of the set, and includes\n * an operator at the end of each item's text to indicate that each item\n * is part of a larger prereq set.\n */\nfunction PrerequisiteClauseDisplay({\n  clause,\n}: PrerequisiteClauseDisplayProps): React.ReactElement {\n  if (!Array.isArray(clause)) {\n    // Render the single prereq course\n    return <PrerequisiteItem clause={clause} operator=\"and\" isLast />;\n  }\n\n  // Render a list of prereq items\n  const [operator, ...subClauses] = clause;\n  return (\n    <>\n      {subClauses.map((subClause, i) => (\n        <PrerequisiteItem\n          key={i}\n          clause={subClause}\n          operator={operator}\n          isLast={i === subClauses.length - 1}\n        />\n      ))}\n    </>\n  );\n}\n\ntype PrerequisiteItemProps = {\n  clause: PrerequisiteClause;\n  operator: PrerequisiteOperator;\n  isLast: boolean;\n};\n\n/**\n * Renders a single \"item\" -- a div with the completely flattened text\n * representation of the prereq subtree passed in as `clause` (whether\n * that's a single prereq course or a sprawling sub-tree with many branches).\n * Includes the ability to display a higher-level operator between different\n * `PrerequisiteItem`'s as long as `isLast` is false, which is used by\n * `PrerequisiteClauseDisplay` when it needs to render a prerequisite set.\n */\nfunction PrerequisiteItem({\n  clause,\n  operator,\n  isLast,\n}: PrerequisiteItemProps): React.ReactElement {\n  return (\n    <div className={classes('divider-bottom')} style={BASE_ITEM_STYLE}>\n      {serializePrereqs(clause)} {!isLast && <strong>{operator}</strong>}\n    </div>\n  );\n}\n\n/**\n * Replacement prerequisite \"item\"-like component that simply contains\n * a notification to the user that the course has no prereqs.\n */\nfunction PrerequisiteEmpty(): React.ReactElement {\n  return (\n    <div style={BASE_ITEM_STYLE}>No prerequisites. You&apos;re good to go!</div>\n  );\n}\n","import React, { useMemo, useState } from 'react';\n\nimport { classes } from '../../utils/misc';\nimport { Button, Calendar, CombinationContainer, CourseContainer } from '..';\nimport { OverlayCrnsContext, OverlayCrnsContextValue } from '../../contexts';\nimport { DESKTOP_BREAKPOINT } from '../../constants';\nimport useScreenWidth from '../../hooks/useScreenWidth';\n\n/**\n * Wraps around the root top-level component of the Scheduler tab\n */\nexport default function Scheduler(): React.ReactElement {\n  const mobile = !useScreenWidth(DESKTOP_BREAKPOINT);\n\n  // Store the current set of CRNs that are shown on the Calendar overlay\n  const [overlayCrns, setOverlayCrns] = useState<string[]>([]);\n\n  // Control second-level navigation between panes on mobile\n  const [tabIndex, setTabIndex] = useState<number>(0);\n\n  // Memoize the CRN overlay set's context value so it is stable\n  const overlayContextValue = useMemo<OverlayCrnsContextValue>(\n    () => [overlayCrns, setOverlayCrns],\n    [overlayCrns, setOverlayCrns]\n  );\n\n  return (\n    <>\n      {mobile && (\n        <div className=\"tab-container\">\n          {['Courses', 'Combinations', 'Calendar'].map((tabTitle, i) => (\n            <Button\n              key={tabTitle}\n              className={classes('tab', tabIndex === i && 'active')}\n              onClick={(): void => setTabIndex(i)}\n            >\n              {tabTitle}\n            </Button>\n          ))}\n        </div>\n      )}\n      <OverlayCrnsContext.Provider value={overlayContextValue}>\n        <div className=\"main\">\n          {(!mobile || tabIndex === 0) && <CourseContainer />}\n          {(!mobile || tabIndex === 1) && <CombinationContainer />}\n          {(!mobile || tabIndex === 2) && (\n            <div className=\"calendar-container\">\n              <Calendar className=\"calendar\" overlayCrns={overlayCrns} />\n            </div>\n          )}\n        </div>\n      </OverlayCrnsContext.Provider>\n    </>\n  );\n}\n","import React, { useCallback, useContext, useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport {\n  faBan,\n  faChair,\n  faThumbtack,\n  faTimes,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport { classes, periodToString } from '../../utils/misc';\nimport { ActionRow } from '..';\nimport { OverlayCrnsContext, ScheduleContext } from '../../contexts';\nimport { DELIVERY_MODES } from '../../constants';\nimport { Section as SectionBean } from '../../data/beans';\nimport { Seating } from '../../data/beans/Section';\nimport { ErrorWithFields, softError } from '../../log';\n\nimport './stylesheet.scss';\n\nexport type SectionProps = {\n  className?: string;\n  section: SectionBean;\n  pinned: boolean;\n  color: string | undefined;\n};\n\nexport default function Section({\n  className,\n  section,\n  pinned,\n  color,\n}: SectionProps): React.ReactElement {\n  const [{ term, pinnedCrns, excludedCrns }, { patchSchedule }] =\n    useContext(ScheduleContext);\n  const [, setOverlayCrns] = useContext(OverlayCrnsContext);\n  const [seating, setSeating] = useState<Seating>([[], 0]);\n\n  let hovering = false;\n  const handleHover = (): void => {\n    hovering = true;\n    setTimeout(() => {\n      if (hovering) {\n        section\n          .fetchSeating(term)\n          .then((newSeating) => {\n            setSeating(newSeating);\n          })\n          .catch((err) =>\n            softError(\n              new ErrorWithFields({\n                message: 'error while fetching seating',\n                source: err,\n                fields: { crn: section.crn, term: section.term },\n              })\n            )\n          );\n      }\n    }, 333);\n  };\n\n  const excludeSection = useCallback(\n    (sect: SectionBean) => {\n      patchSchedule({\n        excludedCrns: [...excludedCrns, sect.crn],\n        pinnedCrns: pinnedCrns.filter((crn) => crn !== sect.crn),\n      });\n    },\n    [pinnedCrns, excludedCrns, patchSchedule]\n  );\n\n  const pinSection = useCallback(\n    (sect: SectionBean) => {\n      if (pinnedCrns.includes(sect.crn)) {\n        patchSchedule({\n          pinnedCrns: pinnedCrns.filter((crn) => crn !== sect.crn),\n        });\n      } else {\n        patchSchedule({\n          pinnedCrns: [...pinnedCrns, sect.crn],\n          excludedCrns: excludedCrns.filter((crn) => crn !== sect.crn),\n        });\n      }\n    },\n    [pinnedCrns, excludedCrns, patchSchedule]\n  );\n\n  const excludeTooltipId = `section-exclude-${section.id}`;\n  return (\n    <ActionRow\n      label={section.id}\n      className={classes('Section', className)}\n      onMouseEnter={(): void => setOverlayCrns([section.crn])}\n      onMouseLeave={(): void => setOverlayCrns([])}\n      actions={[\n        {\n          icon: pinned ? faTimes : faThumbtack,\n          onClick: (): void => pinSection(section),\n        },\n        {\n          icon: faChair,\n          dataTip: true,\n          dataFor: section.id,\n          href: `https://oscar.gatech.edu/pls/bprod/bwckschd.p_disp_detail_sched?term_in=${term}&crn_in=${section.crn}`,\n        },\n        {\n          icon: faBan,\n          dataTip: true,\n          dataFor: excludeTooltipId,\n          onClick: (): void => excludeSection(section),\n        },\n      ]}\n      style={pinned ? { backgroundColor: color } : undefined}\n    >\n      <ReactTooltip\n        id={excludeTooltipId}\n        className=\"tooltip\"\n        type=\"dark\"\n        place=\"right\"\n        effect=\"solid\"\n      >\n        Exclude from Combinations\n      </ReactTooltip>\n      <div className=\"section-details\">\n        <div className=\"delivery-mode\">\n          {section.deliveryMode != null\n            ? DELIVERY_MODES[section.deliveryMode]\n            : ''}\n        </div>\n        <div className=\"meeting-container\">\n          {section.meetings.map((meeting, i) => {\n            return (\n              <div className=\"meeting\" key={i}>\n                <span className=\"days\">{meeting.days.join('')}</span>\n                <span className=\"period\">{periodToString(meeting.period)}</span>\n              </div>\n            );\n          })}\n        </div>\n\n        <ReactTooltip\n          id={section.id}\n          className=\"tooltip\"\n          type=\"dark\"\n          place=\"right\"\n          effect=\"solid\"\n          afterShow={(): void => handleHover()}\n          afterHide={(): void => {\n            hovering = false;\n          }}\n        >\n          <table>\n            <tbody>\n              <tr>\n                <td>\n                  <b>Seats Filled</b>\n                </td>\n                <td>\n                  {seating[0].length === 0\n                    ? `Loading...`\n                    : typeof seating[0][1] === 'number'\n                    ? `${seating[0][1] ?? '<unknown>'} of ${\n                        seating[0][0] ?? '<unknown>'\n                      }`\n                    : `N/A`}\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  <b>Waitlist Filled</b>\n                </td>\n                <td>\n                  {seating[0].length === 0\n                    ? `Loading...`\n                    : typeof seating[0][1] === 'number'\n                    ? `${seating[0][3] ?? '<unknown>'} of ${\n                        seating[0][2] ?? '<unknown>'\n                      }`\n                    : `N/A`}\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </ReactTooltip>\n      </div>\n    </ActionRow>\n  );\n}\n","import React from 'react';\n\nimport { classes } from '../../utils/misc';\n\nimport './stylesheet.scss';\n\nexport type TabProps = {\n  label: string;\n  onClick: () => void;\n  active?: boolean;\n  className?: string;\n  style?: React.CSSProperties;\n};\n\n/**\n * Renders a single top-level tab that is used in a horizontal list\n */\nexport default function Tab({\n  label,\n  active = false,\n  onClick,\n  className,\n  style,\n}: TabProps): React.ReactElement {\n  return (\n    <button\n      className={classes('Tab', active && 'active', className)}\n      style={style}\n      onClick={onClick}\n      type=\"button\"\n    >\n      {label}\n    </button>\n  );\n}\n","import React from 'react';\n\nimport { classes } from '../../utils/misc';\nimport { DESKTOP_BREAKPOINT } from '../../constants';\nimport useScreenWidth from '../../hooks/useScreenWidth';\n\nimport './stylesheet.scss';\n\nexport default function Attribution(): React.ReactElement {\n  const mobile = !useScreenWidth(DESKTOP_BREAKPOINT);\n  return (\n    <div className={classes('Attribution')}>\n      <p>\n        Copyright (c) 2021 with{' '}\n        <span role=\"img\" aria-label=\"love\">\n          ❤️\n        </span>{' '}\n        by <a href=\"https://jasonpark.me\">Jinseo Park</a>,{' '}\n        <a href=\"https://bitsofgood.org\">Bits of Good</a>, and{' '}\n        <a href=\"https://github.com/gt-scheduler/website/graphs/contributors\">\n          {mobile ? 'others' : 'the GT Scheduler contributors'}\n        </a>\n        .\n      </p>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport axios from 'axios';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCommentAlt, faTimes } from '@fortawesome/free-solid-svg-icons';\n\nimport { Button } from '..';\nimport { classes } from '../../utils/misc';\nimport { BACKEND_BASE_URL } from '../../constants';\n\nimport './stylesheet.scss';\n\nexport default function Feedback(): React.ReactElement {\n  const [expanded, setExpanded] = useState<boolean>(false);\n  const [submit, setSubmit] = useState<boolean>(false);\n  const [rating, setRating] = useState<number | null>(null);\n  const [feedback, setFeedback] = useState<string>('');\n  const [loading, setLoading] = useState<boolean>(false);\n\n  const onSubmit = (): void => {\n    setLoading(true);\n    // Add 1 to the rating to move it from [0,4] to [1,5]\n    submitFeedback({ rating: (rating ?? 0) + 1, feedback })\n      .then(() => {\n        setSubmit(true);\n        setLoading(false);\n      })\n      .catch(() => {\n        setSubmit(true);\n        setLoading(false);\n      });\n  };\n\n  return (\n    <>\n      {!expanded && (\n        <div className=\"FeedbackButtonWrapper\">\n          <Button\n            className=\"FeedbackButton\"\n            onClick={(): void => setExpanded(true)}\n          >\n            <FontAwesomeIcon icon={faCommentAlt} size=\"2x\" />\n          </Button>\n        </div>\n      )}\n      {expanded && (\n        <div>\n          <form className=\"FeedbackForm\">\n            <div className=\"container\">\n              <FontAwesomeIcon\n                icon={faTimes}\n                className=\"CloseIcon\"\n                onClick={(): void => setExpanded(false)}\n              />\n              <h3 className=\"FeedbackTitle\">Feedback</h3>\n              {!submit && (\n                <div>\n                  <p className=\"text\">How would you rate your experience?</p>\n                  <div className=\"FormButtons\">\n                    {[1, 2, 3, 4, 5].map((i) => (\n                      <Button\n                        key={i}\n                        className={classes(\n                          'FormButton',\n                          rating === i - 1 && 'active'\n                        )}\n                        onClick={(): void => setRating(i - 1)}\n                      >\n                        {i}\n                      </Button>\n                    ))}\n                  </div>\n                  <div className=\"ScoreLabels\">\n                    <span className=\"score\" style={{ marginLeft: '4px' }}>\n                      Poor\n                    </span>\n                    <span className=\"score\" style={{ marginRight: '4px' }}>\n                      Great\n                    </span>\n                  </div>\n                  <textarea\n                    className=\"FeedbackTextArea\"\n                    placeholder=\"Please let us know if you have any more feedback!\"\n                    onChange={(event): void => setFeedback(event.target.value)}\n                    value={feedback}\n                  />\n                  <Button\n                    className=\"SubmitButton\"\n                    onClick={onSubmit}\n                    disabled={rating == null || loading}\n                  >\n                    Submit\n                  </Button>\n                </div>\n              )}\n              {submit && (\n                <div className=\"submitted\">\n                  <p className=\"submitted-thanks text\">\n                    <span>Thank you for your feedback!</span>\n                  </p>\n                  <div>\n                    <Button\n                      className=\"SubmitButton\"\n                      onClick={(): void => setExpanded(false)}\n                    >\n                      Close\n                    </Button>\n                  </div>\n                </div>\n              )}\n            </div>\n          </form>\n        </div>\n      )}\n    </>\n  );\n}\n\nasync function submitFeedback({\n  rating,\n  feedback,\n}: {\n  rating: number;\n  feedback: string;\n}): Promise<void> {\n  const url = `${BACKEND_BASE_URL}/feedback`;\n  await axios({\n    method: 'post',\n    url,\n    data: {\n      rating,\n      feedback,\n    },\n    headers: {\n      'Content-Type': 'application/json;charset=UTF-8',\n    },\n  });\n}\n","import React, { useEffect, useState } from 'react';\nimport useLocalStorageState from 'use-local-storage-state';\n\nimport Modal from '../Modal';\n\n// Key to mark when a user has already been shown the information modal.\n// Update this when updating the contents of the modal.\nconst MODAL_LOCAL_STORAGE_KEY =\n  '2021-10-27-spr2022-schedule-versions-account-sync';\n\n/**\n * Inner content of the information modal.\n * Change this to update the announcement that is shown when visiting the site.\n * Additionally, make sure to change `MODAL_LOCAL_STORAGE_KEY`\n * with another unique value that has never been used before.\n */\nexport function InformationModalContent(): React.ReactElement {\n  return (\n    <>\n      <img\n        style={{ width: '175px', margin: '0 auto', display: 'block' }}\n        alt=\"GT Scheduler Logo\"\n        src=\"/mascot.png\"\n      />\n      <h1 style={{ lineHeight: 1 }}>\n        Spring 2022 courses, schedule versions, and account sync\n      </h1>\n      <h4 style={{ opacity: 0.7 }}>October 27th, 2021</h4>\n      <p>\n        Hey there, yellow jackets! Today marks the release of the Spring 2022\n        course catalog. You can access it in GT Scheduler by selecting{' '}\n        <strong>&ldquo;Spring 2022&rdquo;</strong> from the term drop-down in\n        the top-left.\n      </p>\n      <p>\n        On behalf of the GT Scheduler contributors, we&apos;re also excited to\n        announce two of the most-requested features:\n      </p>\n      <ul>\n        <li style={{ marginBottom: 8 }}>\n          <strong>Schedule versions</strong> - Now, next to the term drop-down\n          in the top-left, there is also a schedule drop-down. Use it to{' '}\n          <strong>create new schedules</strong> and{' '}\n          <strong>switch between existing ones</strong>.\n          <img\n            style={{\n              width: '100%',\n              height: 'auto',\n              margin: '8px auto',\n              display: 'block',\n            }}\n            alt=\"GT Scheduler Logo\"\n            src=\"/schedule_versions.png\"\n          />\n        </li>\n        <li>\n          <strong>Account sync</strong> - In addition to creating multiple\n          schedules, you can now also{' '}\n          <strong>sync these schedules between devices.</strong> Use the\n          drop-down in the top right to sign in and upload your schedules to the\n          cloud. Currently, the app supports either email/password, Google, or\n          GitHub sign-in options:\n          <img\n            style={{\n              width: '100%',\n              height: 'auto',\n              margin: '16px auto',\n              display: 'block',\n            }}\n            alt=\"GT Scheduler Logo\"\n            src=\"/account_sync.png\"\n          />\n          Note that signing in is completely optional: the app will still work\n          without an account (your schedules will instead be stored locally on\n          your device).\n        </li>\n      </ul>\n      <p>\n        If you find any bugs in these features or in existing ones, feel free to{' '}\n        <a href=\"https://github.com/gt-scheduler/website/issues/new/choose\">\n          open an issue on the GT Scheduler GitHub\n        </a>{' '}\n        and we will try our best to fix them.\n      </p>\n      <p>\n        A big thank you to everyone that{' '}\n        <a href=\"https://github.com/gt-scheduler/website/graphs/contributors\">\n          contributed\n        </a>{' '}\n        to the project in the past year. GT Scheduler is an open source project,\n        and we hope that we&apos;ve been able to make your scheduling experience\n        better. If you enjoy our work and are interested in contributing, feel\n        free to{' '}\n        <a href=\"https://github.com/gt-scheduler/website/pulls\">\n          open a pull request\n        </a>{' '}\n        with your improvements. Thank you and enjoy!\n      </p>\n    </>\n  );\n}\n\n/**\n * Component that shows the information modal\n * upon the user's first visit to the site\n * when they haven't seen this version of the information modal before.\n */\nexport default function InformationModal(): React.ReactElement {\n  const [show, setShow] = useState(false);\n  const [hasSeen, setHasSeen] = useLocalStorageState(\n    MODAL_LOCAL_STORAGE_KEY,\n    false\n  );\n\n  useEffect(() => {\n    if (!hasSeen) {\n      setShow(true);\n      setHasSeen(true);\n    }\n  }, [hasSeen, setHasSeen]);\n\n  return (\n    <Modal\n      show={show}\n      onHide={(): void => setShow(false)}\n      buttons={[{ label: 'Got it!', onClick: (): void => setShow(false) }]}\n      width={800}\n    >\n      <InformationModalContent />\n    </Modal>\n  );\n}\n","import React, { ErrorInfo } from 'react';\n\nimport { ErrorWithFields, softError } from '../../log';\n\ntype ErrorBoundaryProps = {\n  fallback?: (error: Error, errorInfo: ErrorInfo | null) => React.ReactNode;\n  children: React.ReactNode;\n};\n\ntype ErrorBoundaryState = {\n  error: Error | null;\n  info: ErrorInfo | null;\n};\n\n/**\n * Wraps hard errors in the component tree, showing a fallback display\n * so that the error doesn't entirely crash the app.\n * Additionally reports the error to Sentry.\n */\nexport default class ErrorBoundary extends React.Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { error: null, info: null };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error, info: null };\n  }\n\n  override componentDidCatch(error: Error, info: React.ErrorInfo): void {\n    // Log & report to Sentry\n    softError(\n      new ErrorWithFields({\n        message: 'ErrorBoundary caught error from further in render tree',\n        source: error,\n        fields: {\n          reactErrorInfo: info,\n        },\n      })\n    );\n\n    this.setState({ info });\n  }\n\n  override render(): React.ReactElement | null {\n    const { children, fallback } = this.props;\n    const { error, info } = this.state;\n\n    if (error !== null) {\n      if (fallback != null) {\n        return <>{fallback(error, info)}</>;\n      }\n\n      return null;\n    }\n\n    return <>{children}</>;\n  }\n}\n","import React from 'react';\nimport safeStringify from 'fast-safe-stringify';\n\nimport { ErrorWithFields } from '../../log';\nimport { classes } from '../../utils/misc';\n\nexport type ErrorDetailsFieldProps = {\n  name: string;\n  children: React.ReactNode;\n  style?: React.CSSProperties;\n  className?: string;\n};\n\n/**\n * A single field in an error details component\n */\nexport function ErrorDetailsField({\n  name,\n  children,\n  style,\n  className,\n}: ErrorDetailsFieldProps): React.ReactElement {\n  return (\n    <div className={classes(className, 'error-details-field')} style={style}>\n      <strong>{name}</strong>: {children}\n    </div>\n  );\n}\n\nexport type ReactErrorDetailsProps = {\n  error: Error;\n  errorInfo: React.ErrorInfo | null;\n};\n\n/**\n * Shows debug information for an error using react error info.\n */\nexport function ReactErrorDetails({\n  error,\n  errorInfo,\n}: ReactErrorDetailsProps): React.ReactElement {\n  return (\n    <>\n      <BaseErrorDetails error={error} />\n      {errorInfo !== null && (\n        <ErrorDetailsField name=\"Component stacktrace\">\n          <pre>\n            <code>{errorInfo.componentStack.replace(/^[\\n\\r]+/, '')}</code>\n          </pre>\n        </ErrorDetailsField>\n      )}\n    </>\n  );\n}\n\nexport type LoadingErrorDetailsProps = {\n  error: Error;\n  overview: React.ReactNode;\n  name: string;\n};\n\n/**\n * Shows debug information for an error that occurred while loading.\n */\nexport function LoadingErrorDetails({\n  error,\n  overview,\n  name,\n}: LoadingErrorDetailsProps): React.ReactElement {\n  return (\n    <>\n      <BaseErrorDetails error={error} />\n      <ErrorDetailsField name=\"Operation name\">\n        (loading) {name}\n      </ErrorDetailsField>\n      <ErrorDetailsField name=\"Overview\">{overview}</ErrorDetailsField>\n    </>\n  );\n}\n\nexport type BaseErrorDetailsProps = {\n  error: Error;\n};\n\n/**\n * Shows debug information for an instance of `Error`.\n */\nexport function BaseErrorDetails({\n  error,\n}: BaseErrorDetailsProps): React.ReactElement {\n  return (\n    <>\n      <ErrorDetailsField name=\"Name\">{error.name}</ErrorDetailsField>\n      <ErrorDetailsField name=\"Message\">{error.message}</ErrorDetailsField>\n      <ErrorDetailsField name=\"Version\">\n        {process.env['REACT_APP_SENTRY_VERSION']}\n      </ErrorDetailsField>\n      {error instanceof ErrorWithFields && (\n        <ErrorDetailsField name=\"Fields\">\n          <pre>\n            <code>\n              {Object.entries(error.getAllFields())\n                .map(([key, value]) => `    ${key}: ${safeStringify(value)}`)\n                .join('\\n')}\n            </code>\n          </pre>\n        </ErrorDetailsField>\n      )}\n      <ErrorDetailsField name=\"Stacktrace\">\n        <pre>\n          <code>{error.stack ?? '~'}</code>\n        </pre>\n      </ErrorDetailsField>\n    </>\n  );\n}\n","import React, { useState } from 'react';\nimport { faCaretDown } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { classes } from '../../utils/misc';\n\nimport './stylesheet.scss';\n\nexport type ExpandableCardProps = {\n  label?: string;\n  children: React.ReactNode;\n  className?: string;\n  style?: React.CSSProperties;\n};\n\n/**\n * Renders a simple expandable card that has a button\n * which can be clicked to render all content.\n */\nexport default function ExpandableCard({\n  children,\n  label = 'Details',\n  className,\n  style,\n}: ExpandableCardProps): React.ReactElement {\n  const [showChildren, setShowChildren] = useState(false);\n\n  return (\n    <div className={classes('expandable-card', className)} style={style}>\n      <button\n        className=\"expandable-card-button\"\n        onClick={(): void => setShowChildren(!showChildren)}\n        type=\"button\"\n      >\n        <FontAwesomeIcon\n          fixedWidth\n          icon={faCaretDown}\n          style={{\n            transform: showChildren ? 'rotate(-90deg)' : 'none',\n            marginRight: 8,\n          }}\n        />\n        {label}\n      </button>\n      {showChildren && children}\n    </div>\n  );\n}\n","import React from 'react';\n\nimport ExpandableCard from '../ExpandableCard';\n\nimport './stylesheet.scss';\n\nexport const GITHUB_ISSUE_URL =\n  'https://github.com/gt-scheduler/website/issues/new?assignees=&labels=bug&template=bug-report----.md&title=';\n\nexport type ErrorDisplayProps = {\n  errorDetails: React.ReactNode;\n  children: React.ReactNode;\n};\n\n/**\n * Renders the content for an error display,\n * directing the user to report the error to GitHub\n * and showing a collapsible section that includes details.\n */\nexport default function ErrorDisplay({\n  errorDetails,\n  children,\n}: ErrorDisplayProps): React.ReactElement {\n  return (\n    <div className=\"error-display-outer\">\n      {children}\n      <div>\n        If the issue keeps happening, please consider filing{' '}\n        <a href={GITHUB_ISSUE_URL} target=\"_blank\" rel=\"noreferrer noopener\">\n          a new issue on the gt-scheduler GitHub\n        </a>\n        , and include the information below under &ldquo;Error Details&rdquo; in\n        addition to what you were doing when the error occurred.\n      </div>\n      <div>\n        The error has already been logged, but filing an issue lets you provide\n        more information about what happened and makes it a lot easier for us to\n        fix the bug. Thanks ❤\n      </div>\n      <ExpandableCard label=\"Error Details\">{errorDetails}</ExpandableCard>\n    </div>\n  );\n}\n","import { faExclamationTriangle } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\n\nimport './stylesheet.scss';\n\n/**\n * Renders the top of an error display,\n * with an icon and a title saying 'An error occurred'\n */\nexport default function ErrorHeader(): React.ReactElement {\n  return (\n    <div className=\"error-header\">\n      <FontAwesomeIcon icon={faExclamationTriangle} />\n      <h4>An error occurred :(</h4>\n    </div>\n  );\n}\n","import React, {\n  useState,\n  useCallback,\n  useEffect,\n  useMemo,\n  useContext,\n} from 'react';\n\nimport { NavDrawer, NavMenu } from '..';\nimport { DESKTOP_BREAKPOINT, LARGE_MOBILE_BREAKPOINT } from '../../constants';\nimport useHeaderActionBarProps from '../../hooks/useHeaderActionBarProps';\nimport { AccountContextValue } from '../../contexts/account';\nimport useScreenWidth from '../../hooks/useScreenWidth';\nimport { ErrorWithFields } from '../../log';\nimport HeaderActionBar from '../HeaderActionBar';\n\nexport const NAV_TABS = ['Scheduler', 'Map'];\n\nexport type AppNavigationContextValue = {\n  currentTabIndex: number;\n  setTabIndex: (next: number) => void;\n  isDrawerOpen: boolean;\n  openDrawer: () => void;\n  closeDrawer: () => void;\n};\n\nexport const AppNavigationContext =\n  React.createContext<AppNavigationContextValue>({\n    currentTabIndex: 0,\n    setTabIndex: (): void => {\n      throw new ErrorWithFields({\n        message: 'empty AppNavigationContext.setTabIndex value being used',\n      });\n    },\n    isDrawerOpen: false,\n    openDrawer: (): void => {\n      throw new ErrorWithFields({\n        message: 'empty AppNavigationContext.openDrawer value being used',\n      });\n    },\n    closeDrawer: (): void => {\n      throw new ErrorWithFields({\n        message: 'empty AppNavigationContext.closeDrawer value being used',\n      });\n    },\n  });\n\nexport type AppNavigationProps = {\n  children: React.ReactNode;\n};\n\n/**\n * Handles controlling the state of app navigation,\n * including the drawer and top-level tabs\n */\nexport function AppNavigation({\n  children,\n}: AppNavigationProps): React.ReactElement {\n  const mobile = !useScreenWidth(DESKTOP_BREAKPOINT);\n\n  // Allow top-level tab-based navigation\n  const [currentTabIndex, setTabIndex] = useState(0);\n\n  // Handle the status of the drawer being open on mobile\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\n  const openDrawer = useCallback(() => setIsDrawerOpen(true), []);\n  const closeDrawer = useCallback(() => setIsDrawerOpen(false), []);\n  useEffect(() => {\n    // Close the drawer if switching to desktop\n    if (isDrawerOpen && !mobile) {\n      setIsDrawerOpen(false);\n    }\n  }, [isDrawerOpen, mobile]);\n\n  // Memoize the context value\n  const contextValue = useMemo<AppNavigationContextValue>(\n    () => ({\n      currentTabIndex,\n      setTabIndex,\n      isDrawerOpen,\n      openDrawer,\n      closeDrawer,\n    }),\n    [currentTabIndex, setTabIndex, isDrawerOpen, openDrawer, closeDrawer]\n  );\n\n  return (\n    <AppNavigationContext.Provider value={contextValue}>\n      {children}\n    </AppNavigationContext.Provider>\n  );\n}\n\ntype AppMobileNavProps = {\n  captureRef: React.RefObject<HTMLDivElement>;\n};\n\n/**\n * Adds the nav drawer that is conditionally open depending on navigation state\n * when the app is running on a mobile device.\n * Use over the \"dumb\" display AppMobileNavDisplay component\n * when the app data contexts are available.\n */\nexport function AppMobileNav({\n  captureRef,\n}: AppMobileNavProps): React.ReactElement {\n  const headerActionBarProps = useHeaderActionBarProps(captureRef);\n  return <AppMobileNavDisplay {...headerActionBarProps} />;\n}\n\ntype AppMobileNavDisplayProps = {\n  onCopyCrns?: () => void;\n  enableCopyCrns?: boolean;\n  onExportCalendar?: () => void;\n  enableExportCalendar?: boolean;\n  onDownloadCalendar?: () => void;\n  enableDownloadCalendar?: boolean;\n  accountState?: AccountContextValue | { type: 'loading' };\n};\n\n/**\n * Adds the nav drawer that is conditionally open depending on navigation state\n * when the app is running on a mobile device.\n * Runs as a \"dumb\" display component,\n * not needing valid values for the app data contexts.\n */\nexport function AppMobileNavDisplay({\n  onCopyCrns = (): void => undefined,\n  enableCopyCrns = false,\n  onExportCalendar = (): void => undefined,\n  enableExportCalendar = false,\n  onDownloadCalendar = (): void => undefined,\n  enableDownloadCalendar = false,\n  accountState = { type: 'loading' },\n}: AppMobileNavDisplayProps): React.ReactElement | null {\n  const mobile = !useScreenWidth(DESKTOP_BREAKPOINT);\n  const largeMobile = useScreenWidth(LARGE_MOBILE_BREAKPOINT);\n  const { currentTabIndex, setTabIndex, isDrawerOpen, closeDrawer } =\n    useContext(AppNavigationContext);\n\n  if (!mobile) return null;\n\n  return (\n    <NavDrawer open={isDrawerOpen} onClose={closeDrawer}>\n      {/* On small mobile devices, show the header action row */}\n      {!largeMobile && (\n        <HeaderActionBar\n          accountState={accountState}\n          onCopyCrns={onCopyCrns}\n          enableCopyCrns={enableCopyCrns}\n          onExportCalendar={onExportCalendar}\n          enableExportCalendar={enableExportCalendar}\n          onDownloadCalendar={onDownloadCalendar}\n          enableDownloadCalendar={enableDownloadCalendar}\n        />\n      )}\n\n      <NavMenu\n        items={NAV_TABS}\n        currentItem={currentTabIndex}\n        onChangeItem={setTabIndex}\n      />\n    </NavDrawer>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nimport { softError, ErrorWithFields } from '../../log';\nimport { LoadingState, NonEmptyArray } from '../../types';\nimport { exponentialBackoff, isAxiosNetworkError } from '../../utils/misc';\nimport Cancellable from '../../utils/cancellable';\n\nconst CRAWLER_INDEX_URL = 'https://gt-scheduler.github.io/crawler/index.json';\n\n/**\n * Downloads the list of terms that the crawler has valid data for.\n * Repeatedly attempts to load in the case of errors,\n * and cancels itself once the parent context is unmounted.\n */\nexport default function useDownloadTerms(): LoadingState<\n  NonEmptyArray<string>\n> {\n  const [state, setState] = useState<LoadingState<NonEmptyArray<string>>>({\n    type: 'loading',\n  });\n\n  // Fetch all terms via the crawler's self-hosted index\n  useEffect(() => {\n    const loadOperation = new Cancellable();\n    async function load(): Promise<void> {\n      let attemptNumber = 1;\n      while (!loadOperation.isCancelled) {\n        try {\n          const promise = axios.get<{ terms: string[] }>(CRAWLER_INDEX_URL);\n          const result = await loadOperation.perform(promise);\n          if (result.cancelled) {\n            return;\n          }\n\n          const newTerms = result.value.data.terms.sort().reverse();\n\n          // Ensure that there is at least 1 term before continuing\n          if (newTerms.length === 0) {\n            throw new ErrorWithFields({\n              message: 'fetched list of terms is empty; cannot continue',\n            });\n          }\n\n          setState({\n            type: 'loaded',\n            result: newTerms as NonEmptyArray<string>,\n          });\n\n          return;\n        } catch (err) {\n          // Report the error to Sentry if not a network error\n          if (!isAxiosNetworkError(err)) {\n            softError(\n              new ErrorWithFields({\n                message: 'error fetching list of terms',\n                source: err,\n                fields: {\n                  url: CRAWLER_INDEX_URL,\n                },\n              })\n            );\n          }\n\n          // Flag that an error has occurred\n          setState({\n            type: 'error',\n            error:\n              err instanceof Error\n                ? err\n                : new ErrorWithFields({\n                    message: 'an error occurred while fetching terms',\n                    source: err,\n                  }),\n            stillLoading: true,\n            overview: String(err),\n          });\n        }\n\n        // Sleep for an exponential backoff between each retry\n        await exponentialBackoff(attemptNumber);\n        attemptNumber += 1;\n      }\n    }\n\n    load().catch(() => {\n      // Unreachable\n    });\n\n    // Cancel the background load when this cleans up\n    return (): void => {\n      loadOperation.cancel();\n    };\n  }, [setState]);\n\n  return state;\n}\n","import React from 'react';\n\nimport {\n  LoadingStateLoading,\n  LoadingStateError,\n  LoadingStateCustom,\n} from '../../types';\nimport { LoadingErrorDetails } from '../ErrorDetails';\nimport ErrorDisplay from '../ErrorDisplay';\nimport ErrorHeader from '../ErrorHeader';\nimport Spinner from '../Spinner';\n\nimport './stylesheet.scss';\n\nexport type LoadingDisplayProps = {\n  state: LoadingStateLoading | LoadingStateError | LoadingStateCustom;\n  name: string;\n};\n\n/**\n * Renders a `LoadingState<T>` value,\n * showing a spinner if the state is loading,\n * and an error otherwise if an error ocurred.\n */\nexport default function LoadingDisplay({\n  state,\n  name,\n}: LoadingDisplayProps): React.ReactElement {\n  let contents: React.ReactNode;\n  if (state.type === 'loading') {\n    contents = (\n      <>\n        <Spinner size=\"normal\" style={{ opacity: 0.6 }} />\n        <h4>Loading</h4>\n        <div>{name}</div>\n      </>\n    );\n  } else if (state.type === 'custom') {\n    // Don't wrap custom contents in the outer div\n    return <>{state.contents}</>;\n  } else if (state.stillLoading) {\n    contents = (\n      <>\n        <Spinner size=\"normal\" style={{ opacity: 0.6 }} />\n        <h4>Loading</h4>\n        <ErrorDisplay\n          errorDetails={\n            <LoadingErrorDetails\n              error={state.error}\n              overview={state.overview}\n              name={name}\n            />\n          }\n        >\n          <div>\n            An error ocurred while loading {name}: {state.overview}\n          </div>\n          <div>\n            The application is retrying in the background, so the issue may\n            resolve itself. If it doesn&apos;t, try refreshing the page.\n          </div>\n        </ErrorDisplay>\n      </>\n    );\n  } else {\n    contents = (\n      <>\n        <ErrorHeader />\n        <ErrorDisplay\n          errorDetails={\n            <LoadingErrorDetails\n              error={state.error}\n              overview={state.overview}\n              name={name}\n            />\n          }\n        >\n          <div>\n            An unrecoverable error ocurred while loading {name}:{' '}\n            {state.overview}\n          </div>\n          <div>Try refreshing the page to see if it fixes the issue.</div>\n        </ErrorDisplay>\n      </>\n    );\n  }\n\n  return <div className=\"loading-display\">{contents}</div>;\n}\n","import React, { useContext, useRef } from 'react';\n\nimport { Header, Scheduler, Attribution, Calendar } from '..';\nimport { ReactErrorDetails } from '../ErrorDetails';\nimport ErrorDisplay from '../ErrorDisplay';\nimport ErrorHeader from '../ErrorHeader';\nimport ErrorBoundary from '../ErrorBoundary';\nimport HeaderDisplay from '../HeaderDisplay';\nimport Map from '../Map';\nimport {\n  AppNavigationContext,\n  AppMobileNav,\n  NAV_TABS,\n  AppMobileNavDisplay,\n} from './navigation';\nimport { classes } from '../../utils/misc';\nimport { AccountContextValue } from '../../contexts/account';\n\n/**\n * Renders the actual content at the root of the app\n * once it has completely loaded state,\n * including headers & footers.\n * This component is memoized, so it only re-renders when its context changes.\n */\nfunction AppContentBase(): React.ReactElement {\n  const { currentTabIndex, setTabIndex, openDrawer } =\n    useContext(AppNavigationContext);\n  const captureRef = useRef<HTMLDivElement>(null);\n\n  return (\n    <>\n      <AppMobileNav captureRef={captureRef} />\n      <Header\n        currentTab={currentTabIndex}\n        onChangeTab={setTabIndex}\n        onToggleMenu={openDrawer}\n        tabs={NAV_TABS}\n        captureRef={captureRef}\n      />\n      <ErrorBoundary\n        fallback={(error, errorInfo): React.ReactElement => (\n          <SkeletonContent>\n            <ErrorHeader />\n            <ErrorDisplay\n              errorDetails={\n                <ReactErrorDetails error={error} errorInfo={errorInfo} />\n              }\n            >\n              <div>\n                There was en error somewhere somewhere in the{' '}\n                {NAV_TABS[currentTabIndex] ?? '?'} tab and it can&apos;t\n                continue.\n              </div>\n              <div>Try refreshing the page to see if it fixes the issue.</div>\n            </ErrorDisplay>\n          </SkeletonContent>\n        )}\n      >\n        {currentTabIndex === 0 && <Scheduler />}\n        {currentTabIndex === 1 && <Map />}\n\n        {/* Fake calendar used to capture screenshots */}\n        <div className=\"capture-container\" ref={captureRef}>\n          <Calendar className=\"fake-calendar\" capture overlayCrns={[]} />\n        </div>\n      </ErrorBoundary>\n      <Attribution />\n    </>\n  );\n}\n\n/**\n * Renders the actual content at the root of the app\n * once it has completely loaded state,\n * including headers & footers.\n * This component is memoized, so it only re-renders when its context changes.\n */\nexport const AppContent = React.memo(AppContentBase);\n\nexport type AppSkeletonProps = {\n  children: React.ReactNode;\n  accountState?: AccountContextValue;\n  termsState?: {\n    terms: string[];\n    currentTerm: string;\n    onChangeTerm: (next: string) => void;\n  };\n};\n\n/**\n * Renders a non-functional \"skeleton\" of the app\n * that shows as much content as possible without needing valid context values.\n * The optional props can be used\n * to selectively \"enable\" various parts of the app while it loads.\n */\nexport function AppSkeleton({\n  children,\n  accountState,\n  termsState,\n}: AppSkeletonProps): React.ReactElement {\n  const { currentTabIndex, setTabIndex, openDrawer } =\n    useContext(AppNavigationContext);\n\n  return (\n    <>\n      <AppMobileNavDisplay />\n      <HeaderDisplay\n        currentTab={currentTabIndex}\n        onChangeTab={setTabIndex}\n        onToggleMenu={openDrawer}\n        tabs={NAV_TABS}\n        accountState={accountState ?? { type: 'loading' }}\n        termsState={\n          termsState == null\n            ? { type: 'loading' }\n            : { type: 'loaded', ...termsState }\n        }\n        versionsState={{ type: 'loading' }}\n      />\n      {children}\n      <Attribution />\n    </>\n  );\n}\n\nexport type SkeletonContentProps = {\n  children: React.ReactNode;\n};\n\n/**\n * Parent component for any content rendered inside an app skeleton,\n * centering it horizontally and vertically\n * and allowing vertical overflow to be scrolled.\n */\nexport function SkeletonContent({\n  children,\n}: SkeletonContentProps): React.ReactElement {\n  return (\n    <div className={classes('main', 'skeleton')}>\n      <div className=\"skeleton-content\">\n        <div className=\"skeleton-content-inner\">{children}</div>\n      </div>\n    </div>\n  );\n}\n","import { faExclamationCircle } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\n\nimport './stylesheet.scss';\n\n/**\n * Renders the top of a warning,\n * with an icon and a title saying 'Warning'\n */\nexport default function WarningHeader(): React.ReactElement {\n  return (\n    <div className=\"warning-header\">\n      <FontAwesomeIcon icon={faExclamationCircle} />\n      <h4>Warning</h4>\n    </div>\n  );\n}\n","import React from 'react';\n\nimport WarningHeader from '../WarningHeader';\n\nimport './stylesheet.scss';\n\n/**\n * Renders a notification that schedule data is not persistent\n * and that the user can't use the application.\n */\nexport function renderDataNotPersistentNotification(\n  props: DataNotPersistentNotificationProps\n): React.ReactElement {\n  return <DataNotPersistentNotification {...props} />;\n}\n\nexport type DataNotPersistentNotificationProps = {\n  onAccept: () => void;\n};\n\n/**\n * Content that is shown in the modal when `showDataNotPersistentNotification`\n * is called\n */\nexport function DataNotPersistentNotification({\n  onAccept,\n}: DataNotPersistentNotificationProps): React.ReactElement {\n  return (\n    <div className=\"data-not-persistent-notification\">\n      <WarningHeader />\n      <p>\n        Your browser doesn&apos;t support storing data using local storage,\n        which gt-scheduler relies on to persist schedule data between sessions.\n      </p>\n      <p>Reasons this might be the case:</p>\n      <ul>\n        <li>\n          You&apos;re using an outdated browser that doesn&apos;t support local\n          storage\n        </li>\n        <li>You&apos;re using Mobile Safari with private mode enabled</li>\n        <li>You&apos;re using Safari with cookies disabled</li>\n      </ul>\n      <p>\n        <strong>\n          Would you like to continue using gt-scheduler? Your schedules will not\n          be saved once you close this tab.\n        </strong>\n      </p>\n      <button\n        className=\"data-not-persistent-notification--button\"\n        onClick={onAccept}\n        type=\"button\"\n      >\n        Accept\n      </button>\n    </div>\n  );\n}\n","import { Immutable } from 'immer';\nimport { useState } from 'react';\nimport useLocalStorageState from 'use-local-storage-state';\n\nimport { renderDataNotPersistentNotification } from '../../components/DataNotPersistentNotification';\nimport { LoadingState } from '../../types';\nimport { AnyScheduleData } from '../types';\n\nexport const SCHEDULE_DATA_LOCAL_STORAGE_KEY = 'schedule-data';\n\ntype HookResult = {\n  rawScheduleData: Immutable<AnyScheduleData> | null;\n  setRawScheduleData: (\n    next:\n      | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n      | AnyScheduleData\n  ) => void;\n};\n\n/**\n * Gets the current schedule data from local storage.\n * Do not call this function in a non-root component;\n * it should only be called once in a root component (i.e. <App>).\n */\n// eslint-disable-next-line max-len\nexport default function useRawScheduleDataFromStorage(): LoadingState<HookResult> {\n  const [rawScheduleData, setRawScheduleData, { isPersistent }] =\n    useLocalStorageState<AnyScheduleData | null>(\n      SCHEDULE_DATA_LOCAL_STORAGE_KEY,\n      null\n    );\n\n  const [userAcceptedNonPersistence, setUserAcceptedNonPersistence] =\n    useState(false);\n\n  // If the state isn't persistent, then return an error to alert the user\n  // requiring them to acknowledge this before continuing\n  if (!isPersistent && !userAcceptedNonPersistence) {\n    return {\n      type: 'custom',\n      contents: renderDataNotPersistentNotification({\n        onAccept: (): void => {\n          setUserAcceptedNonPersistence(true);\n        },\n      }),\n    };\n  }\n\n  return {\n    type: 'loaded',\n    result: {\n      rawScheduleData,\n      setRawScheduleData,\n    },\n  };\n}\n\n/**\n * Imperative version of `useRawScheduleDataFromStorage`;\n * just gets the current value from local storage.\n */\nexport function getCurrentRawScheduleFromStorage(): AnyScheduleData | null {\n  const rawData = window.localStorage.getItem(SCHEDULE_DATA_LOCAL_STORAGE_KEY);\n  if (rawData === null) return null;\n  return JSON.parse(rawData) as AnyScheduleData;\n}\n","import { useEffect } from 'react';\n\nimport { NonEmptyArray, LoadingState } from '../../types';\n\ntype HookResult = {\n  currentTerm: string;\n};\n\n/**\n * Ensures that there is a valid current term selected.\n * If the current term isn't valid (i.e. empty or not in the `terms` array),\n * then it is set to the most recent term (which is the first item in `terms`).\n */\nexport default function useEnsureValidTerm({\n  terms,\n  setTerm,\n  currentTermRaw,\n}: {\n  terms: NonEmptyArray<string>;\n  setTerm: (next: string) => void;\n  currentTermRaw: string;\n}): LoadingState<HookResult> {\n  // Set the term to be the first one if it is unset or no longer valid.\n  useEffect(() => {\n    const mostRecentTerm = terms[0];\n    const correctedTerm = !isValidTerm(currentTermRaw, terms)\n      ? mostRecentTerm\n      : currentTermRaw;\n\n    if (correctedTerm !== currentTermRaw) {\n      setTerm(correctedTerm);\n    }\n  }, [currentTermRaw, terms, setTerm]);\n\n  if (!isValidTerm(currentTermRaw, terms)) {\n    return { type: 'loading' };\n  }\n\n  return {\n    type: 'loaded',\n    result: {\n      currentTerm: currentTermRaw,\n    },\n  };\n}\n\n/**\n * Determines if the given term is considered \"valid\";\n * helps to recover from invalid cookie values if possible.\n */\nexport function isValidTerm(term: string, terms: string[]): boolean {\n  return term !== '' && term !== 'undefined' && terms.includes(term);\n}\n","import {\n  generateScheduleVersionId,\n  Version1ScheduleData,\n  Version2ScheduleData,\n  Version2ScheduleVersion,\n  Version2TermScheduleData,\n} from '../types';\n\n/**\n * Migrates from version 1 to version 2 data,\n * performing the main 3 operations:\n * - generating random IDs for each schedule version\n * - generating 'createdAt' fields for each schedule version\n * - dropping all `currentVersion` and `currentTerm` fields\n */\nexport default function migrate1To2(\n  version1: Version1ScheduleData\n): Version2ScheduleData {\n  // Fix every term data\n  const newData: Version2ScheduleData = {\n    version: 2,\n    terms: {},\n  };\n\n  Object.entries(version1.terms).forEach(([term, version1TermData]) => {\n    // Create values for the 'createdAt' fields on each version\n    // based on the time that versions were migrated,\n    // plus an offset depending on their index in the versions array.\n    // This lets the versions be sorted in the same order as before\n    // when using 'createdAt' as the sort key.\n    const baseCreatedAtTime = new Date();\n    const versionIdxMsOffset = 1_000;\n    const makeCreatedAt = (idx: number): Date =>\n      new Date(baseCreatedAtTime.getTime() + versionIdxMsOffset * idx);\n\n    const version2TermData: Version2TermScheduleData = {\n      versions: {},\n    };\n\n    // Create updated schedule versions\n    const newEntries = version1TermData.versions.map<\n      [string, Version2ScheduleVersion]\n    >((version1ScheduleVersion, idx) => {\n      const id = generateScheduleVersionId();\n      const createdAt = makeCreatedAt(idx);\n      const version2ScheduleVersion: Version2ScheduleVersion = {\n        name: version1ScheduleVersion.name,\n        createdAt: createdAt.toISOString(),\n        schedule: version1ScheduleVersion.schedule,\n      };\n\n      return [id, version2ScheduleVersion];\n    });\n\n    version2TermData.versions = Object.fromEntries(newEntries);\n    newData.terms[term] = version2TermData;\n  });\n\n  return newData;\n}\n","export type TermData = {\n  desiredCourses: string[];\n  pinnedCrns: string[];\n  excludedCrns: string[];\n  colorMap: Record<string, string>;\n  sortingOptionIndex: number;\n};\n\nexport const defaultTermData: TermData = {\n  desiredCourses: [],\n  pinnedCrns: [],\n  excludedCrns: [],\n  colorMap: {},\n  sortingOptionIndex: 0,\n};\n","import { ErrorWithFields } from '../../log';\nimport { NonEmptyArray } from '../../types';\nimport { TermData, defaultTermData } from './types';\n\nexport type TermDataParseResult =\n  | { type: 'error'; error: Error }\n  | { type: 'parsed'; parsed: unknown };\n\n/**\n * Parses raw term data from its string representation to the parsed JSON\n */\nexport function parseTermData(rawTermData: string): TermDataParseResult {\n  if (rawTermData === '' || rawTermData === 'undefined') {\n    return {\n      type: 'error',\n      error: new ErrorWithFields({\n        message: 'raw term data was empty or \"undefined\"',\n        fields: {\n          rawTermData,\n        },\n      }),\n    };\n  }\n\n  try {\n    return { type: 'parsed', parsed: JSON.parse(rawTermData) };\n  } catch (err) {\n    return {\n      type: 'error',\n      error: new ErrorWithFields({\n        message: 'raw term data was not valid JSON data',\n        source: err,\n        fields: {\n          rawTermData,\n        },\n      }),\n    };\n  }\n}\n\nexport type TermDataValidationResult =\n  | { type: 'error'; errors: NonEmptyArray<Error>; fallback: TermData }\n  | { type: 'valid'; termData: TermData };\n\nconst isStringArray = (field: unknown): field is string[] =>\n  field != null &&\n  Array.isArray(field) &&\n  field.every((elem) => typeof elem === 'string');\n\nconst isStringStringMap = (field: unknown): field is Record<string, string> =>\n  typeof field === 'object' &&\n  field != null &&\n  Object.keys(field).every((elem) => typeof elem === 'string') &&\n  Object.values(field).every((elem) => typeof elem === 'string');\n\n/**\n * Validates parsed term data, ensuring that it is of the expected shape\n */\nexport function validateTermData(\n  termData: unknown,\n  rawTermData?: string\n): TermDataValidationResult {\n  try {\n    if (\n      termData == null ||\n      typeof termData !== 'object' ||\n      Array.isArray(termData)\n    ) {\n      return {\n        type: 'error',\n        fallback: defaultTermData,\n        errors: [\n          new ErrorWithFields({\n            message: 'term data is the wrong type',\n            fields: {\n              rawTermData,\n              termDataType: typeof termData,\n              termData,\n            },\n          }),\n        ],\n      };\n    }\n\n    const validTermData = { ...defaultTermData };\n\n    // Ensure each field is valid, copying them as we go\n    const termDataAsRecord = termData as Record<string, unknown>;\n    const fieldValidationErrors: Error[] = [];\n    const {\n      desiredCourses,\n      pinnedCrns,\n      excludedCrns,\n      colorMap,\n      sortingOptionIndex,\n    } = termDataAsRecord;\n\n    if (isStringArray(desiredCourses)) {\n      validTermData.desiredCourses = desiredCourses;\n    } else {\n      fieldValidationErrors.push(\n        new ErrorWithFields({\n          message: 'termData.desiredCourses was not a string array',\n          fields: {\n            rawTermData,\n            termData,\n            desiredCourses,\n            fallback: validTermData.desiredCourses,\n          },\n        })\n      );\n    }\n\n    if (isStringArray(pinnedCrns)) {\n      validTermData.pinnedCrns = pinnedCrns;\n    } else {\n      fieldValidationErrors.push(\n        new ErrorWithFields({\n          message: 'termData.pinnedCrns was not a string array',\n          fields: {\n            rawTermData,\n            termData,\n            pinnedCrns,\n            fallback: validTermData.pinnedCrns,\n          },\n        })\n      );\n    }\n\n    if (isStringArray(excludedCrns)) {\n      validTermData.excludedCrns = excludedCrns;\n    } else {\n      fieldValidationErrors.push(\n        new ErrorWithFields({\n          message: 'termData.excludedCrns was not a string array',\n          fields: {\n            rawTermData,\n            termData,\n            excludedCrns,\n            fallback: validTermData.excludedCrns,\n          },\n        })\n      );\n    }\n\n    if (isStringStringMap(colorMap)) {\n      validTermData.colorMap = colorMap;\n    } else {\n      fieldValidationErrors.push(\n        new ErrorWithFields({\n          message: 'termData.colorMap was not a string/string map',\n          fields: {\n            rawTermData,\n            termData,\n            colorMap,\n            fallback: validTermData.colorMap,\n          },\n        })\n      );\n    }\n\n    if (typeof sortingOptionIndex === 'number') {\n      validTermData.sortingOptionIndex = sortingOptionIndex;\n    } else {\n      fieldValidationErrors.push(\n        new ErrorWithFields({\n          message: 'termData.sortingOptionIndex was not a number',\n          fields: {\n            rawTermData,\n            termData,\n            sortingOptionIndex,\n            fallback: validTermData.sortingOptionIndex,\n          },\n        })\n      );\n    }\n\n    if (fieldValidationErrors.length > 0) {\n      return {\n        type: 'error',\n        fallback: validTermData,\n        errors: fieldValidationErrors as NonEmptyArray<Error>,\n      };\n    }\n\n    return { type: 'valid', termData: validTermData };\n  } catch (err) {\n    if (err instanceof Error) {\n      return {\n        type: 'error',\n        fallback: defaultTermData,\n        errors: [\n          new ErrorWithFields({\n            message: 'an unexpected error occurred when parsing term data',\n            source: err,\n            fields: {\n              rawTermData,\n            },\n          }),\n        ],\n      };\n    }\n\n    return {\n      type: 'error',\n      fallback: defaultTermData,\n      errors: [\n        new ErrorWithFields({\n          message: 'an unexpected error occurred when parsing term data',\n          fields: {\n            rawTermData,\n            originalError: err,\n          },\n        }),\n      ],\n    };\n  }\n}\n","import { parseTermData, validateTermData } from '../legacy/validation';\nimport { softError, ErrorWithFields } from '../../log';\nimport { isTerm } from '../../utils/semesters';\nimport { Version1ScheduleData, Version1TermScheduleData } from '../types';\n\nexport const defaultVersion1ScheduleData: Version1ScheduleData = {\n  terms: {},\n  currentTerm: '',\n  version: 1,\n};\n\n/**\n * Attempts to \"migrate\" the existing data from the legacy cookie format\n * to version 1 of the schedule data. The output of this function should be\n * safe to migrate to further versions, if applicable. If allCookies\n * is an empty record, then this function returns the default v1 schedule data.\n * @param allCookies - the result of `Cookies.get()` with no arguments --\n * a record of all cookie keys -> values\n */\nexport default function migrateCookiesTo1(\n  allCookies: Record<string, string>\n): Version1ScheduleData {\n  const currentTerm = allCookies['term'] ?? '';\n\n  // Create a number to correlate error events\n  const userNumber = Math.floor(Math.random() * 100000);\n\n  // Collect the values of all cookies that look like term schedule data:\n  const terms: Record<string, Version1TermScheduleData> = {};\n  Object.entries(allCookies).forEach(([cookieKey, cookieValue]): void => {\n    if (isTerm(cookieKey)) {\n      // Try to parse and validate the term information\n      const parseResult = parseTermData(cookieValue);\n      if (parseResult.type === 'error') {\n        softError(\n          new ErrorWithFields({\n            message: 'parsing error for guessed term data when migrating',\n            source: parseResult.error,\n            fields: {\n              cookieKey,\n              cookieValue,\n              userNumber,\n            },\n          })\n        );\n        return;\n      }\n\n      const validateResult = validateTermData(parseResult.parsed, cookieValue);\n      if (validateResult.type === 'error') {\n        validateResult.errors.forEach((err) => {\n          softError(\n            new ErrorWithFields({\n              message: 'validation error for guessed term data when migrating',\n              source: err,\n              fields: {\n                cookieKey,\n                cookieValue,\n                userNumber,\n              },\n            })\n          );\n        });\n\n        terms[cookieKey] = {\n          versions: [{ name: 'Primary', schedule: validateResult.fallback }],\n          currentIndex: 0,\n        };\n      } else {\n        terms[cookieKey] = {\n          versions: [{ name: 'Primary', schedule: validateResult.termData }],\n          currentIndex: 0,\n        };\n      }\n    }\n  });\n\n  return {\n    terms,\n    currentTerm,\n    version: 1,\n  };\n}\n","import Cookies from 'js-cookie';\n\nimport { softError, ErrorWithFields } from '../../log';\nimport {\n  AnyScheduleData,\n  ScheduleData,\n  Version1ScheduleDataOrNewer,\n  Version2ScheduleDataOrNewer,\n} from '../types';\nimport migrate1To2 from './1to2';\nimport migrateCookiesTo1, { defaultVersion1ScheduleData } from './cookiesTo1';\n\n/**\n * Attempts to migrate the given \"raw\" schedule data\n * (which can be of any version) to the latest version,\n * automatically applying pre-defined migrations between versions.\n * If this function fails, it will throw an error; otherwise,\n * it returns an instance of the schedule data for the latest version\n */\nexport default function migrateScheduleData(\n  rawScheduleData: AnyScheduleData | null\n): ScheduleData {\n  // Having the `scheduleData` be `null`counts as a \"special\" migration\n  // from the legacy storage method (if it exists).\n  let scheduleDataVersion1OrNewer: Version1ScheduleDataOrNewer;\n  if (rawScheduleData === null) {\n    try {\n      const allCookies = Cookies.get();\n      scheduleDataVersion1OrNewer = migrateCookiesTo1(allCookies);\n    } catch (err) {\n      // An error occurred: fall back to the default data & report it\n      softError(\n        new ErrorWithFields({\n          source: err,\n          message: 'an error occurred when sourcing schedule data from cookies',\n        })\n      );\n      scheduleDataVersion1OrNewer = defaultVersion1ScheduleData;\n    }\n  } else {\n    scheduleDataVersion1OrNewer = rawScheduleData;\n  }\n\n  let scheduleDataVersion2OrNewer: Version2ScheduleDataOrNewer;\n  if (scheduleDataVersion1OrNewer.version === 1) {\n    scheduleDataVersion2OrNewer = migrate1To2(scheduleDataVersion1OrNewer);\n  } else {\n    scheduleDataVersion2OrNewer = scheduleDataVersion1OrNewer;\n  }\n\n  return scheduleDataVersion2OrNewer;\n}\n","import { useCallback } from 'react';\n\nimport useLocalStorageNoSync from '../../hooks/useLocalStorageNoSync';\n\nexport const UI_STATE_LOCAL_STORAGE_KEY = 'ui-state';\n\nexport interface UIState {\n  currentTerm: string;\n  versionStates: Record<string, VersionUIState>;\n}\n\nexport const defaultUIState: UIState = {\n  currentTerm: '',\n  versionStates: {},\n};\n\nexport interface VersionUIState {\n  currentVersion: string;\n}\n\ntype HookResult = {\n  currentTerm: string;\n  setTerm: (next: string) => void;\n  currentVersion: string;\n  setVersion: (next: string) => void;\n};\n\n/**\n * Gets the current UI state from local storage.\n * Do not call this function in a non-root component;\n * it should only be called once in a root component (i.e. <App>).\n * Moreover, unlike the local storage version of the app data,\n * this **does not** sync between tabs.\n * This is deliberate, as it allows opening up multiple tabs\n * with different schedules if desired,\n * but still have the app resume to the last viewed schedule when opened again.\n */\nexport default function useUIStateFromStorage(): HookResult {\n  const [{ currentTerm, versionStates }, setUIState] = useLocalStorageNoSync(\n    UI_STATE_LOCAL_STORAGE_KEY,\n    defaultUIState\n  );\n\n  const setTerm = useCallback(\n    (next: string) => {\n      setUIState((current) => {\n        return {\n          ...current,\n          currentTerm: next,\n        };\n      });\n    },\n    [setUIState]\n  );\n\n  const currentVersion = versionStates[currentTerm]?.currentVersion ?? '';\n  const setVersion = useCallback(\n    (next: string) => {\n      setUIState((current) => {\n        return {\n          ...current,\n          versionStates: {\n            ...current.versionStates,\n            [current.currentTerm]: {\n              currentVersion: next,\n            },\n          },\n        };\n      });\n    },\n    [setUIState]\n  );\n\n  return {\n    currentTerm,\n    setTerm,\n    currentVersion,\n    setVersion,\n  };\n}\n","import { useState } from 'react';\n\nimport { ErrorWithFields, softError } from '../log';\n\nexport type HookResult<T> = [T, (value: T | ((curr: T) => T)) => void];\n\n/**\n * From https://usehooks.com/useLocalStorage/.\n * Similar to `use-local-storage-state` (which should be preferred),\n * except it does not sync the state between browser tabs.\n */\nexport default function useLocalStorageNoSync<T>(\n  key: string,\n  initialValue: T\n): HookResult<T> {\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    let item: string | null = null;\n    try {\n      item = window.localStorage.getItem(key);\n      return item ? (JSON.parse(item) as T) : initialValue;\n    } catch (error) {\n      softError(\n        new ErrorWithFields({\n          message: 'useLocalStorageNoSync load local storage failed',\n          source: error,\n          fields: {\n            key,\n          },\n        })\n      );\n      return initialValue;\n    }\n  });\n\n  const setValue = (value: T | ((val: T) => T)): void => {\n    try {\n      const valueToStore =\n        value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      softError(\n        new ErrorWithFields({\n          message: 'useLocalStorageNoSync setValue call failed',\n          source: error,\n          fields: {\n            key,\n          },\n        })\n      );\n    }\n  };\n\n  return [storedValue, setValue];\n}\n","import { Immutable, castImmutable, castDraft } from 'immer';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { SignedIn } from '../../contexts/account';\nimport { ErrorWithFields, softError } from '../../log';\nimport {\n  LoadingState,\n  LoadingStateCustom,\n  LoadingStateError,\n} from '../../types';\nimport { db, isAuthEnabled, schedulesCollection } from '../firebase';\nimport migrateScheduleData from '../migrations';\nimport { AnyScheduleData, defaultScheduleData, ScheduleData } from '../types';\nimport { getCurrentRawScheduleFromStorage } from './useRawScheduleDataFromStorage';\n\ntype HookResult = {\n  rawScheduleData: Immutable<AnyScheduleData> | null;\n  setRawScheduleData: (\n    next:\n      | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n      | AnyScheduleData\n  ) => void;\n};\n\ntype ScheduleDataState = Loading | NonExistant | Exists;\ntype Loading = {\n  type: 'loading';\n};\ntype NonExistant = {\n  type: 'nonExistant';\n};\ntype Exists = {\n  type: 'exists';\n  data: AnyScheduleData;\n};\n\n/**\n * Gets the current schedule data from Firebase.\n * Do not call this function in a non-root component;\n * it should only be called once in a root component (i.e. <App>).\n */\nexport default function useRawScheduleDataFromFirebase(\n  account: SignedIn\n): LoadingState<HookResult> {\n  const [scheduleData, setScheduleData] = useState<ScheduleDataState>({\n    type: 'loading',\n  });\n  const [permanentError, setPermanentError] = useState<\n    LoadingStateError | LoadingStateCustom | null\n  >(null);\n  useEffect(() => {\n    if (!isAuthEnabled) return undefined;\n\n    const removeSnapshotListener = schedulesCollection\n      .doc(account.id)\n      .onSnapshot(\n        {\n          // Ignore metadata changes\n          includeMetadataChanges: false,\n        },\n        (doc) => {\n          const data = doc.data();\n          if (data == null) {\n            setScheduleData({ type: 'nonExistant' });\n          } else {\n            setScheduleData({\n              type: 'exists',\n              data: doc.data() as AnyScheduleData,\n            });\n          }\n        }\n      );\n    return (): void => removeSnapshotListener();\n  }, [account.id]);\n\n  const setScheduleDataPersistent = useCallback(\n    (\n      next:\n        | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n        | AnyScheduleData\n    ): void => {\n      let nextScheduleData;\n      if (typeof next === 'function') {\n        let currentScheduleData;\n        if (scheduleData.type === 'exists') {\n          currentScheduleData = scheduleData.data;\n        } else {\n          currentScheduleData = null;\n        }\n        nextScheduleData = next(currentScheduleData);\n      } else {\n        nextScheduleData = next;\n      }\n      if (nextScheduleData === null) return;\n\n      // Eagerly set the schedule data here as well.\n      // It would be okay to wait until Firebase updates the state for us,\n      // (which it will do, even before the network calls are made),\n      // but this allows a window where state can react based on stale state.\n      setScheduleData({ type: 'exists', data: nextScheduleData });\n\n      schedulesCollection\n        .doc(account.id)\n        .set(nextScheduleData)\n        .catch((err) => {\n          softError(\n            new ErrorWithFields({\n              message: 'error when updating remote document',\n              source: err,\n              fields: {\n                accountId: account.id,\n              },\n            })\n          );\n        });\n    },\n    [account.id, scheduleData]\n  );\n\n  // Perform a transaction if the type is non-existent,\n  // trying to pull existing data from local storage\n  // (migrating it as needed),\n  // and storing it in Firebase.\n  // This serves to provide the initial account data.\n  useEffect(() => {\n    if (!isAuthEnabled) return;\n\n    if (scheduleData.type === 'nonExistant') {\n      // Imperatively get the latest migrated data\n      let currentScheduleData: Immutable<ScheduleData>;\n      try {\n        currentScheduleData = getCurrentScheduleData() ?? defaultScheduleData;\n      } catch (err) {\n        softError(\n          new ErrorWithFields({\n            message:\n              'failed to imperatively get current schedule data during account seeding',\n            source: err,\n            fields: {\n              accountId: account.id,\n            },\n          })\n        );\n        currentScheduleData = defaultScheduleData;\n      }\n\n      // Start the transaction\n      db.runTransaction(async (transaction) => {\n        const currentDoc = await transaction.get(\n          schedulesCollection.doc(account.id)\n        );\n        if (currentDoc.exists) return;\n        transaction.set(\n          schedulesCollection.doc(account.id),\n          castDraft(currentScheduleData)\n        );\n      }).catch((err) => {\n        // Send the error to Sentry\n        const error = new ErrorWithFields({\n          message: 'an error occurred while initializing account schedule data',\n          source: err,\n          fields: {\n            account: account.id,\n          },\n        });\n        softError(error);\n\n        // Report the error to the user\n        setPermanentError({\n          type: 'error',\n          error,\n          stillLoading: false,\n          overview: String(err),\n        });\n      });\n    }\n  }, [account.id, scheduleData.type]);\n\n  // If this hook is running and auth is not enabled,\n  // then something is wrong with the state.\n  // Show an error.\n  if (!isAuthEnabled) {\n    return {\n      type: 'error',\n      error: new ErrorWithFields({\n        message: 'cannot obtain data from firebase: authentication is disabled',\n      }),\n      stillLoading: false,\n      overview: 'authentication is not enabled',\n    };\n  }\n\n  if (permanentError !== null) {\n    return permanentError;\n  }\n\n  if (scheduleData.type === 'loading' || scheduleData.type === 'nonExistant') {\n    return { type: 'loading' };\n  }\n\n  return {\n    type: 'loaded',\n    result: {\n      rawScheduleData: castImmutable(scheduleData.data),\n      setRawScheduleData: setScheduleDataPersistent,\n    },\n  };\n}\n\nfunction getCurrentScheduleData(): ScheduleData | null {\n  const currentRawSchedule = getCurrentRawScheduleFromStorage();\n  if (currentRawSchedule === null) return null;\n  return migrateScheduleData(currentRawSchedule);\n}\n","import React from 'react';\nimport { Immutable, Draft, castDraft } from 'immer';\n\nimport { Oscar } from '../../data/beans';\nimport useDownloadOscarData from '../../data/hooks/useDownloadOscarData';\nimport useDownloadTerms from '../../data/hooks/useDownloadTerms';\nimport { NonEmptyArray } from '../../types';\nimport LoadingDisplay from '../LoadingDisplay';\nimport { SkeletonContent, AppSkeleton, AppSkeletonProps } from '../App/content';\nimport {\n  AnyScheduleData,\n  ScheduleData,\n  ScheduleVersion,\n  TermScheduleData,\n} from '../../data/types';\nimport useRawScheduleDataFromStorage from '../../data/hooks/useRawScheduleDataFromStorage';\nimport useExtractSchedule from '../../data/hooks/useExtractScheduleVersion';\nimport useExtractTermScheduleData from '../../data/hooks/useExtractTermScheduleData';\nimport useEnsureValidTerm from '../../data/hooks/useEnsureValidTerm';\nimport useScheduleDataProducer from '../../data/hooks/useScheduleDataProducer';\nimport useMigrateScheduleData from '../../data/hooks/useMigrateScheduleData';\nimport useUIStateFromStorage from '../../data/hooks/useUIStateFromStorage';\nimport { AccountContextValue, SignedIn } from '../../contexts/account';\nimport useFirebaseAuth from '../../data/hooks/useFirebaseAuth';\nimport useRawScheduleDataFromFirebase from '../../data/hooks/useRawScheduleDataFromFirebase';\n\n// Each of the components in this file is a \"stage\" --\n// a component that takes in a render function for its `children` prop\n// that it uses to pass in the results of the stage on to the next one.\n// If a stage is loading or has an error,\n// then it renders its own loading/error view\n// and does not call its `children` prop,\n// effectively \"stopping\" the loading chain at that stage.\n//\n// The problem that this design solves is needing to perform\n// a series of operations, whether data fetching or maintaining invariants\n// (like having a valid current term/version),\n// where an operation depends on the results of previous action(s).\n// For example, ensuring that the current term is valid\n// depends on fetching the list of terms from the crawler's index,\n// so having them be two separate stages naturally encodes this dependency.\n// It also lets us stop rendering the app when data is still loading,\n// and instead show a partially interactive \"skeleton\".\n\n// Each Stage includes this prop,\n// which passes through props\n// to the underlying `<AppSkeleton>` component.\n// It can be used to show partial interactivity\n// while the app is loading\n// (See `<AppSkeleton>` for more info on the possible states).\nexport type StageSkeletonProps = Omit<AppSkeletonProps, 'children'>;\n\nexport type StageLoadUIStateProps = {\n  children: (props: {\n    currentTerm: string;\n    setTerm: (next: string) => void;\n    currentVersion: string;\n    setVersion: (next: string) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Loads in the UI State (current term,\n * current schedule version for the current term)\n * from local storage.\n * Unlike the local storage version of the app data,\n * this **does not** sync between tabs.\n * This is deliberate, as it allows opening up multiple tabs\n * with different schedules if desired,\n * but still have the app resume to the last viewed schedule when opened again.\n */\nexport function StageLoadUIState({\n  children,\n}: StageLoadUIStateProps): React.ReactElement {\n  const uiState = useUIStateFromStorage();\n  return <>{children({ ...uiState })}</>;\n}\n\nexport type StageEnsureValidTermProps = {\n  skeletonProps?: StageSkeletonProps;\n  terms: NonEmptyArray<string>;\n  currentTermRaw: string;\n  setTerm: (next: string) => void;\n  children: (props: { currentTerm: string }) => React.ReactNode;\n};\n\n/**\n * Ensures that there is a valid current term selected.\n * If the current term isn't valid (i.e. empty or not in the `terms` array),\n * then it is set to the most recent term (which is the first item in `terms`).\n */\nexport function StageEnsureValidTerm({\n  skeletonProps,\n  terms,\n  currentTermRaw,\n  setTerm,\n  children,\n}: StageEnsureValidTermProps): React.ReactElement {\n  const loadingState = useEnsureValidTerm({ terms, currentTermRaw, setTerm });\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay state={loadingState} name=\"current term\" />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ ...loadingState.result })}</>;\n}\n\nexport type StageLoadRawScheduleDataFromStorageProps = {\n  skeletonProps?: StageSkeletonProps;\n  children: (props: {\n    rawScheduleData: Immutable<AnyScheduleData> | null;\n    setRawScheduleData: (\n      next:\n        | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n        | AnyScheduleData\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Handles loading the raw local schedule data from local storage.\n * Renders a disabled header & attribution footer even when loading.\n */\nexport function StageLoadRawScheduleDataFromStorage({\n  skeletonProps,\n  children,\n}: StageLoadRawScheduleDataFromStorageProps): React.ReactElement {\n  const loadingState = useRawScheduleDataFromStorage();\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay state={loadingState} name=\"local schedule data\" />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ ...loadingState.result })}</>;\n}\n\nexport type StageMigrateScheduleDataProps = {\n  skeletonProps?: StageSkeletonProps;\n  rawScheduleData: Immutable<AnyScheduleData> | null;\n  setRawScheduleData: (\n    next:\n      | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n      | AnyScheduleData\n  ) => void;\n  children: (props: {\n    scheduleData: Immutable<ScheduleData>;\n    setScheduleData: (\n      next: ((current: ScheduleData) => ScheduleData) | ScheduleData\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Handles migrating the raw schedule data as needed to the latest version.\n */\nexport function StageMigrateScheduleData({\n  skeletonProps,\n  rawScheduleData,\n  setRawScheduleData,\n  children,\n}: StageMigrateScheduleDataProps): React.ReactElement {\n  const loadingState = useMigrateScheduleData({\n    rawScheduleData: castDraft(rawScheduleData),\n    setRawScheduleData,\n  });\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay\n            state={loadingState}\n            name=\"schema migrations to schedule data\"\n          />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ ...loadingState.result })}</>;\n}\n\nexport type StageLoadRawScheduleDataHybridProps = {\n  skeletonProps?: StageSkeletonProps;\n  accountState: AccountContextValue;\n  children: (props: {\n    rawScheduleData: Immutable<AnyScheduleData> | null;\n    setRawScheduleData: (\n      next:\n        | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n        | AnyScheduleData\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Handles loading the schedule data from either Firebase or local storage\n * depending on the current account state.\n */\nexport function StageLoadRawScheduleDataHybrid({\n  skeletonProps,\n  accountState,\n  children,\n}: StageLoadRawScheduleDataHybridProps): React.ReactElement {\n  if (accountState.type === 'signedIn') {\n    return (\n      <StageLoadRawScheduleDataFromFirebase\n        skeletonProps={skeletonProps}\n        accountState={accountState}\n      >\n        {children}\n      </StageLoadRawScheduleDataFromFirebase>\n    );\n  }\n\n  return (\n    <StageLoadRawScheduleDataFromStorage skeletonProps={skeletonProps}>\n      {children}\n    </StageLoadRawScheduleDataFromStorage>\n  );\n}\n\nexport type StageLoadRawScheduleDataFromFirebaseProps = {\n  skeletonProps?: StageSkeletonProps;\n  accountState: SignedIn;\n  children: (props: {\n    rawScheduleData: Immutable<AnyScheduleData> | null;\n    setRawScheduleData: (\n      next:\n        | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n        | AnyScheduleData\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Handles loading the schedule data from Firebase,\n * handling uploading initial data if the user has no document.\n * Renders a disabled header & attribution footer even when loading.\n */\nexport function StageLoadRawScheduleDataFromFirebase({\n  skeletonProps,\n  accountState,\n  children,\n}: StageLoadRawScheduleDataFromFirebaseProps): React.ReactElement {\n  const loadingState = useRawScheduleDataFromFirebase(accountState);\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay\n            state={loadingState}\n            name=\"schedule data from the cloud\"\n          />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ ...loadingState.result })}</>;\n}\n\nexport type StageLoadAccountProps = {\n  skeletonProps?: StageSkeletonProps;\n  children: (props: { accountState: AccountContextValue }) => React.ReactNode;\n};\n\n/**\n * Handles loading the user login state\n * (account state from Firebase Authentication).\n * Renders a disabled header & attribution footer even when loading.\n */\nexport function StageLoadAccount({\n  skeletonProps,\n  children,\n}: StageLoadAccountProps): React.ReactElement {\n  const accountState = useFirebaseAuth();\n\n  if (accountState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay state={accountState} name=\"account\" />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ accountState: accountState.result })}</>;\n}\n\nexport type StageCreateScheduleDataProducerProps = {\n  setScheduleData: (\n    next: ((current: ScheduleData) => ScheduleData) | ScheduleData\n  ) => void;\n  children: (props: {\n    // This is similar to a function like `(next: ScheduleData) => void`\n    // in that it lets callers update the schedule data, but it uses Immer.js\n    // to provide a mutable \"draft\" that allows callers to treat\n    // the parameter given in the callback as if it can be directly mutated.\n    // This saves verbose code that is normally used to deeply clone objects\n    // before changing them whenever immutable state updates are needed\n    // (which is common in React apps).\n    // Read more about it here: https://immerjs.github.io/immer/\n    //\n    // This function allows the schedule data to be edited in 1 of 2 ways:\n    // 1. the draft parameter is mutated, and the function returns nothing/void\n    // 2. the draft parameter is not mutated\n    //    (it can still be used, just not mutated)\n    //    and the function returns the new state to use.\n    //    This is similar to a traditional setState callback\n    updateScheduleData: (\n      applyDraft: (draft: Draft<ScheduleData>) => void | Immutable<ScheduleData>\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Creates the `updateScheduleData` Immer producer\n * from the `setScheduleData` setter.\n * The producer is used to more easily modify state.\n */\nexport function StageCreateScheduleDataProducer({\n  setScheduleData,\n  children,\n}: StageCreateScheduleDataProducerProps): React.ReactElement {\n  const { updateScheduleData } = useScheduleDataProducer({ setScheduleData });\n  return <>{children({ updateScheduleData })}</>;\n}\n\nexport type StageLoadTermsProps = {\n  skeletonProps?: StageSkeletonProps;\n  children: (props: { terms: NonEmptyArray<string> }) => React.ReactNode;\n};\n\n/**\n * Handles loading the list of terms from the crawler's index upon first mount,\n * showing loading and error states as needed.\n * Renders a disabled header & attribution footer even when loading.\n */\nexport function StageLoadTerms({\n  skeletonProps,\n  children,\n}: StageLoadTermsProps): React.ReactElement {\n  const loadingState = useDownloadTerms();\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay state={loadingState} name=\"list of current terms\" />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ terms: loadingState.result })}</>;\n}\n\nexport type StageExtractTermScheduleDataProps = {\n  skeletonProps?: StageSkeletonProps;\n  currentTerm: string;\n  scheduleData: Immutable<ScheduleData>;\n  updateScheduleData: (\n    applyDraft: (draft: Draft<ScheduleData>) => void | Immutable<ScheduleData>\n  ) => void;\n  children: (props: {\n    termScheduleData: Immutable<TermScheduleData>;\n    // This function allows the term schedule data to be edited in 1 of 2 ways:\n    // 1. the draft parameter is mutated, and the function returns nothing/void\n    // 2. the draft parameter is not mutated\n    //    (it can still be used, just not mutated)\n    //    and the function returns the new state to use.\n    //    This is similar to a traditional setState callback\n    updateTermScheduleData: (\n      applyDraft: (\n        draft: Draft<TermScheduleData>\n      ) => void | Immutable<TermScheduleData>\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Handles extracting the term schedule data from the parent schedule data,\n * ensuring that the term is valid before rendering its children.\n */\nexport function StageExtractTermScheduleData({\n  skeletonProps,\n  currentTerm,\n  scheduleData,\n  updateScheduleData,\n  children,\n}: StageExtractTermScheduleDataProps): React.ReactElement {\n  const loadingState = useExtractTermScheduleData({\n    currentTerm,\n    scheduleData,\n    updateScheduleData,\n  });\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay\n            state={loadingState}\n            name=\"schedule data for the current term\"\n          />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ ...loadingState.result })}</>;\n}\n\n/**\n * Loads the instance of the `Oscar` bean from the crawled data,\n * showing loading and error states as needed.\n * Renders a disabled header & attribution footer even when loading.\n */\nexport type StageLoadOscarDataProps = {\n  skeletonProps?: StageSkeletonProps;\n  term: string;\n  children: (props: { oscar: Oscar }) => React.ReactNode;\n};\n\nexport function StageLoadOscarData({\n  skeletonProps,\n  term,\n  children,\n}: StageLoadOscarDataProps): React.ReactElement {\n  const loadingState = useDownloadOscarData(term);\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay\n            state={loadingState}\n            name=\"Oscar course data for the current term\"\n          />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ oscar: loadingState.result })}</>;\n}\n\nexport type StageExtractScheduleVersionProps = {\n  skeletonProps?: StageSkeletonProps;\n  currentVersionRaw: string;\n  setVersion: (next: string) => void;\n  termScheduleData: Immutable<TermScheduleData>;\n  updateTermScheduleData: (\n    applyDraft: (\n      draft: Draft<TermScheduleData>\n    ) => void | Immutable<TermScheduleData>\n  ) => void;\n  children: (props: {\n    currentVersion: string;\n    scheduleVersion: Immutable<ScheduleVersion>;\n    // This function allows the schedule version to be edited in 1 of 2 ways:\n    // 1. the draft parameter is mutated, and the function returns nothing/void\n    // 2. the draft parameter is not mutated\n    //    (it can still be used, just not mutated)\n    //    and the function returns the new state to use.\n    //    This is similar to a traditional setState callback\n    updateScheduleVersion: (\n      applyDraft: (\n        draft: Draft<ScheduleVersion>\n      ) => void | Immutable<ScheduleVersion>\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Handles extracting the schedule version from the parent tern schedule data,\n * ensuring that it is valid before rendering its children.\n */\nexport function StageExtractScheduleVersion({\n  skeletonProps,\n  currentVersionRaw,\n  setVersion,\n  termScheduleData,\n  updateTermScheduleData,\n  children,\n}: StageExtractScheduleVersionProps): React.ReactElement {\n  const loadingState = useExtractSchedule({\n    termScheduleData,\n    updateTermScheduleData,\n    currentVersionRaw,\n    setVersion,\n  });\n\n  if (loadingState.type !== 'loaded') {\n    return (\n      <AppSkeleton {...skeletonProps}>\n        <SkeletonContent>\n          <LoadingDisplay\n            state={loadingState}\n            name=\"current schedule version\"\n          />\n        </SkeletonContent>\n      </AppSkeleton>\n    );\n  }\n\n  return <>{children({ ...loadingState.result })}</>;\n}\n","import { useState, useEffect, useCallback } from 'react';\n\nimport { softError, ErrorWithFields } from '../../log';\nimport {\n  LoadingStateError,\n  LoadingStateCustom,\n  LoadingState,\n} from '../../types';\nimport migrateScheduleData from '../migrations';\nimport {\n  AnyScheduleData,\n  ScheduleData,\n  LATEST_SCHEDULE_DATA_VERSION,\n} from '../types';\n\ntype HookResult = {\n  scheduleData: ScheduleData;\n  setScheduleData: (\n    next: ((current: ScheduleData) => ScheduleData) | ScheduleData\n  ) => void;\n};\n\n/**\n * Performs an asynchronous migration of the schedule data,\n * ensuring that it is of the latest version's shape\n * using the migrations defined in `src/data/migrations.\n */\nexport default function useMigrateScheduleData({\n  rawScheduleData,\n  setRawScheduleData,\n}: {\n  rawScheduleData: AnyScheduleData | null;\n  setRawScheduleData: (\n    next:\n      | ((current: AnyScheduleData | null) => AnyScheduleData | null)\n      | AnyScheduleData\n  ) => void;\n}): LoadingState<HookResult> {\n  const [error, setError] = useState<\n    LoadingStateError | LoadingStateCustom | null\n  >(null);\n\n  useEffect(() => {\n    // Make sure the data needs migrating\n    if (\n      rawScheduleData !== null &&\n      rawScheduleData.version === LATEST_SCHEDULE_DATA_VERSION\n    ) {\n      return;\n    }\n\n    // Check to see if the version is newer than we can handle\n    if (\n      rawScheduleData !== null &&\n      rawScheduleData.version > LATEST_SCHEDULE_DATA_VERSION\n    ) {\n      const err = new ErrorWithFields({\n        message: 'schedule data version is greater than max supported version',\n        fields: {\n          version: rawScheduleData.version,\n          maxSupportedVersion: LATEST_SCHEDULE_DATA_VERSION,\n        },\n      });\n      softError(err);\n      setError({\n        type: 'error',\n        error: err,\n        stillLoading: false,\n        overview: 'could not load stored schedule data: unknown format',\n      });\n      return;\n    }\n\n    try {\n      const updatedScheduleData = migrateScheduleData(rawScheduleData);\n      setRawScheduleData(updatedScheduleData);\n    } catch (err) {\n      // An error occurred: the safe thing to do is report to the user & stop\n      const newError = new ErrorWithFields({\n        source: err,\n        message: 'an error occurred when loading schedule data',\n      });\n\n      softError(newError);\n      setError({\n        type: 'error',\n        error: newError,\n        stillLoading: false,\n        overview: 'could not convert stored schedule data to latest version',\n      });\n    }\n  }, [rawScheduleData, setRawScheduleData]);\n\n  // Create the setScheduleData function as a referentially stable callback.\n  const setScheduleData = useCallback(\n    (next: ((current: ScheduleData) => ScheduleData) | ScheduleData) => {\n      if (typeof next !== 'function') setRawScheduleData(next);\n      else {\n        setRawScheduleData(\n          (currentRaw: AnyScheduleData | null): AnyScheduleData | null => {\n            if (\n              currentRaw === null ||\n              currentRaw.version !== LATEST_SCHEDULE_DATA_VERSION\n            ) {\n              softError(\n                new ErrorWithFields({\n                  message:\n                    \"setScheduleData called when schedule data isn't fully migrated\",\n                  fields: {\n                    versionOrNull: currentRaw?.version ?? null,\n                  },\n                })\n              );\n              return currentRaw;\n            }\n\n            return next(currentRaw);\n          }\n        );\n      }\n    },\n    [setRawScheduleData]\n  );\n\n  if (error !== null) {\n    return error;\n  }\n\n  if (\n    rawScheduleData === null ||\n    rawScheduleData.version !== LATEST_SCHEDULE_DATA_VERSION\n  ) {\n    return { type: 'loading' };\n  }\n\n  return {\n    type: 'loaded',\n    result: {\n      scheduleData: rawScheduleData,\n      setScheduleData,\n    },\n  };\n}\n","import { useEffect, useState } from 'react';\n\nimport { AccountContextValue } from '../../contexts/account';\nimport { ErrorWithFields, softError } from '../../log';\nimport { LoadingState } from '../../types';\nimport { firebase, isAuthEnabled } from '../firebase';\n\nexport default function useFirebaseAuth(): LoadingState<AccountContextValue> {\n  const [accountState, setAccountState] = useState<AccountContextValue | null>(\n    null\n  );\n\n  // Listen to the Firebase Auth state and set the local state.\n  useEffect(() => {\n    if (!isAuthEnabled) return undefined;\n\n    const unregisterAuthObserver = firebase\n      .auth()\n      .onAuthStateChanged((user) => {\n        if (user === null) {\n          setAccountState({ type: 'signedOut' });\n        } else {\n          let provider: string | null = null;\n          if (user.providerData != null) {\n            const firstProviderData = user.providerData[0];\n            if (firstProviderData != null) {\n              provider = firstProviderData.providerId;\n            }\n          }\n          setAccountState({\n            type: 'signedIn',\n            name: user.displayName,\n            email: user.email,\n            id: user.uid,\n            provider,\n            signOut: () => {\n              firebase\n                .auth()\n                .signOut()\n                .catch((err) => {\n                  softError(\n                    new ErrorWithFields({\n                      message: 'call to firebase.auth().signOut() failed',\n                      source: err,\n                    })\n                  );\n                });\n            },\n          });\n        }\n      });\n    return (): void => unregisterAuthObserver(); // Make sure we un-register Firebase observers when the component unmounts.\n  }, []);\n\n  if (!isAuthEnabled) {\n    return {\n      type: 'loaded',\n      result: {\n        type: 'signedOut',\n      },\n    };\n  }\n\n  if (accountState === null) {\n    return { type: 'loading' };\n  }\n\n  return { type: 'loaded', result: accountState };\n}\n","import produce, { Draft, Immutable } from 'immer';\nimport { useCallback } from 'react';\n\nimport { ScheduleData } from '../types';\n\ntype HookResult = {\n  updateScheduleData: (\n    applyDraft: (draft: Draft<ScheduleData>) => void | Immutable<ScheduleData>\n  ) => void;\n};\n\n/**\n * Constructs the Immer producer\n * from the raw schedule data state setter.\n * Returns a referentially stable callback function\n * that can be used to update the schedule data using an immer draft:\n * https://immerjs.github.io/immer/produce/\n */\nexport default function useScheduleDataProducer({\n  setScheduleData,\n}: {\n  setScheduleData: (\n    next: ((current: ScheduleData) => ScheduleData) | ScheduleData\n  ) => void;\n}): HookResult {\n  const updateScheduleData = useCallback(\n    (applyDraft: (draft: Draft<ScheduleData>) => void): void =>\n      // Here, we use the callback API for the setter function\n      // returned by `useState` so that we don't have to re-generate\n      // the callback when the state changes\n      setScheduleData((current: ScheduleData) => {\n        // Use `produce` from Immer to combine the current state\n        // & caller-supplied callback that modifies the current state\n        // to produce the next state\n        return produce(current, applyDraft);\n      }),\n    [setScheduleData]\n  );\n\n  return { updateScheduleData };\n}\n","import produce, { Immutable, Draft, castDraft } from 'immer';\nimport { useEffect, useCallback } from 'react';\n\nimport { ErrorWithFields, softError } from '../../log';\nimport { LoadingState } from '../../types';\nimport {\n  ScheduleData,\n  TermScheduleData,\n  defaultTermScheduleData,\n} from '../types';\n\n/**\n * Gets the current term schedule data based on the current term.\n * If the term schedule data for the current term doesn't exist,\n * then this hook also initializes it to an empty value.\n */\nexport default function useExtractTermScheduleData({\n  currentTerm,\n  scheduleData,\n  updateScheduleData,\n}: {\n  currentTerm: string;\n  scheduleData: Immutable<ScheduleData>;\n  updateScheduleData: (\n    applyDraft: (draft: Draft<ScheduleData>) => void | Immutable<ScheduleData>\n  ) => void;\n}): LoadingState<{\n  termScheduleData: Immutable<TermScheduleData>;\n  // This function allows the term schedule data to be edited in 1 of 2 ways:\n  // 1. the draft parameter is mutated, and the function returns nothing/void\n  // 2. the draft parameter is not mutated\n  //    (it can still be used, just not mutated)\n  //    and the function returns the new state to use.\n  //    This is similar to a traditional setState callback\n  updateTermScheduleData: (\n    applyDraft: (\n      draft: Draft<TermScheduleData>\n    ) => void | Immutable<TermScheduleData>\n  ) => void;\n}> {\n  // Ensure that there is a valid term schedule data object for the term\n  useEffect(() => {\n    const currentTermScheduleData = scheduleData.terms[currentTerm];\n    const correctedTermScheduleData =\n      currentTermScheduleData === undefined\n        ? defaultTermScheduleData\n        : currentTermScheduleData;\n\n    if (correctedTermScheduleData !== currentTermScheduleData) {\n      updateScheduleData((draft) => {\n        draft.terms[currentTerm] = castDraft(correctedTermScheduleData);\n      });\n    }\n  }, [currentTerm, scheduleData.terms, updateScheduleData]);\n\n  const currentTermScheduleData = scheduleData.terms[currentTerm];\n\n  // Create a nested update callback for just the term's schedule data.\n  // This should only escape this function\n  // when `currentTermScheduleData` is not undefined\n  const updateTermScheduleData = useCallback(\n    (\n      applyDraft: (\n        draft: Draft<TermScheduleData>\n      ) => void | Immutable<TermScheduleData>\n    ): void => {\n      updateScheduleData((draft) => {\n        const currentTermScheduleDataDraft = draft.terms[currentTerm];\n        if (currentTermScheduleDataDraft === undefined) {\n          softError(\n            new ErrorWithFields({\n              message:\n                'updateTermScheduleData called on term that does not exist',\n              fields: {\n                currentTerm,\n                currentTermScheduleData,\n                allTermsInData: Object.keys(draft.terms),\n              },\n            })\n          );\n          return;\n        }\n\n        draft.terms[currentTerm] = produce(\n          currentTermScheduleDataDraft,\n          (termScheduleData) => castDraft(applyDraft(termScheduleData))\n        );\n      });\n    },\n    [currentTerm, currentTermScheduleData, updateScheduleData]\n  );\n\n  if (currentTermScheduleData === undefined) {\n    return { type: 'loading' };\n  }\n\n  return {\n    type: 'loaded',\n    result: {\n      termScheduleData: currentTermScheduleData,\n      updateTermScheduleData,\n    },\n  };\n}\n","import axios from 'axios';\nimport { useEffect, useState, useRef } from 'react';\n\nimport { Oscar } from '../beans';\nimport { ErrorWithFields, softError } from '../../log';\nimport { CrawlerTermData, LoadingState } from '../../types';\nimport {\n  exponentialBackoff,\n  isAxiosNetworkError,\n  sleep,\n} from '../../utils/misc';\nimport Cancellable from '../../utils/cancellable';\n\nconst constructTermDataUrl = (term: string): string =>\n  `https://gt-scheduler.github.io/crawler/${term}.json`;\n\n// Number of minutes between re-downloads of the oscar data\nconst REFRESH_INTERVAL_MIN = 15;\n\n/**\n * Downloads the crawled data from Oscar that the crawler prepared\n * for the given term.\n * Repeatedly attempts to load in the case of errors,\n * and cancels any in-flight downloads if the parent context is unmounted\n * or the term is changed.\n * Once loaded, this also attempts to update the data every 15 minutes\n * in case the crawler has run again and there is updated data.\n * @param term - The term to fetch crawler data for\n */\nexport default function useDownloadOscarData(\n  term: string\n): LoadingState<Oscar> {\n  const [state, setState] = useState<LoadingState<Oscar>>({\n    type: 'loading',\n  });\n\n  // Keep a ref of the latest loaded Oscar\n  // to check if it is any newer than the current one.\n  const loadedOscarRef = useRef<Oscar | null>(null);\n\n  // Fetch the current term's crawler information\n  useEffect(() => {\n    const loadOperation = new Cancellable();\n    const url = constructTermDataUrl(term);\n\n    async function loadAndRefresh(): Promise<void> {\n      let isFirst = true;\n      while (!loadOperation.isCancelled) {\n        // Load the oscar data, showing errors only if this is the first time\n        // it is being loaded (otherwise, just log errors\n        // but don't disrupt the user). This is to prevent\n        // a background refresh from showing an error screen\n        // in the middle of a session.\n        // `load` will return early if it is cancelled\n        await load({ initialLoad: isFirst });\n        if (loadOperation.isCancelled) return;\n\n        // Sleep for the refresh interval,\n        // exiting early if cancelled\n        const promise = sleep({ amount_ms: REFRESH_INTERVAL_MIN * 60 * 1000 });\n        const result = await loadOperation.perform(promise);\n        if (result.cancelled) {\n          return;\n        }\n\n        isFirst = false;\n      }\n    }\n\n    async function load({\n      initialLoad,\n    }: {\n      initialLoad: boolean;\n    }): Promise<void> {\n      if (initialLoad) {\n        setState({\n          type: 'loading',\n        });\n      }\n\n      let attemptNumber = 1;\n      while (!loadOperation.isCancelled) {\n        try {\n          const promise = axios.get<CrawlerTermData>(url);\n          const result = await loadOperation.perform(promise);\n          if (result.cancelled) {\n            return;\n          }\n\n          const json = result.value.data;\n\n          // If the data is the same as the currently loaded data,\n          // skip loading it\n          if (\n            loadedOscarRef.current !== null &&\n            new Date(json.updatedAt).getTime() ===\n              loadedOscarRef.current?.updatedAt.getTime()\n          ) {\n            // Skip this update\n            return;\n          }\n\n          const oscar = new Oscar(json, term);\n          setState({\n            type: 'loaded',\n            result: oscar,\n          });\n          loadedOscarRef.current = oscar;\n\n          return;\n        } catch (err) {\n          // Report the error to Sentry if not a network error\n          if (!isAxiosNetworkError(err)) {\n            softError(\n              new ErrorWithFields({\n                message: 'error fetching crawler data',\n                source: err,\n                fields: {\n                  term,\n                  url,\n                },\n              })\n            );\n          }\n\n          if (initialLoad) {\n            // Flag that an error has occurred\n            setState({\n              type: 'error',\n              error:\n                err instanceof Error\n                  ? err\n                  : new ErrorWithFields({\n                      message: 'an error occurred while fetching crawler data',\n                      source: err,\n                    }),\n              stillLoading: true,\n              overview: String(err),\n            });\n          }\n        }\n\n        // Sleep for an exponential backoff between each retry\n        await exponentialBackoff(attemptNumber);\n        attemptNumber += 1;\n      }\n    }\n\n    loadAndRefresh().catch((err) => {\n      softError(\n        new ErrorWithFields({\n          message: 'error loading and refreshing oscar data',\n          source: err,\n          fields: {\n            term,\n            url,\n          },\n        })\n      );\n    });\n\n    // Cancel the background load when this cleans up\n    return (): void => {\n      loadOperation.cancel();\n    };\n  }, [term, setState]);\n\n  // If we are about to start a new background load\n  // after the term changed, then don't return a loaded Oscar\n  if (state.type === 'loaded' && state.result.term !== term) {\n    return { type: 'loading' };\n  }\n\n  return state;\n}\n","import produce, { Immutable, Draft, castDraft } from 'immer';\nimport { useEffect, useCallback } from 'react';\n\nimport { ErrorWithFields, softError } from '../../log';\nimport { LoadingState } from '../../types';\nimport { lexicographicCompare } from '../../utils/misc';\nimport {\n  TermScheduleData,\n  defaultSchedule,\n  ScheduleVersion,\n  generateScheduleVersionId,\n} from '../types';\n\n/**\n * Gets the current schedule version from the term schedule data,\n * ensuring that there is a valid current version selected.\n * If the current version isn't valid,\n * then this hook switches to a random existing version.\n * If there are no versions, then this hook automatically creates\n * an empty schedule version called 'Primary' and sets it as the current one.\n */\nexport default function useExtractScheduleVersion({\n  termScheduleData,\n  updateTermScheduleData,\n  currentVersionRaw,\n  setVersion,\n}: {\n  termScheduleData: Immutable<TermScheduleData>;\n  updateTermScheduleData: (\n    applyDraft: (\n      draft: Draft<TermScheduleData>\n    ) => void | Immutable<TermScheduleData>\n  ) => void;\n  currentVersionRaw: string;\n  setVersion: (next: string) => void;\n}): LoadingState<{\n  currentVersion: string;\n  scheduleVersion: Immutable<ScheduleVersion>;\n  // This function allows the schedule version to be edited in 1 of 2 ways:\n  // 1. the draft parameter is mutated, and the function returns nothing/void\n  // 2. the draft parameter is not mutated\n  //    (it can still be used, just not mutated)\n  //    and the function returns the new state to use.\n  //    This is similar to a traditional setState callback\n  updateScheduleVersion: (\n    applyDraft: (\n      draft: Draft<ScheduleVersion>\n    ) => void | Immutable<ScheduleVersion>\n  ) => void;\n}> {\n  // Switch the version to any other version if the current one is invalid.\n  // If there are no versions, then create a new one called 'Primary'\n  const maybeCurrentScheduleVersion =\n    termScheduleData.versions[currentVersionRaw] ?? null;\n  useEffect(() => {\n    if (maybeCurrentScheduleVersion === null) {\n      updateTermScheduleData((draft) => {\n        // Make sure the schedule isn't on the draft either\n        if (draft.versions[currentVersionRaw] == null) {\n          if (Object.keys(draft.versions).length === 0) {\n            // Create a new version called 'Primary'\n            const id = generateScheduleVersionId();\n            draft.versions[id] = {\n              name: 'Primary',\n              createdAt: new Date().toISOString(),\n              schedule: castDraft(defaultSchedule),\n            };\n            setVersion(id);\n          } else {\n            // Set the current version to the first one,\n            // sorted by their createdAt time\n            const allVersions = Object.entries(draft.versions).sort(\n              ([, a], [, b]) => lexicographicCompare(a.createdAt, b.createdAt)\n            );\n            setVersion(allVersions[0]?.[0] as string);\n          }\n        }\n      });\n    }\n  }, [\n    currentVersionRaw,\n    maybeCurrentScheduleVersion,\n    updateTermScheduleData,\n    setVersion,\n  ]);\n\n  // Create a nested update callback for just the schedule version.\n  // This should only escape this function\n  // when `maybeCurrentScheduleVersion` is not null\n  const updateScheduleVersion = useCallback(\n    (\n      applyDraft: (\n        draft: Draft<ScheduleVersion>\n      ) => void | Immutable<ScheduleVersion>\n    ): void => {\n      updateTermScheduleData((draft) => {\n        const currentScheduleVersionDraft =\n          draft.versions[currentVersionRaw] ?? null;\n        if (currentScheduleVersionDraft === null) {\n          softError(\n            new ErrorWithFields({\n              message:\n                'updateScheduleVersion called with invalid current schedule version; ignoring',\n              fields: {\n                currentVersionRaw,\n                currentScheduleVersion: null,\n              },\n            })\n          );\n          return;\n        }\n\n        draft.versions[currentVersionRaw] = produce(\n          currentScheduleVersionDraft,\n          (subDraft) => castDraft(applyDraft(subDraft))\n        );\n      });\n    },\n    [updateTermScheduleData, currentVersionRaw]\n  );\n\n  if (maybeCurrentScheduleVersion === null) {\n    return {\n      type: 'loading',\n    };\n  }\n\n  return {\n    type: 'loaded',\n    result: {\n      currentVersion: currentVersionRaw,\n      scheduleVersion: maybeCurrentScheduleVersion,\n      updateScheduleVersion,\n    },\n  };\n}\n","import produce, { Immutable, Draft, original, castDraft } from 'immer';\nimport React, { useCallback, useMemo } from 'react';\n\nimport {\n  ScheduleContextValue,\n  TermsContext,\n  ScheduleContext,\n} from '../../contexts';\nimport { AccountContext, AccountContextValue } from '../../contexts/account';\nimport { Oscar } from '../../data/beans';\nimport useVersionActions from '../../data/hooks/useVersionActions';\nimport {\n  Schedule,\n  defaultSchedule,\n  TermScheduleData,\n  ScheduleVersion,\n  ScheduleData,\n} from '../../data/types';\nimport { lexicographicCompare } from '../../utils/misc';\nimport {\n  StageLoadUIState,\n  StageLoadTerms,\n  StageEnsureValidTerm,\n  StageLoadAccount,\n  StageLoadRawScheduleDataHybrid,\n  StageMigrateScheduleData,\n  StageCreateScheduleDataProducer,\n  StageExtractTermScheduleData,\n  StageLoadOscarData,\n  StageExtractScheduleVersion,\n  StageSkeletonProps,\n} from './stages';\n\nexport type DataLoaderProps = {\n  children: React.ReactNode;\n};\n\n/**\n * Handles loading all relevant data and provide valid values\n * for the Terms, Term, and Account contexts before rendering its `children`.\n * Works by having a series of \"stages\" implemented as components,\n * where each stage doesn't render its children until its ready.\n * Until then, they won't run the function passed in to their `children` prop\n * and will instead show an intermediate loading state,\n * complete with an app \"skeleton\" that includes the footer/header.\n */\nexport default function DataLoader({\n  children,\n}: DataLoaderProps): React.ReactElement {\n  return (\n    <StageLoadUIState>\n      {({\n        // The values gotten from `StageLoadUIState` are \"raw\"--\n        // they may not point to valid terms/versions.\n        // As such, we use the two `StageExtract...` components\n        // to maintain the invariant that there are valid terms/versions,\n        // and the output of those stages are the \"non-raw\" versions\n        // of `currentTermRaw` and `currentVersionRaw`.\n        currentTerm: currentTermRaw,\n        setTerm,\n        currentVersion: currentVersionRaw,\n        setVersion,\n      }): React.ReactElement => (\n        <StageLoadTerms>\n          {({ terms }): React.ReactElement => (\n            <StageEnsureValidTerm\n              terms={terms}\n              setTerm={setTerm}\n              currentTermRaw={currentTermRaw}\n            >\n              {({ currentTerm }): React.ReactElement => {\n                // From here down, we can pass\n                // the `termsState` value to the `skeletonProps`\n                // prop on each stage to allow the user to switch terms\n                // even as the rest of the app is loading.\n                const termsState = {\n                  terms,\n                  onChangeTerm: setTerm,\n                  currentTerm,\n                };\n                return (\n                  <StageLoadAccount skeletonProps={{ termsState }}>\n                    {({ accountState }): React.ReactElement => (\n                      <GroupLoadScheduleData\n                        accountState={accountState}\n                        skeletonProps={{ termsState, accountState }}\n                      >\n                        {({\n                          scheduleData,\n                          updateScheduleData,\n                        }): React.ReactElement => (\n                          <StageExtractTermScheduleData\n                            skeletonProps={{ termsState, accountState }}\n                            currentTerm={currentTerm}\n                            scheduleData={scheduleData}\n                            updateScheduleData={updateScheduleData}\n                          >\n                            {({\n                              termScheduleData,\n                              updateTermScheduleData,\n                            }): React.ReactElement => (\n                              <StageLoadOscarData\n                                skeletonProps={{ termsState, accountState }}\n                                term={currentTerm}\n                              >\n                                {({ oscar }): React.ReactElement => (\n                                  <StageExtractScheduleVersion\n                                    skeletonProps={{ termsState, accountState }}\n                                    currentVersionRaw={currentVersionRaw}\n                                    setVersion={setVersion}\n                                    termScheduleData={termScheduleData}\n                                    updateTermScheduleData={\n                                      updateTermScheduleData\n                                    }\n                                  >\n                                    {({\n                                      currentVersion,\n                                      scheduleVersion,\n                                      updateScheduleVersion,\n                                    }): React.ReactElement => (\n                                      <ContextProvider\n                                        terms={terms}\n                                        currentTerm={currentTerm}\n                                        setTerm={setTerm}\n                                        currentVersion={currentVersion}\n                                        setVersion={setVersion}\n                                        oscar={oscar}\n                                        scheduleVersion={scheduleVersion}\n                                        updateScheduleVersion={\n                                          updateScheduleVersion\n                                        }\n                                        termScheduleData={termScheduleData}\n                                        updateTermScheduleData={\n                                          updateTermScheduleData\n                                        }\n                                        accountState={accountState}\n                                      >\n                                        {children}\n                                      </ContextProvider>\n                                    )}\n                                  </StageExtractScheduleVersion>\n                                )}\n                              </StageLoadOscarData>\n                            )}\n                          </StageExtractTermScheduleData>\n                        )}\n                      </GroupLoadScheduleData>\n                    )}\n                  </StageLoadAccount>\n                );\n              }}\n            </StageEnsureValidTerm>\n          )}\n        </StageLoadTerms>\n      )}\n    </StageLoadUIState>\n  );\n}\n\n// Private sub-components\n\ntype GroupLoadScheduleDataProps = {\n  skeletonProps?: StageSkeletonProps;\n  accountState: AccountContextValue;\n  children: (props: {\n    scheduleData: Immutable<ScheduleData>;\n    updateScheduleData: (\n      applyDraft: (draft: Draft<ScheduleData>) => void | Immutable<ScheduleData>\n    ) => void;\n  }) => React.ReactNode;\n};\n\n/**\n * Groups together stages related to loading schedule data\n * and migrating it as needed.\n */\nfunction GroupLoadScheduleData({\n  skeletonProps,\n  accountState,\n  children,\n}: GroupLoadScheduleDataProps): React.ReactElement {\n  return (\n    <StageLoadRawScheduleDataHybrid\n      skeletonProps={skeletonProps}\n      accountState={accountState}\n    >\n      {({ rawScheduleData, setRawScheduleData }): React.ReactElement => (\n        <StageMigrateScheduleData\n          skeletonProps={skeletonProps}\n          rawScheduleData={rawScheduleData}\n          setRawScheduleData={setRawScheduleData}\n        >\n          {({ scheduleData, setScheduleData }): React.ReactElement => (\n            <StageCreateScheduleDataProducer setScheduleData={setScheduleData}>\n              {({ updateScheduleData }): React.ReactElement => (\n                <>{children({ scheduleData, updateScheduleData })}</>\n              )}\n            </StageCreateScheduleDataProducer>\n          )}\n        </StageMigrateScheduleData>\n      )}\n    </StageLoadRawScheduleDataHybrid>\n  );\n}\n\ntype ContextProviderProps = {\n  terms: string[];\n  currentTerm: string;\n  setTerm: (next: string) => void;\n  currentVersion: string;\n  setVersion: (next: string) => void;\n  oscar: Oscar;\n  scheduleVersion: Immutable<ScheduleVersion>;\n  updateScheduleVersion: (\n    applyDraft: (\n      draft: Draft<ScheduleVersion>\n    ) => void | Immutable<ScheduleVersion>\n  ) => void;\n  termScheduleData: Immutable<TermScheduleData>;\n  updateTermScheduleData: (\n    applyDraft: (\n      draft: Draft<TermScheduleData>\n    ) => void | Immutable<TermScheduleData>\n  ) => void;\n  accountState: AccountContextValue;\n  children: React.ReactNode;\n};\n\n/**\n * Handles making all loaded data available to the rest of the app\n * via the contexts `TermsContext`, `ScheduleContext`, and `AccountContext`.\n * Additionally, this function memoizes the context values\n * as well as any derived values that go into them.\n */\nfunction ContextProvider({\n  terms,\n  currentTerm,\n  setTerm,\n  currentVersion,\n  setVersion,\n  oscar,\n  scheduleVersion,\n  updateScheduleVersion,\n  termScheduleData,\n  updateTermScheduleData,\n  accountState,\n  children,\n}: ContextProviderProps): React.ReactElement {\n  // Create a `updateSchedule` function\n  const updateSchedule = useCallback(\n    (\n      applyDraft: (draft: Draft<Schedule>) => void | Immutable<Schedule>\n    ): void => {\n      updateScheduleVersion((draft) => {\n        draft.schedule = produce(draft.schedule, (subDraft) =>\n          castDraft(applyDraft(subDraft))\n        );\n      });\n    },\n    [updateScheduleVersion]\n  );\n\n  // Create a `patchSchedule` function\n  const patchSchedule = useCallback(\n    (patch: Partial<Schedule>): void => {\n      updateSchedule((draft) => ({\n        ...(original(draft) ?? defaultSchedule),\n        ...patch,\n      }));\n    },\n    [updateSchedule]\n  );\n\n  // Derive the list of all version names (and IDs)\n  // in the order of their `createdAt` field.\n  const allVersionNames = useMemo<{ id: string; name: string }[]>(() => {\n    const versions = Object.entries(termScheduleData.versions).map(\n      ([versionId, { name }]) => ({ id: versionId, name })\n    );\n    versions.sort((a, b) => {\n      const createdAtA = termScheduleData.versions[a.id]?.createdAt ?? '';\n      const createdAtB = termScheduleData.versions[b.id]?.createdAt ?? '';\n      return lexicographicCompare(createdAtA, createdAtB);\n    });\n    return versions;\n  }, [termScheduleData.versions]);\n\n  // Get all version-related actions\n  const { addNewVersion, deleteVersion, renameVersion, cloneVersion } =\n    useVersionActions({\n      updateTermScheduleData,\n      setVersion,\n      currentVersion,\n    });\n\n  // Memoize the context values so that they are stable\n  const scheduleContextValue = useMemo<ScheduleContextValue>(\n    () => [\n      {\n        term: currentTerm,\n        oscar,\n        currentVersion,\n        allVersionNames,\n        ...castDraft(scheduleVersion.schedule),\n      },\n      {\n        setTerm,\n        patchSchedule,\n        updateSchedule,\n        setCurrentVersion: setVersion,\n        addNewVersion,\n        deleteVersion,\n        renameVersion,\n        cloneVersion,\n      },\n    ],\n    [\n      currentTerm,\n      oscar,\n      currentVersion,\n      allVersionNames,\n      scheduleVersion.schedule,\n      setTerm,\n      patchSchedule,\n      updateSchedule,\n      setVersion,\n      addNewVersion,\n      deleteVersion,\n      renameVersion,\n      cloneVersion,\n    ]\n  );\n\n  return (\n    <TermsContext.Provider value={terms}>\n      <ScheduleContext.Provider value={scheduleContextValue}>\n        <AccountContext.Provider value={accountState}>\n          {children}\n        </AccountContext.Provider>\n      </ScheduleContext.Provider>\n    </TermsContext.Provider>\n  );\n}\n","import { castDraft, Draft, Immutable } from 'immer';\nimport { useCallback } from 'react';\n\nimport { softError, ErrorWithFields } from '../../log';\nimport {\n  defaultSchedule,\n  generateScheduleVersionId,\n  TermScheduleData,\n} from '../types';\n\nexport type HookResult = {\n  addNewVersion: (name: string, select?: boolean) => string;\n  deleteVersion: (id: string) => void;\n  renameVersion: (id: string, newName: string) => void;\n  cloneVersion: (id: string, newName: string) => void;\n};\n\n/**\n * Creates a small handful of semantic actions that update the schedule versions\n * from the base `updateTermScheduleData` callback.\n */\nexport default function useVersionActions({\n  updateTermScheduleData,\n  setVersion,\n  currentVersion,\n}: {\n  updateTermScheduleData: (\n    applyDraft: (\n      draft: Draft<TermScheduleData>\n    ) => void | Immutable<TermScheduleData>\n  ) => void;\n  setVersion: (next: string) => void;\n  currentVersion: string;\n}): HookResult {\n  // Create an `addNewVersion` function.\n  // Returns the ID of the created schedule version.\n  const addNewVersion = useCallback(\n    (name: string, select = false): string => {\n      const id = generateScheduleVersionId();\n      updateTermScheduleData((draft) => {\n        draft.versions[id] = {\n          name,\n          schedule: castDraft(defaultSchedule),\n          createdAt: new Date().toISOString(),\n        };\n      });\n      if (select) {\n        setVersion(id);\n      }\n      return id;\n    },\n    [updateTermScheduleData, setVersion]\n  );\n\n  // Create a `deleteVersion` function\n  const deleteVersion = useCallback(\n    (id: string): void => {\n      updateTermScheduleData((draft) => {\n        if (draft.versions[id] == null) {\n          softError(\n            new ErrorWithFields({\n              message:\n                'deleteVersion called with non-existent version id; ignoring',\n              fields: {\n                allVersionNames: Object.entries(draft.versions).map(\n                  ([versionId, { name }]) => ({ id: versionId, name })\n                ),\n                versionCount: Object.keys(draft.versions).length,\n                id,\n              },\n            })\n          );\n          return;\n        }\n\n        // Check to see if we also need to assign a new current version.\n        // This is the case if the current index is the deleted index,\n        // in which case we want to select the previous item\n        // (this is arbitrary; it's just our decided behavior)\n        if (currentVersion === id) {\n          const entries = Object.entries(draft.versions);\n          delete draft.versions[id];\n\n          if (\n            entries.length === 0 ||\n            Object.keys(draft.versions).length === 0\n          ) {\n            // The versions list is empty:\n            // create a new version called 'Primary'\n            const newId = generateScheduleVersionId();\n            draft.versions[newId] = {\n              name: 'Primary',\n              createdAt: new Date().toISOString(),\n              schedule: castDraft(defaultSchedule),\n            };\n            setVersion(newId);\n            return;\n          }\n\n          // Select the previous version if we can\n          // by sorting all versions by their createdAt date.\n          const sorted = entries.sort(([, a], [, b]) =>\n            a.createdAt > b.createdAt ? 0 : 1\n          );\n          const indexOfDeleting = sorted.findIndex(\n            ([versionId]) => versionId === id\n          );\n          if (indexOfDeleting === -1) return;\n\n          const newIndex = Math.max(indexOfDeleting - 1, 0);\n\n          // If the remaining versions isn't empty,\n          // then this index must be valid\n          setVersion(sorted[newIndex]?.[0] ?? '');\n        } else {\n          // Just delete the version\n          delete draft.versions[id];\n        }\n      });\n    },\n    [updateTermScheduleData, setVersion, currentVersion]\n  );\n\n  // Create a `renameVersion` function\n  const renameVersion = useCallback(\n    (id: string, newName: string): void => {\n      updateTermScheduleData((draft) => {\n        const existingDraft = draft.versions[id];\n        if (existingDraft === undefined) {\n          softError(\n            new ErrorWithFields({\n              message:\n                \"renameVersion called with current version name that doesn't exist; ignoring\",\n              fields: {\n                allVersionNames: Object.entries(draft.versions).map(\n                  ([versionId, { name }]) => ({ id: versionId, name })\n                ),\n                id,\n                versionCount: Object.keys(draft.versions).length,\n                newName,\n              },\n            })\n          );\n          return;\n        }\n\n        existingDraft.name = newName;\n      });\n    },\n    [updateTermScheduleData]\n  );\n\n  const cloneVersion = useCallback(\n    (id: string, newName: string): void => {\n      const newId = addNewVersion(newName, false);\n      updateTermScheduleData((draft) => {\n        const existingDraft = draft.versions[id];\n        if (existingDraft === undefined) {\n          softError(\n            new ErrorWithFields({\n              message:\n                \"cloneVersion called with current version name that doesn't exist; ignoring\",\n              fields: {\n                allVersionNames: Object.entries(draft.versions).map(\n                  ([versionId, { name }]) => ({ id: versionId, name })\n                ),\n                id,\n                versionCount: Object.keys(draft.versions).length,\n                newName,\n              },\n            })\n          );\n          return;\n        }\n        const newDraft = draft.versions[newId];\n        if (newDraft !== undefined) {\n          newDraft.schedule = castDraft(existingDraft.schedule);\n        }\n      });\n    },\n    [updateTermScheduleData, addNewVersion]\n  );\n\n  return { addNewVersion, deleteVersion, renameVersion, cloneVersion };\n}\n","import Cookies from 'js-cookie';\nimport { useEffect, useMemo } from 'react';\nimport useLocalStorageState from 'use-local-storage-state';\n\nimport { ThemeContextValue } from '../../contexts';\nimport { isTheme } from '../../types';\n\nconst THEME_LOCAL_STORAGE_KEY = 'theme';\n\n/**\n * Loads the current UI theme (light/dark) from local storage,\n * falling back to the legacy cookies-based storage if necessary.\n * Returns a memoized value of the theme context.\n */\nexport default function useThemeFromStorage(): ThemeContextValue {\n  const [theme, setTheme] = useLocalStorageState(\n    THEME_LOCAL_STORAGE_KEY,\n    () => {\n      const legacyValue = Cookies.get(THEME_LOCAL_STORAGE_KEY);\n      if (legacyValue !== undefined) return legacyValue;\n      return 'dark';\n    }\n  );\n  const correctedTheme = isTheme(theme) ? theme : 'dark';\n\n  // Ensure that the stored theme is valid; otherwise reset it\n  useEffect(() => {\n    if (theme !== correctedTheme) {\n      setTheme(correctedTheme);\n    }\n  }, [theme, correctedTheme, setTheme]);\n\n  const themeContextValue = useMemo<ThemeContextValue>(\n    () => [correctedTheme, setTheme],\n    [correctedTheme, setTheme]\n  );\n\n  return themeContextValue;\n}\n","import React from 'react';\n\nimport { classes } from '../../utils/misc';\nimport Feedback from '../Feedback';\nimport useBodyClass from '../../hooks/useBodyClass';\nimport { ThemeContext } from '../../contexts';\nimport InformationModal from '../InformationModal';\nimport ErrorBoundary from '../ErrorBoundary';\nimport { ReactErrorDetails } from '../ErrorDetails';\nimport ErrorDisplay from '../ErrorDisplay';\nimport ErrorHeader from '../ErrorHeader';\nimport { AppNavigation } from './navigation';\nimport AppDataLoader from '../AppDataLoader';\nimport { AppSkeleton, SkeletonContent, AppContent } from './content';\nimport useThemeFromStorage from '../../data/hooks/useThemeFromStorage';\nimport { DESKTOP_BREAKPOINT } from '../../constants';\nimport useScreenWidth from '../../hooks/useScreenWidth';\n\nimport 'react-virtualized/styles.css';\nimport './stylesheet.scss';\n\nexport default function App(): React.ReactElement {\n  // Grab the current theme (light/dark) from local storage.\n  // This hook returns the memoized context value.\n  const themeContextValue = useThemeFromStorage();\n\n  // Add the current theme as a class on the body element\n  useBodyClass(themeContextValue[0]);\n\n  return (\n    <ThemeContext.Provider value={themeContextValue}>\n      <AppCSSRoot>\n        <ErrorBoundary\n          fallback={(error, errorInfo): React.ReactElement => (\n            <AppSkeleton>\n              <SkeletonContent>\n                <ErrorHeader />\n                <ErrorDisplay\n                  errorDetails={\n                    <ReactErrorDetails error={error} errorInfo={errorInfo} />\n                  }\n                >\n                  <div>\n                    There was en error somewhere in the core application logic\n                    and it can&apos;t continue.\n                  </div>\n                  <div>\n                    Try refreshing the page to see if it fixes the issue.\n                  </div>\n                </ErrorDisplay>\n              </SkeletonContent>\n            </AppSkeleton>\n          )}\n        >\n          <AppNavigation>\n            {/* AppDataLoader is in charge of ensuring that there are valid values\n                for the Terms and Term contexts before rendering its children.\n                If any data is still loading,\n                then it displays an \"app skeleton\" with a spinner.\n                If there was an error while loading\n                then it displays an error screen. */}\n            <AppDataLoader>\n              <AppContent />\n            </AppDataLoader>\n          </AppNavigation>\n          <Feedback />\n\n          {/* Display a popup when first visiting the site */}\n          <InformationModal />\n        </ErrorBoundary>\n      </AppCSSRoot>\n    </ThemeContext.Provider>\n  );\n}\n\n// Private sub-components\n\ntype AppCSSRootProps = {\n  children?: React.ReactNode;\n};\n\n/**\n * Mounts the outer `div.App` that is used to control global CSS selectors\n * such as `.App.mobile`.\n */\nfunction AppCSSRoot({ children }: AppCSSRootProps): React.ReactElement {\n  // Re-render when the page is re-sized to become mobile/desktop\n  // (desktop is >= 1024 px wide)\n  const mobile = !useScreenWidth(DESKTOP_BREAKPOINT);\n\n  return <div className={classes('App', mobile && 'mobile')}>{children}</div>;\n}\n","import { useLayoutEffect } from 'react';\n\n/**\n * Adds the given class(es) to the HTML `body` element\n * when this hook runs.\n */\nexport default function useBodyClass(className: string | string[]): void {\n  useLayoutEffect(() => {\n    if (typeof className === 'string') {\n      document.body.classList.add(className);\n    } else {\n      document.body.classList.add(...className);\n    }\n\n    return (): void => {\n      if (typeof className === 'string') {\n        document.body.classList.remove(className);\n      } else {\n        document.body.classList.remove(...className);\n      }\n    };\n  }, [className]);\n}\n","import React from 'react';\n\nexport type Theme = 'light' | 'dark';\n\nexport function isTheme(theme: string): theme is Theme {\n  switch (theme) {\n    case 'light':\n    case 'dark':\n      return true;\n    default:\n      return false;\n  }\n}\n\nexport type LoadingState<T> =\n  | LoadingStateLoaded<T>\n  | LoadingStateLoading\n  | LoadingStateError\n  | LoadingStateCustom;\nexport type LoadingStateLoaded<T> = { type: 'loaded'; result: T };\nexport type LoadingStateLoading = { type: 'loading' };\nexport type LoadingStateError = {\n  type: 'error';\n  overview: React.ReactNode;\n  error: Error;\n  stillLoading: boolean;\n};\nexport type LoadingStateCustom = {\n  type: 'custom';\n  contents: React.ReactNode;\n};\n\nexport type NonEmptyArray<T> = [T, ...T[]];\n\n// Declare (better) types for the ICS library\nexport type ICS = {\n  download(filename: string, ext?: string): string | false;\n  addEvent(\n    subject: string,\n    description: string,\n    location: string,\n    begin: string | Date,\n    stop: string | Date,\n    rrule: unknown\n  ): false | string[];\n};\n\nexport interface Combination {\n  crns: string[];\n  startMap: Record<string, number>;\n  endMap: Record<string, number>;\n}\n\nexport interface Period {\n  start: number;\n  end: number;\n}\n\nexport interface DateRange {\n  from: Date;\n  to: Date;\n}\n\nexport interface Location {\n  lat: number;\n  long: number;\n}\n\nexport interface Meeting {\n  period: Period | undefined;\n  days: string[];\n  where: string;\n  location: Location | null;\n  instructors: string[];\n  dateRange: DateRange;\n}\n\n// Note: if this type ever changes,\n// the course gpa cache needs to be invalidated\n// (by changing the local storage key).\n// See `src/data/beans/Course.ts` for the implementation of the cache.\nexport interface CourseGpa {\n  averageGpa?: number;\n  [instructor: string]: number | undefined;\n}\n\n// Meeting type (imported as `CrawlerMeeting`):\n// Copied from https://github.com/gt-scheduler/crawler/blob/master/src/types.ts\n\nexport type CrawlerMeeting = [\n  /**\n   * an integer index into `caches.periods`,\n   * specifying the class's start/end times\n   */\n  periodIndex: number,\n  /**\n   * a string specifying what days the class takes place on\n   * (e.g. `\"MW\"` or `\"TR\"`)\n   */\n  days: string,\n  /**\n   * a string giving the room/location where the course will be held\n   * (e.g. `\"College of Business 224\"`)\n   */\n  room: string,\n  /**\n   * an integer index into `caches.locations`,\n   * containing the latitude and longitude for a given course\n   */\n  locationIndex: number,\n  /**\n   * an array of strings listing all the instructors for this section,\n   * along with a 1-character code to mark the principal instructor\n   * (e.g. `[\"Katarzyna Rubar (P)\"]`)\n   */\n  instructors: string[],\n  /**\n   * an integer index into `caches.dateRanges`,\n   * specifying the start/end date of the class this semester\n   */\n  dateRangeIndex: number\n];\n\n// Section type (imported as `CrawlerSection`):\n// Copied from https://github.com/gt-scheduler/crawler/blob/master/src/types.ts\n\n/**\n * Contains  information about the course's section\n * (**Note** that this is an **array** (tuple), not an object)\n */\nexport type CrawlerSection = [\n  /**\n   * the CRN number of this section of the course\n   */\n  crn: string,\n  /**\n   * array of information about the section's meeting\n   * times/places/professors/etc.; in most cases, this array will only contain\n   * 1 item\n   */\n  meetings: CrawlerMeeting[],\n  /**\n   * integer number of credit hours this course is worth\n   */\n  creditHours: number,\n  /**\n   * integer index into `caches.scheduleTypes`\n   */\n  scheduleTypeIndex: number,\n  /**\n   * integer index into `caches.campuses`,\n   * specifying which campus the class is being taught at\n   */\n  campusIndex: number,\n  /**\n   * array of integer indices into `caches.attributes`,\n   * specifying any additional attributes the course has\n   */\n  attributeIndices: number[],\n  /**\n   * integer index into caches.gradeBases,\n   * specifying the grading scheme of the class\n   */\n  gradeBaseIndex: number\n];\n\n// Prerequisite types:\n// Copied from https://github.com/gt-scheduler/crawler/blob/master/src/types.ts\n\nexport type MinimumGrade = 'A' | 'B' | 'C' | 'D' | 'T';\nexport type PrerequisiteCourse = { id: string; grade?: MinimumGrade };\nexport type PrerequisiteClause = PrerequisiteCourse | PrerequisiteSet;\nexport type PrerequisiteOperator = 'and' | 'or';\nexport type PrerequisiteSet = [\n  operator: PrerequisiteOperator,\n  ...clauses: PrerequisiteClause[]\n];\n\n/**\n * Recursive data structure that is the sequence of all prerequisites in prefix\n * notation, parsed from the information on Oscar\n *\n * @example\n *\n * ```json\n   [\n     \"and\",\n     [\n       \"or\",\n       {\"id\":\"CS 3510\", \"grade\":\"C\"},\n       {\"id\":\"CS 3511\", \"grade\":\"C\"}\n     ]\n   ]\n * ```\n */\nexport type CrawlerPrerequisites = PrerequisiteSet | [];\n\n// Caches type (imported as `CrawlerCaches`):\n// Copied from https://github.com/gt-scheduler/crawler/blob/master/src/types.ts\n\n/**\n * Contains data shared by multiple class descriptions\n */\nexport interface CrawlerCaches {\n  /**\n   * List of all the different time ranges that classes can be offered at\n   * (e.g. `\"8:00 am - 8:50 am\"`;\n   * there is one `\"TBA\"` string for classes whose time is \"To Be Announced\")\n   */\n  periods: string[];\n  /**\n   * List of all possible start/ending dates that classes can be offered between\n   * (e.g. `\"Aug 17, 2020 - Dec 10, 2020\"`)\n   */\n  dateRanges: string[];\n  /**\n   * List of the different types of classes for each time block\n   * (e.g. `\"Lecture*\"`, `\"Recitation*\"`, or `\"Internship/Practicum*\"`)\n   */\n  scheduleTypes: string[];\n  /**\n   * List of the different GT campus locations that a class could take place at\n   * (e.g. `\"Georgia Tech-Atlanta *\"` or `\"Online\"`)\n   */\n  campuses: string[];\n  /**\n   * List of other miscellaneous attributes that can be associated with a class\n   * (e.g. `\"Hybrid Course\"`, `\"Honors Program\"`, or `\"Capstone\"`)\n   */\n  attributes: string[];\n  /**\n   * List of the different kinds of grading schemes a course can have\n   */\n  gradeBases: string[];\n  /**\n   * List of the different building locations a class can be at\n   */\n  locations: Location[];\n}\n\n// Course type (imported as `CrawlerCourse`):\n// Copied from https://github.com/gt-scheduler/crawler/blob/master/src/types.ts\n\n/**\n * Contains information about a single class\n * (**Note** that this is an **array** (tuple), not an object)\n */\nexport type CrawlerCourse = [\n  /**\n   * the full, human-readable name of the course (e.g. \"Accounting I\")\n   */\n  fullName: string,\n  /**\n   * a JSON object with information about each section of the course;\n   * the section IDs are the keys (`\"A\"`, `\"B\"`, `\"S2\"`, etc.)\n   */\n  sections: Record<string, CrawlerSection>,\n  /**\n     * a tree of prerequisite classes and the necessary grades in them\n     * (using boolean expressions in prefix order)\n     *\n     * @example\n     *\n     * ```json\n       [\n         \"and\",\n         [\n            \"or\",\n            {\"id\":\"CS 3510\", \"grade\":\"C\"},\n            {\"id\":\"CS 3511\", \"grade\":\"C\"}\n         ]\n       ]\n     * ```\n     */\n  // ! Type had `undefined` explicitly added to ensure we check when accessing\n  prerequisites: CrawlerPrerequisites | undefined,\n  /**\n   * Description pulled from Oscar\n   */\n  description: string | null\n];\n\n// TermData type (imported as `CrawlerTermData`):\n// Copied from https://github.com/gt-scheduler/crawler/blob/master/src/types.ts\n\n/**\n * Primary JSON object returned by the API.\n * See https://github.com/GTBitsOfGood/gt-scheduler/issues/1#issuecomment-694326220\n * for more info on the shape\n */\nexport interface CrawlerTermData {\n  /**\n   * Contains information about each class;\n   * this makes up the vast bulk of the resultant JSON.\n   * The course IDs are the keys (`\"ACCT 2101\"`, `\"CS 2340\"`, etc.)\n   */\n  courses: Record<string, CrawlerCourse>;\n  /**\n   * Contains data shared by multiple class descriptions\n   */\n  caches: CrawlerCaches;\n  /**\n   * Contains the time this JSON file was retrieved\n   */\n  // ! Type changed to `string` since this is what the JSON will be\n  updatedAt: string;\n  /**\n   * Version number for the term data\n   */\n  version: number;\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport * as Sentry from '@sentry/react';\nimport { Integrations } from '@sentry/tracing';\n\nimport App from './components/App';\n\nimport 'normalize.css';\nimport './stylesheet.scss';\n\n// Only initialize sentry on production\nif (process.env.NODE_ENV === 'production') {\n  // eslint-disable-next-line no-console\n  console.log('Initializing Sentry');\n  Sentry.init({\n    dsn: 'https://8955ef982197469e97c7644a8c090db1@o552970.ingest.sentry.io/5679614',\n    integrations: [new Integrations.BrowserTracing()],\n    tracesSampleRate: 1.0,\n    ignoreErrors: ['ResizeObserver loop limit exceeded'],\n    release: process.env['REACT_APP_SENTRY_VERSION'],\n  });\n}\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}